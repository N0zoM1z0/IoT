

<div id="wdsScanTable"></div>
<div class="wdsScanStepBtn">
	<div id="wdsBtnBack"></div>
	<div id="wdsBtnNext"></div>
</div><script type="text/javascript">var wdsTargetIndex=void 0,curManualWdsBand=BAND_2G,wdsTargetSelBand=BAND_2G,wdsIsScanning=!1;function tryNextBand(a){for(var e=[BAND_2G,BAND_5G,BAND_5G1,BAND_5G2],r=!1,k,q=0;q<e.length;q++)if(k=e[q+1],!r){if(a==e[q]&&(r=!0,null!=k&&"1"==gLocalAPInfo[k].enable))return k}else if(null!=k&&"1"==gLocalAPInfo[k].enable)return k;return-1}
function wdsTimeoutHandle(){if(MANUAL_WDS){var a=tryNextBand(curManualWdsBand);if(0<a){curManualWdsBand=a;wdsNextStep();return}}loadingDialog.hide(function(){confirmDialog.show({title:label.bridgingRootAP,content:label.linkFailed,callback:function(a){!0==a?wdsNextStep():(!1==MANUAL_WDS&&(wdsTargetIndex=void 0),clearTimeout(getWdsStatusHd),wdsCanceldHandle())}})})}
function wdsNextStep(){var a={},a={};curWdsBand=!1==MANUAL_WDS?wdsTargetSelBand:curManualWdsBand;a.enable="1";a.ssid=gRootAPInfo[curWdsBand].ssid;a.encryption=gRootAPInfo[curWdsBand].encryption+"";"1"==gRootAPInfo[curWdsBand].encryption&&(a.key=gRootAPInfo[curWdsBand].key);var a=gWDSModel[curWdsBand].set_wds(a),e;for(e in gRootAPInfo)gRootAPInfo.hasOwnProperty(e)&&(gRootAPInfo[e].enable=e==curWdsBand?"1":"0");"idle"==loadingDialog.status&&loadingDialog.show({title:label.bridgingRootAP,content:{primary:label.bridgingAndWait}},
null,null,!0,function(){!1==MANUAL_WDS&&(wdsTargetIndex=void 0);wdsCanceldHandle()});$.modify(a,function(a){var k=a[ERR_CODE];if(ENONE==k){var e=null;a=gWDSModel[curWdsBand].wds_start({set_ip_immediate:"0"});$.action(a,void 0,void 0,!0);if(!0==bWirelessLinked){var n=!1,l=1,c=function(){if(3<l&&!1==n){var a="",k=label.unlinkEpt;"1"==gLocalAPInfo[curEqtBand].encryption&&(a="<br />"+label.wirelessPwd+label.colon+gLocalAPInfo[curEqtBand].key);k+=label.wirelessName+label.colon+gLocalAPInfo[curEqtBand].ssid+
a;n=!0;loadingDialog.hide(function(){loadingDialog.show({content:{primary:k}})})}$.detect(function(){!1==$.result.timeout&&(clearTimeout(e),loadingDialog.hide(function(){loadingDialog.show({title:label.bridgingRootAP,content:{primary:label.bridgingAndWait}},null,null,!0,function(){!1==MANUAL_WDS&&(wdsTargetIndex=void 0);wdsCanceldHandle()});connectingCount=1;getWdsStatusHd=$.setTimeout(wdsStatusHd,100)}))});l++;e=$.setTimeout(c,2E3)};clearTimeout(e);e=$.setTimeout(c,4E3)}else connectingCount=1,getWdsStatusHd=
$.setTimeout(wdsStatusHd,5E3)}else loadingDialog.hide(function(){errHandle(k)})},void 0,!0)}
(function(){function a(){wdsTargetIndex=void 0;t.setState({type:Button.TYPE.SECONDARY});s.showLoading();if(!wdsIsScanning){for(var m in c)c.hasOwnProperty(m)&&c[m]&&($.action(gWDSModel[m].scan_start,void 0,void 0,!0),wdsIsScanning=!0);$.setTimeout(e,3E3)}}function e(){var m={wireless:{name:[]}},a;for(a in c)c.hasOwnProperty(a)&&c[a]&&m.wireless.name.push(gWDSModel[a].wlan_scan_status);$.query(m,function(a){var m=!0,b;for(b in a.wireless)a.wireless.hasOwnProperty(b)&&1!=a.wireless[b].status&&(m=!1);
!0==m?(wdsIsScanning=!1,r()):$.setTimeout(e,2E3)},void 0,!0)}function r(){var a={wireless:{table:[]}},d;for(d in c)c.hasOwnProperty(d)&&c[d]&&a.wireless.table.push(gWDSModel[d].wlan_scan);$.query(a,function(a){ENONE==a[ERR_CODE]?(l=k(a),l.sort(function(a,m){var g=parseInt(a.rssi),c=parseInt(m.rssi);return g>c?1:g==c?0:-1}),l=l.slice(-n)):(l=[],l.length=0,errHandle(a[ERR_CODE]));s.setDataSource(l);s.closeLoading(function(){s.loadData()})})}function k(a){var d=[],h,f;for(f in c)c.hasOwnProperty(f)&&
c[f]&&(h=gWDSModel[f].wlan_scan,d=d.concat(q(a.wireless[h],f)));return d}function q(a,c){for(var d=a.length,f=[],b=0;b<d;b++){var g=b+1;f[b]={};f[b].band=c;f[b].ssid=a[b]["ap_"+g].ssid;f[b].encryption=a[b]["ap_"+g].encryption;f[b].rssi=a[b]["ap_"+g].rssi;f[b].signal=20<=a[b]["ap_"+g].rssi?30<=a[b]["ap_"+g].rssi?50<=a[b]["ap_"+g].rssi?5:4:3:10<=a[b]["ap_"+g].rssi?2:1;switch(parseInt(a[b]["ap_"+g].encryption)){case uciWireless.encryptionType.none:g=label.wirelessNoSecurity;break;case uciWireless.encryptionType.psk2_psk:g=
label.wirelessPsk;break;case uciWireless.encryptionType.wep:g=label.wirelessWep;break;case uciWireless.encryptionType.wpa2_wpa:g=label.wirelessWpa;break;case uciWireless.encryptionType.psk2_sae3:g=label.wirelessWpa2PskWpa3Sae;break;case uciWireless.encryptionType.sae3:g=label.wirelessWpa3Sae;break;case uciWireless.encryptionType.wpa3:g=label.wirelessWpa3;break;default:g=label.wirelessUnknow}f[b].authMode=g}return f}var n,l=[],c=[];c[BAND_2G]=!1;c[BAND_5G]=!1;c[BAND_5G1]=!1;c[BAND_5G2]=!1;switch(slp.bandsProvided){case slp.TRIPLE:n=
3*MAX_WDS_SCAN_BAND;break;case slp.DOUBLE:n=2*MAX_WDS_SCAN_BAND;break;default:n=MAX_WDS_SCAN_BAND}if(slp.bandSteeringProvided&&"1"==gLocalAPInfo[BAND_STEER].bs_enable){if("1"==gLocalAPInfo[BAND_STEER].wifi_enable)for(var p in gKeyNames.wlan_wds)gKeyNames.wlan_wds.hasOwnProperty(p)&&null!=gKeyNames.wlan_wds[p]&&(c[p]=!0)}else for(p in gLocalAPInfo)gLocalAPInfo.hasOwnProperty(p)&&BAND_STEER!=p&&(c[p]="1"==gLocalAPInfo[p].enable);bInWizard=!0;var s=new Table({targetId:"wdsScanTable",title:label.WDSSelRootAp,
head:[{field:label.select,width:"0.11"},{field:label.wirelessNa,width:"0.37"},{field:label.bandInfo,width:"0.14",props:{"text-align":"center"}},{field:label.sigDep,width:"0.14",props:{"text-align":"center"}},{field:label.secInfo,width:"0.24",props:{"text-align":"center"}}],column:[{type:"radio",options:{name:"wdsScanRadio",callback:function(a,c){var h=l[a].encryption,f=l[a].band;h==uciWireless.encryptionType.none||h==uciWireless.encryptionType.psk2_psk||slp.wpa3Support&&(h==uciWireless.encryptionType.psk2_sae3||
h==uciWireless.encryptionType.sae3)?(h==uciWireless.encryptionType.psk2_psk||slp.wpa3Support&&(h==uciWireless.encryptionType.psk2_sae3||h==uciWireless.encryptionType.sae3)?(t.setState({type:Button.TYPE.SECONDARY}),d.resetType(d.TYPE.SELECT,{radioObj:c}),d.show()):h==uciWireless.encryptionType.none&&t.setState({type:Button.TYPE.PRIMARY}),wdsTargetIndex=a,gRootAPInfo[f].ssid=l[a].ssid,gRootAPInfo[f].encryption=parseInt(h),MANUAL_WDS=!1,wdsTargetSelBand=f):(slp.wpa3Support||h!=uciWireless.encryptionType.psk2_sae3&&
h!=uciWireless.encryptionType.sae3?alarmDialog.show(slp.wpa3Support?label.encryptOldWithWpa3:label.encryptOld):alarmDialog.show(label.encryptUnsupport),wdsTargetIndex=void 0,c.setValue(!1),t.setState({type:Button.TYPE.SECONDARY}))}}},{name:"ssid",type:"str"},{name:"band",type:"strSelect",props:{"text-align":"center"},options:[{str:"2.4G",value:BAND_2G},{str:"5G",value:BAND_5G},{str:"5G1",value:BAND_5G1},{str:"5G2",value:BAND_5G2}]},{name:"signal",type:"signal"},{name:"authMode",type:"str"}],tableOption:[{icon:"icon-manual",
str:btn.wdsAddManual,type:"manual",func:function(){d.resetType(d.TYPE.MANUAL);d.show()}},{icon:"icon-refresh",str:btn.refresh,type:"refresh",func:function(){a()}}],loadingOptions:{str:label.scaningWiFiSignal},blankOptions:{str:label.nonWdsScanData},editable:!1,hasCheckBox:!1,deletable:!1,addable:!1,hasFixedHeight:10,max:n}),d=new Dialog({title:label.rootApPwdConfirm,content:'<span class="wdsSsidPwdDesc">'+label.plzInputRootApSsidAndPwd+'</span><div id="wdsSsidCon" class="wdsSsidPwdInput"></div><div id="wdsPwdCon" class="wdsSsidPwdInput"></div>',
size:Dialog.SIZE.SMALL,type:Dialog.TYPE.CUSTOM,bottom:[{type:component.Button.TYPE.SECONDARY,text:btn.cancel,id:"wdsSsidPwdCancel",onClick:function(){$(d).trigger("ev_wdsSsidPwdCancel")}},{type:component.Button.TYPE.PRIMARY,text:btn.ok,id:"wdsSsidPwdSubmit",onClick:function(){$(d).trigger("ev_wdsSsidPwdSubmit")}}],renderCallBack:function(){this.wdsSsidInput=new Input({type:Input.TYPE.PLAIN_TEXT,label:{value:label.wirelessName},targetId:"wdsSsidCon",check:{blur:checkSsidInput},props:{maxlength:"32",
type:"text"}});this.wdsPwdInput=new Input({type:Input.TYPE.CIPHER_TEXT,label:{value:label.wirelessPwd},targetId:"wdsPwdCon",check:{blur:onPwdBlur,keyup:onPwdKeyup},props:{maxlength:"63",type:"text"}})}});d.show=function(){this.wdsSsidInput.setValue("");this.wdsPwdInput.setValue("");this.wdsSsidInput.closeNote();this.wdsPwdInput.closeNote();Dialog.prototype.show.call(this)};d.resetType=function(a,e){var h=this,f=this.wdsSsidInput,b=this.wdsPwdInput;switch(a){case d.TYPE.SELECT:$("#wdsSsidCon").css("display",
"none");$(d).off("ev_wdsSsidPwdCancel").on("ev_wdsSsidPwdCancel",function(){void 0!=e&&void 0!=e.radioObj&&e.radioObj.setValue(!1);wdsTargetIndex=void 0;h.hide()});$(d).off("ev_wdsSsidPwdSubmit").on("ev_wdsSsidPwdSubmit",function(a){return function(){a.checkAll()&&(gRootAPInfo[wdsTargetSelBand].encryption=uciWireless.dynOptValue.encryption.on,gRootAPInfo[wdsTargetSelBand].key=a.getValue(),wdsNextStep())}}(b));break;case d.TYPE.MANUAL:$("#wdsSsidCon").css("display","block"),$(d).off("ev_wdsSsidPwdCancel").on("ev_wdsSsidPwdCancel",
function(){h.hide()}),$(d).off("ev_wdsSsidPwdSubmit").on("ev_wdsSsidPwdSubmit",function(a,d){return function(){var b,e,f=!0;[a,d].forEach(function(a){f=a.checkAll()&&f});if(f){for(b in c)if(c.hasOwnProperty(b)&&c[b]){curManualWdsBand=b;break}b=a.getValue();e=d.getValue();""==e?(gRootAPInfo[BAND_2G].encryption="0",gRootAPInfo[BAND_5G].encryption="0",gRootAPInfo[BAND_5G1].encryption="0",gRootAPInfo[BAND_5G2].encryption="0"):(gRootAPInfo[BAND_2G].encryption="1",gRootAPInfo[BAND_5G].encryption="1",gRootAPInfo[BAND_5G1].encryption=
"1",gRootAPInfo[BAND_5G2].encryption="1");gRootAPInfo[BAND_2G].ssid=b;gRootAPInfo[BAND_5G].ssid=b;gRootAPInfo[BAND_5G1].ssid=b;gRootAPInfo[BAND_5G2].ssid=b;gRootAPInfo[BAND_2G].key=e;gRootAPInfo[BAND_5G].key=e;gRootAPInfo[BAND_5G1].key=e;gRootAPInfo[BAND_5G2].key=e;MANUAL_WDS=!0;wdsNextStep()}}}(f,b))}};d.TYPE={SELECT:"select",MANUAL:"manual"};new Button({text:btn.preStep,onClick:function(){stepPage(firstPage)},type:Button.TYPE.SECONDARY,id:"wdsBtnBack",props:{width:"120px"}});var t=new Button({text:btn.nextStep,
onClick:function(){this._ops.type==Button.TYPE.SECONDARY?showToast(label.wdsNoHostSelect):wdsNextStep()},type:Button.TYPE.SECONDARY,id:"wdsBtnNext",props:{width:"240px"}});a()})();
</script><style type="text/css">span.wdsSsidPwdDesc{display:block;height:20px;line-height:20px;margin-bottom:16px}div.wdsSsidPwdInput label.outerLbl{width:96px}i.radio[name="wdsScanRadio"]{cursor:pointer}</style>