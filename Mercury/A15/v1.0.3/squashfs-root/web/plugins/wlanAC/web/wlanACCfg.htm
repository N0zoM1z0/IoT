

<div class="head">
	<div class="title">
		<h1>{%menuStr.wlanAccess%}</h1>
		<i class="helpBtn iconfont icon-help" helpStr="WlanAccessHelp"></i>
		<div id="switchCon" class="switchCon switchConHs">
			<i class="switchBg"></i>
			<i class="switchBall"/></i>
		</div>
	</div>
	<p class="description">{%titleDescriptionStr.wlanAccessDescription%}</p>
</div>
<div id="wlanAccWhiteTable"></div><script type="text/javascript">(function(){function n(b){var a="";switch(b){case ENONE:return!0;case ESYSTEM:a=errStr.systemErr;break;case ETABLEFULL:a=errStr.tableFullErr;break;case EENTRYNOTEXIST:a=errStr.entryNoExistErr;break;case EENTRYCONFLIC:a=errStr.invSameItem;break;case EHOSTNAME:a=errStr.hostLenErr;break;default:a=errStr.invRequestFail}alarmDialog.show(a);return!1}function t(){var b={},a={},c={};b[f]=a;a[J]=c;c[R]=k.state;!1==K&&loadingDialog.show({content:{primary:label.savingAndWait}});$.modify(b,function(a){loadingDialog.hide(function(){n(a[ERR_CODE])&&
(K=!1,l=k.state,L())})},void 0,!0)}function S(){if(C<u.length){var b={},a={},c={};b[f]=a;a[KEY_TABLE]=s;a[KEY_NAME]=s+"_"+calcNextIndex(h);a[KEY_PARA]=c;c[KEY_NAME]=u[C][KEY_NAME];c[r]=u[C][r];$.add(b,function(a){n(a[ERR_CODE])?(c[SEC_NAME]=s+"_"+calcNextIndex(h),h.push(c),C++,S()):t()},void 0,!0)}else t()}function T(b,a){var c={},d={};loadingDialog.show({title:label.confirmTip,content:{primary:label.deletingAndWait}});c[f]=d;d[KEY_NAME]=b;$.del(c,function(b){loadingDialog.hide(function(){n(b[ERR_CODE])?
(a(!0),w(x)):a(!1)})})}function U(b){for(var a=b.table._getSelectItem(),c=a.selArrStr.split("-"),a=a.selArr.length,d=C=u.length=0;d<a;d++){var p={},e=1==l?"":g[c[d]].name.replace(/^\s+|\s+$/g,""),f=String(g[c[d]].mac.match(/([0-9a-f]{2}-){5}([0-9a-f]{2})+/gi));f&&""!=f&&!D(f)&&(p[KEY_NAME]=e,p[r]=f,u.push(p))}u.length+h.length>E?alarmDialog.show("列表条目超过规定个数，最多允许指定"+E+"个设备。"):b.hide(function(){0==u.length?1!=l&&(0==h.length?confirmDialog.show({title:label.confirmTitle,content:label.wlanAccessWarnWhiteListEmpty,
callback:function(a){!0==a&&t()}}):t()):(loadingDialog.show({title:label.confirmTitle,content:{primary:label.savingAndWait}}),K=!0,S())})}function M(b){var a,c={};y=z=g.length=0;c[f]={};c[f][KEY_NAME]=V;$.query(c,function(c){if(n(c[ERR_CODE]))if(a=c[f][V],z=null==a["2g"]?z:parseInt(a["2g"]),y=null==a["5g"]?y:parseInt(a["5g"]),0>=z+y)"function"==typeof b&&b();else{c={};var p={};c[f]=p;if(0<z){var e={};e[W]=0;e[X]=z-1;p[Y]=e}0<y&&(e={},e[W]=0,e[X]=y-1,p[Z]=e);$.action(c,function(a){n(a[ERR_CODE])&&
(aa(a[Y]),aa(a[Z]),!0==F&&!1==D(q)&&g.push(G),"function"==typeof b&&b())})}})}function ba(b){var a={};g.length=0;a[f]={};a[f][KEY_TABLE]=N;$.query(a,function(a){if(n(a[ERR_CODE])&&null!=a[f]&&null!=a[f][N]){var d,p,e=formatTableData(a[f][N])||[];for(a=0;a<e.length;a++)p={},d=e[a],p.name=getBrandName(d,"ch"),p.mac=d.mac.toUpperCase(),d=parseInt(d.interval),p.tip=86400<=d?""+String(parseInt(d/86400))+"天前":3600<=d?""+String(parseInt(d/3600))+"小时前":60<=d?""+String(parseInt(d/60))+"分钟前":"刚刚",g.splice(0,
0,p);"function"==typeof b&&b()}})}function aa(b){var a,c,d=formatTableData(b)||[];for(b=0;b<d.length;b++){c={};a=d[b];c.name=a.name.replace(/^\s+|\s+$/g,"");if(""==c.name||"-"==c.name)c.name=ca;c.mac=a.mac.toUpperCase();c.ip=a.ip;c.mac==q?(G.name=c.name,G.mac=c.mac,G.ip=c.ip):!0!=D(c.mac)&&g.splice(0,0,c)}}function O(){P(function(){for(var b=0;b<H.length;b++)if(!1==D(H[b][r])){M(function(){m.table.setDataSource(g);m.table.loadData();for(var a=0;a<g.length;a++)g[a].mac.toUpperCase()==q.toUpperCase()&&
(g[a].CHECK_BOX.setValue(!0),g[a].CHECK_BOX.disable(!0),$("#linkedListSelectNum").html(1));m.show()});return}0==h.length?confirmDialog.show({title:label.confirmTitle,content:label.wlanAccessWarnWhiteListEmpty,callback:function(a){!0==a?t():k.setState(0)}}):t()})}function D(b){if(0==h.length)return!1;for(var a=0;a<h.length;a++)if(b.toUpperCase()==h[a][r].toUpperCase())return!0;return!1}function x(){for(var b=0;b<h.length;b++){if(""==h[b][KEY_NAME]||"-"==h[b][KEY_NAME])h[b][KEY_NAME]=ca;A==uciCustomNetwork.optValue.owner.andlink&&
B==uciCustomNetwork.optValue.macFilterConfig.on&&(h[b].checkboxDisabled=!0,h[b].checkboxDisabledChecked=!1)}I.setDataSource(h);I.loadData();A==uciCustomNetwork.optValue.owner.andlink&&B==uciCustomNetwork.optValue.macFilterConfig.on&&(I.selAllCheckBoxObj.disable(!1),$("#wlanAccWhiteTable .tableOption").addClass("disabled"))}function ha(){k.setState(l);P(x)}function P(b){var a={},c={};a[da]=c;c[KEY_TABLE]=ea;$.query(a,function(a){if(n(a[ERR_CODE])){a=formatTableData(a[da][ea])||[];for(var c=H.length=
0;c<a.length;c++){var e=a[c];e[fa]==uciHostsInfo.optValue.linkType.hostWireless&&"1"==e[ia]&&(F=!0,q=e[ga].toUpperCase());if(e[fa]==uciHostsInfo.optValue.linkType.hostWireless){var f={};f.name=e[ja];f.mac=e[ga].toUpperCase();H.push(f)}}"function"==typeof b&&b()}})}function w(b){var a={};a[f]={};a[f][ka]={};$.action(a,function(a){if(ENONE==a[ERR_CODE]){if(null==a[f]&&null==a[f][s])return;h=formatTableData(a[f][s])||[]}"function"==typeof b&&b()})}function L(){var b={};b[f]={};b[f][KEY_NAME]=J;$.query(b,
function(a){n(a[ERR_CODE])&&(l=0==parseInt(a[f][J][R])?0:1,w(ha))})}var f="wlan_access",J="config",s="white_list",ka="get_white_list",R="enable",V="connected_num",Y="get_2g_sta",Z="get_5g_sta",W="index_start",X="index_end",N="block_list",ca=label.anonymousHost,r="mac",da=uciHostsInfo.fileName,ea=uciHostsInfo.dynData.online_host,ia=uciHostsInfo.optName.isCurHost,ga=uciHostsInfo.optName.mac,ja=uciHostsInfo.optName.hostname,fa=uciHostsInfo.optName.type,E=0,h=[],g=[],u=[],H=[],I,F=!1,q="00-00-00-00-00-00",
G={},C=0,z=0,y=0,l=!1,K=!1,k,A,B,E=void 0===slp.moduleSpec.manage_sta_num?slp.bandsProvided==slp.TRIPLE?(slp.moduleSpec.host_num_2g||0)+(slp.moduleSpec.host_num_5g_1||0)+(slp.moduleSpec.host_num_5g_4||0):slp.bandsProvided==slp.DOUBLE?(slp.moduleSpec.host_num_2g||0)+(slp.moduleSpec.host_num_5g||0):slp.moduleSpec.host_num_2g||0:slp.moduleSpec.manage_sta_num;I=new Table({title:label.wlanAccessWhiteList,targetId:"wlanAccWhiteTable",head:[{field:label.deviceName,width:"0.66"},{field:label.mac,width:"0.34"}],
column:[{name:"name",type:"str",maxLength:DEVICE_NAME_LEN_MAX,isAllowBlank:!1,isAllowAllSpace:!1},{name:"mac",type:"mac"}],editable:!0,addable:!0,addOption:{icon:"icon-manual",str:btn.addManual},tableOption:[{icon:"icon-add",type:"add",str:btn.addDevice,func:function(){1==l?ba(function(){v.table.setDataSource(g);v.table.loadData();v.show()}):M(function(){m.table.setDataSource(g);m.table.loadData();for(var b=0;b<g.length;b++)g[b].mac.toUpperCase()==q.toUpperCase()&&(g[b].CHECK_BOX.setValue(!0),g[b].CHECK_BOX.disable(!0),
$("#linkedListSelectNum").html(1));m.show()})},selRelate:!1}],clickList:{click_save:{func:function(b,a,c,d){var g=a[KEY_NAME];a=a[r].toUpperCase();for(var g=g.replace(/^\s+|\s+$/g,""),e=0;e<h.length;e++)e!=c&&a==h[e][r].toUpperCase()&&(alarmDialog.show(errStr.invSameItem),d(!1));if("add"==b)c={},b={},e={},c[f]=b,b[KEY_TABLE]=s,b[KEY_NAME]=s+"_"+calcNextIndex(h),b[KEY_PARA]=e,e[KEY_NAME]=g,e[r]=a,$.add(c,function(a){n(a[ERR_CODE])?(showToast(label.addSuccess),d(!0),w(x)):d(!1)});else if("edit"==b){b=
h[c][SEC_NAME];c=h[c][r].toUpperCase();var m={},e={},k={};m[f]=e;e[b]=k;k[KEY_NAME]=g;k[r]=a;0!=l&&c.toUpperCase()==q.toUpperCase()&&c.toUpperCase()!=a.toUpperCase()&&!0==F?confirmDialog.show({title:label.confirmTitle,content:label.wlanAccessWarnEditCurMac,callback:function(a){!0==a?$.modify(m,function(a){n(a[ERR_CODE])?(showToast(label.modifySuccess),d(!0),w(x)):d(!1)}):d(!1)}}):$.modify(m,function(a){n(a[ERR_CODE])?(showToast(label.modifySuccess),d(!0),w(x)):d(!1)})}},asyn:!0},click_del_item:{func:function(b,
a){var c=b.split("-"),d=[],g={},e=!1,m=0,k={},l={};if(c.length==h.length)k[f]=l,l[KEY_TABLE]=s,!0==F&&D(q)?confirmDialog.show({title:label.confirmTitle,content:label.wlanAccessWarnDelSel_1+q+label.wlanAccessWarnDelSel_2,callback:function(b){!0==b&&(loadingDialog.show({title:label.confirmTip,content:{primary:label.deletingAndWait}}),$.del(k,function(b){loadingDialog.hide(function(){n(b[ERR_CODE])?(a(!0),L()):a(!1)})}))}}):$.del(k,function(b){n(b[ERR_CODE])?(a(!0),w(x)):a(!1)});else{for(l=0;l<c.length;l++)h[c[l]][r].toUpperCase()==
q.toUpperCase()?(g=h[c[l]][SEC_NAME],e=!0):(d[m]=h[c[l]][SEC_NAME],m++);e?confirmDialog.show({title:label.confirmTitle,content:label.wlanAccessWarnDelSel_1+q+label.wlanAccessWarnDelSel_2,callback:function(b){!0==b&&(d.push(g),T(d,a))}}):T(d,a)}},asyn:!0,onRender:function(){return A==uciCustomNetwork.optValue.owner.andlink&&B==uciCustomNetwork.optValue.macFilterConfig.on?!1:!0}},click_edit_item:{onRender:function(){return A==uciCustomNetwork.optValue.owner.andlink&&B==uciCustomNetwork.optValue.macFilterConfig.on?
!1:!0}}},blankOptions:{height:1},max:E});k=new Switch("switchCon",l,function(b){if(1==b)if(slp.macFilterSupport){var a={};a[uciCustomNetwork.fileName]={};a[uciCustomNetwork.fileName][KEY_NAME]=uciCustomNetwork.dynData.macFilterConfig;$.query(a,function(b){b[ERR_CODE]==ENONE?"on"==b[uciCustomNetwork.fileName][uciCustomNetwork.secName.macFilterConfig][uciCustomNetwork.optName.enable]?confirmDialog.show({content:label.turnOnParentControlWarn,callback:function(b){b?(a={},a[uciCustomNetwork.fileName]=
{},a[uciCustomNetwork.fileName][uciCustomNetwork.secName.macFilterConfig]={enable:"off"},$.modify(a,function(a){a[ERR_CODE]==ENONE?O():n(a[ERR_CODE])})):k.setState(0)}}):O():n(b[ERR_CODE])})}else O();else t()},!1);if(slp.macFilterSupport){var Q={};Q[uciCustomNetwork.fileName]={};Q[uciCustomNetwork.fileName][KEY_NAME]=uciCustomNetwork.dynData.macFilterConfig;$.query(Q,function(b){b[ERR_CODE]==ENONE&&(B=b[uciCustomNetwork.fileName][uciCustomNetwork.secName.macFilterConfig][uciCustomNetwork.optName.enable],
A=b[uciCustomNetwork.fileName][uciCustomNetwork.secName.macFilterConfig][uciCustomNetwork.optName.owner],A==uciCustomNetwork.optValue.owner.andlink&&B==uciCustomNetwork.optValue.macFilterConfig.on&&k.disable(!0))},!1)}var m=new Dialog({title:label.addDevice+label.lBrackets+'<span id="linkedListSelectNum">0</span>'+label.rBrackets,content:'<div class="linkedBannedTitleDesc"><span class="primary">'+label.deviceLinkedAndChoose+'</span><span class="secondary">'+label.deviceConnectAndRefresh+'</span></div><div id="linkedListTable"></div>',
size:component.Dialog.SIZE.MEDIUM,type:component.Dialog.TYPE.CUSTOM,hasCloseIcon:!0,closeIconHandle:function(){k.setState(0)},bottom:[{type:component.Button.TYPE.SECONDARY,text:btn.cancelTip,id:"linkedListTableCancel",onClick:function(){k.setState(0);m.hide()}},{type:component.Button.TYPE.PRIMARY,text:btn.confirmTip,id:"linkedListTableSubmit",onClick:function(){U(m)}}],renderCallBack:function(){var b=this;b.table=new Table({targetId:"linkedListTable",head:[{field:label.deviceName,width:"0.57"},{field:label.mac,
width:"0.43"}],column:[{name:"name",type:"str",onRender:function(a,b){return a.mac.toUpperCase()==q.toUpperCase()?'<span style="color:#FF3366;margin-right:2px;">['+label.bHost+"]</span>"+b:b}},{name:"mac",type:"str"}],tableOption:[{icon:"icon-refresh",str:btn.refresh,type:"refresh",func:function(){P(function(){M(function(){m.table.setDataSource(g);m.table.loadData();for(var a=0;a<g.length;a++)g[a].mac.toUpperCase()==q.toUpperCase()&&(g[a].CHECK_BOX.setValue(!0),g[a].CHECK_BOX.disable(!0),$("#linkedListSelectNum").html(1));
showToast(label.refreshSuccess)})})}}],editable:!1,addable:!1,deletable:!1,blankOptions:{str:label.nonAddableDevice,height:1},numPerPage:8});$(b.table).on("ev_sel_item",function(){var a=b.table._getSelectItem().selArr.length;$("#linkedListSelectNum").html(a)}).on("ev_sel_none",function(){$("#linkedListSelectNum").html(0)})}}),v=new Dialog({title:label.addDevice+label.lBrackets+'<span id="bannedListSelectNum">0</span>'+label.rBrackets,content:'<div class="linkedBannedTitleDesc"><span class="primary">'+
label.deviceBannedAndChoose+'</span><span class="secondary">'+label.deivceTryConnectAndRefresh+'</span></div><div id="bannedListTable"></div>',size:component.Dialog.SIZE.MEDIUM,type:component.Dialog.TYPE.CUSTOM,hasCloseIcon:!0,bottom:[{type:component.Button.TYPE.SECONDARY,text:btn.cancelTip,id:"bannedListTableCancel",onClick:function(){v.hide()}},{type:component.Button.TYPE.PRIMARY,text:btn.confirmTip,id:"bannedListTableSubmit",onClick:function(){U(v)}}],renderCallBack:function(){var b=this;b.table=
new Table({targetId:"bannedListTable",head:[{field:label.deviceBrand,width:"0.48"},{field:label.mac,width:"0.32"},{field:label.linkTime,width:"0.2"}],column:[{name:"name",type:"str"},{name:"mac",type:"str"},{name:"tip",type:"str"}],tableOption:[{icon:"icon-refresh",str:btn.refresh,type:"refresh",func:function(){ba(function(){v.table.setDataSource(g);v.table.loadData();showToast(label.refreshSuccess)})}}],editable:!1,addable:!1,deletable:!1,blankOptions:{str:label.nonAddableDevice,height:1},numPerPage:8});
$(b.table).on("ev_sel_item",function(){var a=b.table._getSelectItem().selArr.length;$("#bannedListSelectNum").html(a)}).on("ev_sel_none",function(){$("#bannedListSelectNum").html(0)})}});L()})();
</script><style type="text/css">div.linkedBannedTitleDesc{position:absolute;top:24px;left:24px}div.linkedBannedTitleDesc span{display:block;height:20px;line-height:20px;font-size:13px}div.linkedBannedTitleDesc span.primary{color:#333}div.linkedBannedTitleDesc span.secondary{color:#999}#linkedListTable div.tableTitleContainer,#bannedListTable div.tableTitleContainer{margin-bottom:16px}</style>