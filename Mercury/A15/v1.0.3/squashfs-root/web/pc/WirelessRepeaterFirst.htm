

<div id="wdsScanTable"></div>
<div class="wdsScanStepBtn">
	<div id="wdsBtnBack"></div>
	<div id="wdsBtnNext"></div>
</div><script type="text/javascript">var wdsIsScanning=!1;function wdsTimeoutHandle(){loadingDialog.hide(function(){confirmDialog.show({content:label.linkFailed,callback:function(a){!0==a?wdsNextStep():(clearTimeout(getWdsStatusHd),wdsCanceldHandle())}})})}
function wdsNextStep(){var a=function(){var a={wireless:{}},a=slp.DOUBLE==slp.bandsProvided?{wireless:{wlan_wds_2g:{enable:"0",ssid:""},wlan_wds_5g:{enable:"0",ssid:""}}}:{wireless:{wlan_wds_2g:{enable:"0",ssid:""},wlan_wds_5g_1:{enable:"0",ssid:""},wlan_wds_5g_4:{enable:"0",ssid:""}}},f;for(f in targetSelFreq)if(targetSelFreq[f].selected){var e={enable:"1"};e.ssid=gRootAPInfo[f].ssid;e.encryption=gRootAPInfo[f].encryption;"0"!=gRootAPInfo[f].encryption&&(e.key=gRootAPInfo[f].key);a.wireless[gWDSModel[f].set_wds]=
e;gRootAPInfo[f].enable="1"}return a}();"idle"==loadingDialog.status&&loadingDialog.show({title:"中继前端路由",content:{primary:"正在中继，请稍候..."}},null,null,!0,function(){wdsCanceldHandle()});$.modify(a,function(a){var f=a[ERR_CODE];if(ENONE==f){var e=null;a={wireless:{}};for(var d in targetSelFreq)targetSelFreq[d].selected&&(a.wireless[gWDSModel[d].wds_start]={set_ip_immediate:"0"});$.action(a,void 0,void 0,!0);if(!0==bWirelessLinked){var b=!1,g=1,h=function(){if(3<g&&!1==b){var a=label.unlinkEpt;b=!0;loadingDialog.hide(function(){loadingDialog.show({content:{primary:a}})})}$.detect(function(){!1==
$.result.timeout&&(clearTimeout(e),loadingDialog.hide(function(){loadingDialog.show({title:"中继前端路由",content:{primary:"正在中继，请稍候..."}},null,null,!0,function(){wdsCanceldHandle()});connectingCount=1;getWdsStatusHd=$.setTimeout(wdsStatusHd,100)}))});g++;e=$.setTimeout(h,2E3)};clearTimeout(e);e=$.setTimeout(h,4E3)}else connectingCount=1,getWdsStatusHd=$.setTimeout(wdsStatusHd,5E3)}else loadingDialog.hide(function(){errHandle(f)})},void 0,!0)}
function closeFailedBand(){var a={wireless:{}},c;for(c in targetSelFreq)targetSelFreq[c].selected&&2!=targetSelFreq[c].status&&(a.wireless[gWDSModel[c].set_wds]={enable:"0",ssid:""},gRootAPInfo[c].enable="0",targetSelFreq[c].selected=!1);$.modify(a,function(a){dhcpsRetryCounts=1;getDhcpsHd=$.setTimeout(wdsGetIpDhcpsStatus,100)})}var scanList=[];
function wdsSacnSelHandler(a,c){var f=scanList[a].freq,e=scanList[a].freqArr,d=scanList[a].encryption;if($(c).find("label.checkbox").hasClass("checked")){if(f==FREQ_BS)for(var b=0;b<e.length;b++)selectedFreq[e[b]]=!0;else selectedFreq[f]=!0;if(d==uciWireless.encryptionType.none||d==uciWireless.encryptionType.psk2_psk||slp.wpa3Support&&(d==uciWireless.encryptionType.psk2_sae3||d==uciWireless.encryptionType.sae3)){for(b=0;b<scanList.length;b++)b==a||$($("#wdsScanTable label.checkbox")[scanList.length-
1-b]).hasClass("checked")||f!=BAND_STEER&&scanList[b].freq!=BAND_STEER&&scanList[b].freq!=f||$($("#wdsScanTable label.checkbox")[scanList.length-1-b]).removeClass("checked").addClass("disabled");wdsBtnNext.setState({type:Button.TYPE.PRIMARY});-1==$.inArray(a,wdsTargetIndex)&&wdsTargetIndex.push(a);if(f==BAND_STEER)for(b=0;b<e.length;++b)targetSelFreq[b]={selected:!0,bs:!0},gRootAPInfo[b].ssid=scanList[a].ssid,gRootAPInfo[b].encryption=parseInt(d);else targetSelFreq[f]={selected:!0,bs:!1},gRootAPInfo[f].ssid=
scanList[a].ssid,gRootAPInfo[f].encryption=parseInt(d)}else slp.wpa3Support||d!=uciWireless.encryptionType.psk2_sae3&&d!=uciWireless.encryptionType.sae3?alarmDialog.show(slp.wpa3Support?label.encryptOldWithWpa3:label.encryptOld):alarmDialog.show(label.encryptUnsupport)}else{if(f==BAND_STEER)for(b=0;b<e.length;++b)targetSelFreq[b]={selected:!1,bs:!1};else targetSelFreq[f]={selected:!1,bs:!1};-1!=$.inArray(a,wdsTargetIndex)&&wdsTargetIndex.splice($.inArray(a,wdsTargetIndex),1);if(0==wdsTargetIndex.length)wdsBtnNext.setState({type:Button.TYPE.SECONDARY}),
$("#wdsScanTable label.checkbox.disabled").removeClass("disabled");else for(b=0;b<scanList.length;b++)f==scanList[b].freq&&$($("#wdsScanTable label.checkbox")[scanList.length-1-b]).removeClass("disabled")}}
function refreshScanList(){selectedFreq[FREQ_2G]=!1;selectedFreq[FREQ_5G]=!1;selectedFreq[FREQ_5G1]=!1;selectedFreq[FREQ_5G4]=!1;wdsTargetIndex=[];wdsBtnNext.setState({type:Button.TYPE.SECONDARY});wdsScanTable.showLoading();if(slp.bandSteeringProvided&&"1"==gLocalAPInfo[FREQ_BS].bs_enable){if("1"==gLocalAPInfo[FREQ_BS].wifi_enable)for(var a in gKeyNames[slp.bandsProvided-1].wlan_wds)gKeyNames[slp.bandsProvided-1].wlan_wds.hasOwnProperty(a)&&null!=gKeyNames[slp.bandsProvided-1].wlan_wds[a]&&(scanWiFiList[a]=
!0)}else for(a in gLocalAPInfo)gLocalAPInfo.hasOwnProperty(a)&&FREQ_BS!=a&&(scanWiFiList[a]="1"==gLocalAPInfo[a].enable);if(!wdsIsScanning){for(var c in scanWiFiList)scanWiFiList.hasOwnProperty(c)&&scanWiFiList[c]&&($.action(gWDSModel[c].scan_start,void 0,void 0,!0),wdsIsScanning=!0);getScanResultHd=$.setTimeout(getScanResult,3E3)}}
function getScanResult(){var a={wireless:{name:[]}},c;for(c in scanWiFiList)scanWiFiList.hasOwnProperty(c)&&scanWiFiList[c]&&a.wireless.name.push(gWDSModel[c].wlan_scan_status);$.query(a,function(a){var c=!0,d;for(d in a.wireless)a.wireless.hasOwnProperty(d)&&1!=a.wireless[d].status&&(c=!1);!0==c?(wdsIsScanning=!1,loadScanResult()):getScanResultHd=$.setTimeout(getScanResult,2E3)},void 0,!0)}
function loadScanResult(){var a={wireless:{table:[]}},c;for(c in scanWiFiList)scanWiFiList.hasOwnProperty(c)&&scanWiFiList[c]&&a.wireless.table.push(gWDSModel[c].wlan_scan);$.query(a,function(a){ENONE==a[ERR_CODE]?(scanList=getScanApList(a),scanList.sort(function(a,d){var b=parseInt(a.rssi),c=parseInt(d.rssi);return b>c?1:b==c?0:-1}),scanList=scanList.slice(-MAX_AP_ENTRY),wdsTargetIndex=[],targetSelFreq={}):(scanList=[],scanList.length=0,errHandle(a[ERR_CODE]));wdsScanTable.setDataSource(scanList);
wdsScanTable.closeLoading(function(){wdsScanTable.loadData()})})}
function getScanApList(a){var c=[],f,e={},d;for(d in scanWiFiList)scanWiFiList.hasOwnProperty(d)&&scanWiFiList[d]&&(f=gWDSModel[d].wlan_scan,e[d]=fmtApList(a.wireless[f],d));for(d in scanWiFiList)if(scanWiFiList.hasOwnProperty(d)&&scanWiFiList[d])for(a=0;a<e[d].length;++a){f=!1;for(var b=0;b<c.length;++b)if(c[b].ssid==e[d][a].ssid&&c[b].encryption==e[d][a].encryption){f=!0;c[b].rssi=Math.max(c[b].rssi,e[d][a].rssi);c[b].signal=Math.max(c[b].signal,e[d][a].signal);-1==$.inArray(e[d][a].freq,c[b].freqArr)&&
(c[b].freqArr.push(e[d][a].freq),c[b].freqInfo=c[b].freqInfo+" & "+e[d][a].freqInfo,c[b].freq=BAND_STEER);break}f||c.push(e[d][a])}return c}
function fmtApList(a,c){for(var f=a.length,e=[],d=0;d<f;d++){var b=d+1;e[d]={};e[d].band=c;e[d].freq=c;e[d].freqArr=[c];e[d].freqInfo=gFreqInfo[c];e[d].ssid=a[d]["ap_"+b].ssid;e[d].encryption=a[d]["ap_"+b].encryption;e[d].rssi=a[d]["ap_"+b].rssi;e[d].signal=signalLevel(a[d]["ap_"+b].rssi);switch(parseInt(a[d]["ap_"+b].encryption)){case uciWireless.encryptionType.none:b=label.wirelessNoSecurity;break;case uciWireless.encryptionType.psk2_psk:b=label.wirelessPsk;break;case uciWireless.encryptionType.wep:b=
label.wirelessWep;break;case uciWireless.encryptionType.wpa2_wpa:b=label.wirelessWpa;break;case uciWireless.encryptionType.psk2_sae3:b=label.wirelessWpa2PskWpa3Sae;break;case uciWireless.encryptionType.sae3:b=label.wirelessWpa3Sae;break;case uciWireless.encryptionType.wpa3:b=label.wirelessWpa3;break;default:b=label.wirelessUnknow}e[d].authMode=b}return e}function signalLevel(a){return 20<=a?30<=a?50<=a?5:4:3:10<=a?2:1}
function nextStep(){bNeedPwd=!1;for(var a in targetSelFreq)if(targetSelFreq[a].selected&&"0"!=gRootAPInfo[a].encryption){bNeedPwd=!0;break}bNeedPwd?inputRootApPwd():wdsNextStep()}
function inputRootApPwd(a){loadingDialog.hide();var c=[];$("#wdsSsidPwdDialogDesc").is(":visible")?wdsSsidPwdDialog.refresh():(wdsSsidPwdDialog.refresh(),wdsSsidPwdDialog.show());for(var f in targetSelFreq)if(targetSelFreq[f].selected){var e=f;targetSelFreq[f].bs&&(e=FREQ_BS);$("#root"+e+"Con").removeClass("disNone");$("#root"+e+"Con input")[0].value=gRootAPInfo[f].ssid;if("0"==gRootAPInfo[f].encryption)$("#root"+e+"Con input")[1].value="未加密",$($("#root"+e+"Con .passwordCon input")[0]).addClass("passwordStatic"),
$($("#root"+e+"Con .passwordCon input")[0]).attr("readonly","readonly"),$("#root"+e+"Con .passwordCon .inputLi")[0].className="inputLi static";else{switch(parseInt(e)){case FREQ_2G:c.push(wdsSsidPwdDialog.twoGPwdInput);break;case FREQ_5G:c.push(wdsSsidPwdDialog.fiveGPwdInput);break;case FREQ_5G1:c.push(wdsSsidPwdDialog.fiveG1PwdInput);break;case FREQ_5G4:c.push(wdsSsidPwdDialog.fiveG2PwdInput);break;case FREQ_BS:c.push(wdsSsidPwdDialog.wdsPwdInput)}if(a&&($("#root"+e+"Con input")[1].value=gRootAPInfo[f].key,
gRootAPInfo[f].pwdErr))switch(parseInt(e)){case FREQ_2G:wdsSsidPwdDialog.twoGPwdInput.showNote("请输入正确的无线密码");break;case FREQ_5G:wdsSsidPwdDialog.fiveGPwdInput.showNote("请输入正确的无线密码");break;case FREQ_5G1:wdsSsidPwdDialog.fiveG1PwdInput.showNote("请输入正确的无线密码");break;case FREQ_5G4:wdsSsidPwdDialog.fiveG2PwdInput.showNote("请输入正确的无线密码");break;case FREQ_BS:wdsSsidPwdDialog.wdsPwdInput.showNote("请输入正确的无线密码")}}if(targetSelFreq[f].bs)break}$(wdsSsidPwdDialog).off("ev_wdsSsidPwdCancel").on("ev_wdsSsidPwdCancel",
function(){this.hide()});$(wdsSsidPwdDialog).off("ev_wdsSsidPwdSubmit").on("ev_wdsSsidPwdSubmit",function(){for(var a=0;a<c.length;++a)if(!c[a].checkAll())return;for(a=0;a<c.length;++a){var b=c[a].getValue(),e=$(c[a].dom).parent().parent().attr("id").replace(/[^0-9]/ig,"");e==FREQ_BS?slp.DOUBLE==slp.bandsProvided?(gRootAPInfo[FREQ_2G].key=b,gRootAPInfo[FREQ_2G].pwdErr=!1,gRootAPInfo[FREQ_2G].encryption=uciWireless.dynOptValue.encryption.on,gRootAPInfo[FREQ_5G].key=b,gRootAPInfo[FREQ_5G].pwdErr=!1,
gRootAPInfo[FREQ_5G].encryption=uciWireless.dynOptValue.encryption.on):(gRootAPInfo[FREQ_2G].key=b,gRootAPInfo[FREQ_2G].pwdErr=!1,gRootAPInfo[FREQ_2G].encryption=uciWireless.dynOptValue.encryption.on,gRootAPInfo[FREQ_5G1].key=b,gRootAPInfo[FREQ_5G1].pwdErr=!1,gRootAPInfo[FREQ_5G1].encryption=uciWireless.dynOptValue.encryption.on,gRootAPInfo[FREQ_5G4].key=b,gRootAPInfo[FREQ_5G4].pwdErr=!1,gRootAPInfo[FREQ_5G4].encryption=uciWireless.dynOptValue.encryption.on):(gRootAPInfo[e].key=b,gRootAPInfo[e].pwdErr=
!1,gRootAPInfo[e].encryption=uciWireless.dynOptValue.encryption.on)}wdsNextStep()})}if(slp.bandSteeringProvided&&"1"==gLocalAPInfo[BAND_STEER].bs_enable){if("1"==gLocalAPInfo[BAND_STEER].wifi_enable)for(var band in gKeyNames.wlan_wds)gKeyNames.wlan_wds.hasOwnProperty(band)&&null!=gKeyNames.wlan_wds[band]&&(scanWiFiList[band]=!0)}else for(band in gLocalAPInfo)gLocalAPInfo.hasOwnProperty(band)&&BAND_STEER!=band&&(scanWiFiList[band]="1"==gLocalAPInfo[band].enable);bInWizard=!0;
var wdsScanTable=new Table({targetId:"wdsScanTable",title:"请选择你需要中继的前端路由器：",head:[{field:label.wirelessNa,width:"0.37"},{field:label.bandInfo,width:"0.14"},{field:label.sigDep,width:"0.14",props:{"text-align":"center"}},{field:label.secInfo,width:"0.24"}],column:[{name:"ssid",type:"str"},{name:"freqInfo",type:"str"},{name:"signal",type:"signal"},{name:"authMode",type:"str"}],tableOption:[{icon:"icon-refresh",str:btn.refresh,type:"refresh",func:function(){refreshScanList()}}],clickList:{click_check:{func:function(a,
c,f){wdsSacnSelHandler(c,a)}}},loadingOptions:{str:label.scaningWiFiSignal},blankOptions:{str:label.nonWdsScanData},hasAllCheckBox:!1,editable:!1,hasCheckBox:!0,deletable:!1,addable:!1,hasFixedHeight:10,max:MAX_AP_ENTRY}),wdsSsidPwdDialog=new Dialog({title:"前端路由密码验证",content:'<span class="wdsSsidPwdDesc" id="wdsSsidPwdDialogDesc">请输入您选择的前端路由的Wi-Fi密码</span><div id="root4Con" class="disNone"><div id="wdsSsidCon" class="wdsSsidPwdInput"></div><div id="wdsPwdCon" class="wdsSsidPwdInput passwordCon"></div></div><div id="root0Con" class="disNone"><div id="twoGSsidCon" class="wdsSsidPwdInput"></div><div id="twoGPwdCon" class="wdsSsidPwdInput passwordCon"></div></div><div id="root1Con" class="disNone"><div id="fiveGSsidCon" class="wdsSsidPwdInput"></div><div id="fiveGPwdCon" class="wdsSsidPwdInput passwordCon"></div></div><div id="root2Con" class="disNone"><div id="fiveG1SsidCon" class="wdsSsidPwdInput"></div><div id="fiveG1PwdCon" class="wdsSsidPwdInput passwordCon"></div></div><div id="root3Con" class="disNone"><div id="fiveG2SsidCon" class="wdsSsidPwdInput"></div><div id="fiveG2PwdCon" class="wdsSsidPwdInput passwordCon"></div></div>',
size:Dialog.SIZE.SMALL,type:Dialog.TYPE.CUSTOM,bottom:[{type:component.Button.TYPE.SECONDARY,text:btn.cancel,id:"wdsSsidPwdCancel",onClick:function(){$(wdsSsidPwdDialog).trigger("ev_wdsSsidPwdCancel")}},{type:component.Button.TYPE.PRIMARY,text:btn.ok,id:"wdsSsidPwdSubmit",onClick:function(){$(wdsSsidPwdDialog).trigger("ev_wdsSsidPwdSubmit")}}],renderCallBack:function(){this.wdsSsidInput=new Input({type:Input.TYPE.STATIC_TEXT,label:{value:label.wirelessName},targetId:"wdsSsidCon",check:{blur:checkSsidInput},
props:{maxlength:"32",type:"text"}});this.wdsPwdInput=new Input({type:Input.TYPE.CIPHER_TEXT,label:{value:label.wirelessPwd},targetId:"wdsPwdCon",check:{blur:onPwdBlur,keyup:onPwdKeyup},props:{maxlength:"63",type:"text"}});this.twoGSsidInput=new Input({type:Input.TYPE.STATIC_TEXT,label:{value:label.wirelessName2G},targetId:"twoGSsidCon",check:{blur:checkSsidInput},props:{maxlength:"32",type:"text"}});this.twoGPwdInput=new Input({type:Input.TYPE.CIPHER_TEXT,label:{value:label.wirelessPwd},targetId:"twoGPwdCon",
check:{blur:onPwdBlur,keyup:onPwdKeyup},props:{maxlength:"63",type:"text"}});this.fiveGSsidInput=new Input({type:Input.TYPE.STATIC_TEXT,label:{value:label.wirelessName5G},targetId:"fiveGSsidCon",check:{blur:checkSsidInput},props:{maxlength:"32",type:"text"}});this.fiveGPwdInput=new Input({type:Input.TYPE.CIPHER_TEXT,label:{value:label.wirelessPwd},targetId:"fiveGPwdCon",check:{blur:onPwdBlur,keyup:onPwdKeyup},props:{maxlength:"63",type:"text"}});this.fiveG1SsidInput=new Input({type:Input.TYPE.STATIC_TEXT,
label:{value:label.wirelessName5G1},targetId:"fiveG1SsidCon",check:{blur:checkSsidInput},props:{maxlength:"32",type:"text"}});this.fiveG1PwdInput=new Input({type:Input.TYPE.CIPHER_TEXT,label:{value:label.wirelessPwd},targetId:"fiveG1PwdCon",check:{blur:onPwdBlur,keyup:onPwdKeyup},props:{maxlength:"63",type:"text"}});this.fiveG2SsidInput=new Input({type:Input.TYPE.STATIC_TEXT,label:{value:label.wirelessName5G2},targetId:"fiveG2SsidCon",check:{blur:checkSsidInput},props:{maxlength:"32",type:"text"}});
this.fiveG2PwdInput=new Input({type:Input.TYPE.CIPHER_TEXT,label:{value:label.wirelessPwd},targetId:"fiveG2PwdCon",check:{blur:onPwdBlur,keyup:onPwdKeyup},props:{maxlength:"63",type:"text"}})}});
wdsSsidPwdDialog.refresh=function(){for(var a=FREQ_2G;a<=FREQ_BS;a++)$("#root"+a+"Con").addClass("disNone"),$($("#root"+a+"Con .passwordCon input")[0]).removeClass("passwordStatic"),$("#root"+a+"Con input")[1].value="",$($("#root"+a+"Con input")[1]).attr("readonly",!1),$("#root"+a+"Con .passwordCon .inputLi")[0].className="inputLi";this.wdsSsidInput.setValue("");this.wdsPwdInput.setValue("");this.twoGSsidInput.setValue("");this.twoGPwdInput.setValue("");this.fiveGSsidInput.setValue("");this.fiveGPwdInput.setValue("");
this.fiveG1SsidInput.setValue("");this.fiveG1PwdInput.setValue("");this.fiveG2SsidInput.setValue("");this.fiveG2PwdInput.setValue("");this.wdsSsidInput.closeNote();this.wdsPwdInput.closeNote();this.twoGSsidInput.closeNote();this.twoGPwdInput.closeNote();this.fiveGSsidInput.closeNote();this.fiveGPwdInput.closeNote();this.fiveG1SsidInput.closeNote();this.fiveG1PwdInput.closeNote();this.fiveG2SsidInput.closeNote();this.fiveG2PwdInput.closeNote()};
var wdsBtnBack=new Button({text:btn.cancel,onClick:function(){gStartWirelessRepeater=!0;menuLoad("WanLoader.htm")},type:Button.TYPE.SECONDARY,id:"wdsBtnBack",props:{width:"120px"}}),wdsBtnNext=new Button({text:btn.nextStep,onClick:function(){this._ops.type==Button.TYPE.SECONDARY?showToast("请选择您要中继的条目"):nextStep()},type:Button.TYPE.SECONDARY,id:"wdsBtnNext",props:{width:"240px"}});refreshScanList();
</script><style type="text/css">#root0Con.pwdStatic,#root1Con.pwdStatic,#root2Con.pwdStatic,#root3Con.pwdStatic,#root4Con.pwdStatic i.eye{display:none}li.inputLi>input.passwordStatic{border:0}li.inputLi>input.passwordStatic+i.eye{display:none}span.wdsSsidPwdDesc{display:block;height:20px;line-height:20px;margin-bottom:16px}div.wdsSsidPwdInput label.outerLbl{width:96px}i.radio[name="wdsScanRadio"]{cursor:pointer}</style>