

<div id="deviceListWrapper" class="clearfix">
	<div class="deviceListWrapperHead">
		<span id="deviceListBack"><i class="iconfont icon-back"></i><span class="deviceListBackText">{%btn.backToHome%}</span></span>
	</div>
	<div class="head deviceList">
		<div class="title"><h1>{%label.deviceList%}</h1></div>
	</div>
	<div id="deviceListTabCon"></div>
	<div class="selectCon">
		<ul class="inputCMPT medium selectUl" id="deviceLinkTypeSelCon">
			<li class="inputLi">
				<span class="selectWrap">
					<span id="deviceLinkTypeSel" class="select">
						<span class="value"></span>
						<i class="arrow iconfont icon-folddropdown"></i>
					</span>
				</span>
			</li>
		</ul>
	</div>
	<div id="deviceTableCon">
		<div id="hostDeviceTable"></div>
		<div id="guestDeviceTable"></div>
		<div id="forbidDeviceTable"></div>
	</div>
</div>
<script type="text/javascript">"function"!=typeof advanceAutoFit&&(advanceAutoFit=function(){var n=$("#header").height(),O=$("#footer").height(),S=document.documentElement.clientHeight;$(".wrapper").css("min-height",S);n=$(".wrapper").height()-n-O+"px";$(".dividingLine").css("height",n)});"function"!=typeof resizeWindow&&(resizeWindow=function(){window.onresize=function(){null==id("advanceWrapper")&&null==id("deviceListWrapper")||advanceAutoFit()};$("#deviceListWrapper").resize(advanceAutoFit)},resizeWindow());
(function(){function n(a){var c="";switch(parseInt(a)){case ENONE:return!0;case ESYSTEM:c=errStr.systemErr;break;case ENOMEMORY:c=errStr.invMemoryOut;break;case ENOECHO:c=errStr.invRequestTimeout;break;case ESYSBUSY:c=errStr.systemBusy;break;case EENTRYEXIST:c=errStr.entryExistErr;break;case EENTRYNOTEXIST:c=errStr.entryNoExistErr;break;case EENTRYCONFLIC:c=errStr.entryConflicErr;break;case ETABLEFULL:c=errStr.tableFullErr;break;case ELACKARG:c=errStr.acIncompleteArg;break;case ETIMEPERIODBLANK:c=
errStr.timePeriodBlank;break;case ETIMEPERIODTOOLONG:c=errStr.timePeriodTooLong;break;case EINVTLBEGINTIME:c=errStr.invTlBeginTime;break;case EINVTLEENDTIME:c=errStr.invTlEndTime;break;case EINVTLBEGINENDTIME:c=errStr.invTlBeginEndTime;break;case ETLREPEATBLANK:c=errStr.tlRepeatBlank;break;default:c=errStr.invRequestFail}closeLoading();alarmDialog.show(c);return!1}function O(a){if(null==g[s].deviceLinkTypeArray)return!0;var c=da.value;if(-1!=c)if(a.type==uciHostsInfo.optValue.linkType.wired){if(0!=
c)return!1}else if(a.wifi_mode==uciHostsInfo.optValue.wifiMode.h2G&&1!=c||a.wifi_mode==uciHostsInfo.optValue.wifiMode.h5G&&2!=c||a.wifi_mode==uciHostsInfo.optValue.wifiMode.h5G1&&3!=c||a.wifi_mode==uciHostsInfo.optValue.wifiMode.h5G2&&4!=c)return!1;return!0}function S(a){s=a.getCurrentIndex();null!=g[s].table&&(g[s].table._ops.currentPage=1);null!=g[s].deviceLinkTypeArray?($("#deviceLinkTypeSelCon").fadeIn(),da.resetOptions(g[s].deviceLinkTypeArray,-1)):$("#deviceLinkTypeSelCon").fadeOut(50);1==slp.moduleSpec.wifison_mesh&&
(g[a.getCurrentIndex()].pageType==E?$("#routerSelCon").fadeOut(50):$("#routerSelCon").fadeIn());slp.macFilterSupport&&g[s].pageType==E?($("#modeSelCon").fadeIn(),A==uciCustomNetwork.optValue.owner.andlink&&B==uciCustomNetwork.optValue.macFilterConfig.on&&id("modeSel").disable(!0)):$("#modeSelCon").fadeOut(50);slp.macFilterSupport&&(l==y?$("#forbidDeviceTable").hide():T());p=!1;r(a)}function r(a){function c(c,b){C=$.setTimeout(r,1E3);if(!p){m.length=0;k=formatTableData(c);for(var e=0;e<k.length;e++)m[e]=
{},m[e].type=k[e].type,m[e].blocked=k[e].blocked,m[e].name=""==k[e].hostname?label.anonymousHost:k[e].hostname,m[e].ip=k[e].ip,m[e].ipv6=k[e].ipv6||"::",m[e].mac=k[e].mac,m[e].up=k[e].up_speed,m[e].upLimit=k[e].up_limit,m[e].down=k[e].down_speed,m[e].downLimit=k[e].down_limit,m[e].online=uciHostsInfo.optValue.online.yes,m[e].isCurHost=k[e].is_cur_host,m[e].cfgValid=k[e].cfg_valid,m[e].cfgname=k[e].mac,m[e].wifi_mode=k[e].wifi_mode,slp.macFilterSupport&&(m[e][".name"]=k[e][".name"],m[e].owner=k[e].owner),
D&&(m[e].upLimit=0,m[e].downLimit=0);for(e=0;e<m.length;e++){h=m[e];d=h.mac;if(0==d.length||"00-00-00-00-00-00"==d)break;h.blocked==uciHostsInfo.optValue.isBlocked.no?h.online==uciHostsInfo.optValue.online.yes&&(h.type==uciHostsInfo.optValue.linkType.wired||h.type==uciHostsInfo.optValue.linkType.hostWireless?ea++:q++):n++;g[s].deviceFilter(h)&&(A==uciCustomNetwork.optValue.owner.andlink&&B==uciCustomNetwork.optValue.macFilterConfig.on&&(h.checkboxDisabled=!0,h.checkboxDisabledChecked=!1),"1"==h.isCurHost||
d.toUpperCase()==g_cur_host_mac.toUpperCase()?f=h:P.push(h))}slp.macFilterSupport&&g[a.getCurrentIndex()].pageType==E||P.sort(function(a,c){for(var b=a.ip.split("."),d=c.ip.split("."),f=0;4>f;f++)if(parseInt(b[f],10)!=parseInt(d[f],10))return parseInt(b[f],10)>parseInt(d[f],10)?-1:1;return 0});void 0!=f&&(l==u&&(f.checkboxDisabled=!0,f.checkboxDisabledChecked=!1),P.push(f));if(1==slp.moduleSpec.wifison_mesh&&-1!=v&&g[a.getCurrentIndex()].pageType!=E)e=oa(formatTableData(b)),$("#hostDeviceNum").text(e.hostNum),
F&&$("#guestDeviceNum").text(e.guestNum),$("#forbidDeviceNum").text(e.forbidNum);else{$("#hostDeviceNum").text(ea);F&&$("#guestDeviceNum").text(q);if(slp.macFilterSupport)if(l==t)for(e=n=0;e<w.length;e++)w[e].owner==uciCustomNetwork.optValue.owner.web&&n++;else if(l==u)for(e=n=0;e<z.length;e++)z[e].owner==uciCustomNetwork.optValue.owner.web&&n++;else n=0;$("#forbidDeviceNum").text(n)}void 0!=g[s].table&&(g[s].table.setDataSource(P),g[s].table.loadData(g[s].table.getCurrentPage()),A==uciCustomNetwork.optValue.owner.andlink&&
B==uciCustomNetwork.optValue.macFilterConfig.on&&(G.selAllCheckBoxObj.disable(!1),$("#forbidDeviceTable .tableOption").addClass("disabled")));$("#deviceTableCon").css("height",$("#"+g[s].tableId).css("height"));1==slp.moduleSpec.wifison_mesh&&"idle"==id("routerSel").state&&id("routerSel").resetOptions(K,v)}}var b={},d,f,h,k,P=[],ea=0,q=0,n=0;a=a||fa;null!=C&&(clearTimeout(C),C=null);1==slp.moduleSpec.wifison_mesh&&g[a.getCurrentIndex()].pageType!=E?(b[uciPlc.fileName]={},b[uciPlc.fileName][KEY_TABLE]=
[uciPlc.secType.connectedExt],b[uciHostsInfo.fileName]={},b[uciHostsInfo.fileName][KEY_TABLE]=uciHostsInfo.dynData.host_info,b[uciHostsInfo.fileName][KEY_NAME]=uciHostsInfo.dynData.capHostNum,slp.macFilterSupport&&(b[uciCustomNetwork.fileName]={},b[uciCustomNetwork.fileName][KEY_TABLE]=[uciCustomNetwork.dynData.macFilterBlackEntry,uciCustomNetwork.dynData.macFilterWhiteEntry]),$.query(b,function(d){var f=!1,e="";H=formatTableData(d[uciPlc.fileName][uciPlc.secType.connectedExt]);e=d[uciHostsInfo.fileName][uciHostsInfo.dynData.capHostNum];
slp.macFilterSupport&&(blRawData=d[uciCustomNetwork.fileName][uciCustomNetwork.dynData.macFilterBlackEntry],wlRawData=d[uciCustomNetwork.fileName][uciCustomNetwork.dynData.macFilterWhiteEntry],w=formatTableData(blRawData),z=formatTableData(wlRawData));K=[];K.push({str:label.allRouter,value:-1});e=ga+label.lBrackets+(g[a.getCurrentIndex()].pageType==U?e.host_num:e.guest_num)+label.rBrackets;K.push({str:ha(e),value:0,title:e});for(e=0;e<H.length;e++){var h=H[e].name||label.reRouter,h=h+(label.lBrackets+
(g[a.getCurrentIndex()].pageType==U?H[e].sta_num_host:H[e].sta_num_guest)+label.rBrackets);K.push({str:ha(h),value:H[e].mac,title:h});String(v).toUpperCase()==H[e].mac.toUpperCase()&&(f=!0)}f||-1==v||0==v||(showToast(label.deviceOffline),v=-1);b={};b[uciHostsInfo.fileName]={};-1==v?c(d[uciHostsInfo.fileName][uciHostsInfo.dynData.host_info]):(0==v?b[uciHostsInfo.fileName].get_cap_host=null:(b[uciHostsInfo.fileName].get_ext_host={},b[uciHostsInfo.fileName].get_ext_host.mac=v),$.action(b,function(a){0==
v?c(a[uciHostsInfo.fileName].get_cap_host,d[uciHostsInfo.fileName][uciHostsInfo.dynData.host_info]):c(a[uciHostsInfo.fileName].get_ext_host,d[uciHostsInfo.fileName][uciHostsInfo.dynData.host_info])},!0))})):(b[uciHostsInfo.fileName]={},b[uciHostsInfo.fileName][KEY_TABLE]=uciHostsInfo.dynData.host_info,slp.macFilterSupport&&(b[uciCustomNetwork.fileName]={},b[uciCustomNetwork.fileName][KEY_TABLE]=[uciCustomNetwork.dynData.macFilterBlackEntry,uciCustomNetwork.dynData.macFilterWhiteEntry]),$.query(b,
function(a){var b=[],d=[],f=[],b=a[uciHostsInfo.fileName][uciHostsInfo.dynData.host_info];slp.macFilterSupport&&(d=a[uciCustomNetwork.fileName][uciCustomNetwork.dynData.macFilterBlackEntry],f=a[uciCustomNetwork.fileName][uciCustomNetwork.dynData.macFilterWhiteEntry],w=formatTableData(d),z=formatTableData(f));c(b.concat(d,f))}))}function oa(a){for(var c=0,b=0,d=0,f=0;f<a.length;f++)a[f].blocked==uciHostsInfo.optValue.isBlocked.no?a[f].type==uciHostsInfo.optValue.linkType.wired||a[f].type==uciHostsInfo.optValue.linkType.hostWireless?
c++:b++:d++,slp.macFilterSupport&&(d=l==t?w.length:l==u?z.length:0);return{hostNum:c,guestNum:b,forbidNum:d}}function ha(a){var c="",b=[],d="",f=0;if(130>calStrLenPixel(a,13))return a;c=a.split("");for(a=0;a<c.length;a++){f+=calStrLenPixel(c[a],13);if(60<f)break;d+=c[a]}d+=" ... ";f=0;c=c.reverse();for(a=0;a<c.length;a++){f+=calStrLenPixel(c[a],13);if(60<f)break;b.push(c[a])}return d+=b.reverse().join("")}function pa(a,c){var b;a.name==c||a.name==uciHostsInfo.optValue.name.defname&&0>=c.length||(getCNStrLen(c)>
DEVICE_NAME_LEN_MAX?alarmDialog.show(errorStr.hostNameLenExceed):(a.name=c,b={hosts_info:{set_name:{mac:a.mac,name:a.name,down_limit:a.downLimit,up_limit:a.upLimit,is_blocked:a.blocked}}},$.action(b,function(a){a[ERR_CODE]==ENONE&&showToast(label.saveSuccess)})))}function V(a,c){var b=a.getValue();pa(c,b);p=!1}function L(a){a=parseInt(a);a=1073741824<=a?(a/1073741824).toFixed(1)+"GB/s":1048576<=a?(a/1048576).toFixed(1)+"MB/s":(a/1024).toFixed(1)+"KB/s";return a.toString()}function qa(a,c,b){var d,
f=!1,h=!1;d=b.upLimit;0<a.length?d!=a&&(f=!0,b.upLimit=a):"0"!=d&&(f=!0,b.upLimit="0");d=b.downLimit;a=c;0<a.length?d!=a&&(h=!0,b.downLimit=a):"0"!=d&&(h=!0,b.downLimit="0");!1==f&&!1==h||$.action({hosts_info:{set_flux_limit:{mac:b.mac,down_limit:b.downLimit,up_limit:b.upLimit,name:b.name,is_blocked:b.blocked}}},function(a){a[ERR_CODE]==ENONE&&showToast(label.saveSuccess)})}function ia(a,c,b){var d;d=a.getValue();$(a.dom).find("li.inputLi").hasClass("static")?a=d==label.noSpeedLimit?0:d.replace(label.unitKBs,
""):(0<d.length&&!checkNum(d)&&a.setValue(b.upLimit),d>MAX_WAN_RATE&&a.setValue(MAX_WAN_RATE),a=a.getValue());d=c.getValue();$(c.dom).find("li.inputLi").hasClass("static")?c=d==label.noSpeedLimit?0:d.replace(label.unitKBs,""):(0<d.length&&!checkNum(d)&&c.setValue(b.downLimit),d>MAX_WAN_RATE&&c.setValue(MAX_WAN_RATE),c=c.getValue());qa(a,c,b);p=!1}function W(a,c){if(slp.macFilterSupport){var b,d,f,h;d=a.split("-");var k=[];l==t?(f="black",h=label.unforbidSuccess):(f="white",h=label.deleteSuccess);
for(var g=0;g<d.length;g++)b=d[g],b=G.data[b],k.push({hostname:b.name,mac:b.mac,enable:"on"});callback=c;for(g=0;g<k.length;g++)d=k[g],b={},b[uciCustomNetwork.fileName]={},b[uciCustomNetwork.fileName][KEY_NAME]=f+"_"+d.mac.replace(/-/g,"").toLowerCase(),0==g&&showLoading(),$.del(b,function(a){a[ERR_CODE]==ENONE?g==k.length-1&&(closeLoading(),showToast(h),"function"==typeof callback&&callback(),r()):n(a[ERR_CODE])},!1)}else f=G.data[a],f.blocked=uciHostsInfo.optValue.isBlocked.no,b={hosts_info:{set_block_flag:{mac:f.mac,
is_blocked:f.blocked,name:f.name,down_limit:f.downLimit,up_limit:f.upLimit}}},$.action(b,function(a){a[ERR_CODE]==ENONE&&(showToast(label.unforbidSuccess),r())})}function ja(a,c){var b;slp.macFilterSupport?l==t?(b={},b[uciCustomNetwork.fileName]={},b[uciCustomNetwork.fileName][KEY_TABLE]=uciCustomNetwork.dynData.macFilterBlackEntry,b[uciCustomNetwork.fileName][KEY_NAME]="black_"+c.mac.replace(/-/g,"").toLowerCase(),b[uciCustomNetwork.fileName][KEY_PARA]={hostname:c.name,mac:c.mac,enable:"on",owner:uciCustomNetwork.optValue.owner.web,
accessright:uciCustomNetwork.optValue.accessRight.allForbid},showLoading(),$.add(b,function(a){a[ERR_CODE]==ENONE?(closeLoading(),showToast(label.forbidSuccess),r()):n(a[ERR_CODE])})):l==u&&(b={},b[uciCustomNetwork.fileName]={},b[uciCustomNetwork.fileName][KEY_NAME]="white_"+c.mac.replace(/-/g,"").toLowerCase(),contentStr=label.forbidItemWarn+"“"+I.data[a].name+"”？",confirmDialog.show({content:contentStr,callback:function(a){a&&(showLoading(),$.del(b,function(a){a[ERR_CODE]==ENONE?(closeLoading(),
showToast(label.forbidSuccess),r()):n(a[ERR_CODE])}))}})):(c.blocked=uciHostsInfo.optValue.isBlocked.yes,b={hosts_info:{set_block_flag:{mac:c.mac,is_blocked:c.blocked,name:c.name,down_limit:c.downLimit,up_limit:c.upLimit}}},$.action(b,function(a){a[ERR_CODE]==ENONE&&showToast(label.forbidSuccess);r()}))}function ka(a){if(0==w.length)return!1;for(var c=0;c<w.length;c++)if(a.toUpperCase()==w[c].mac.toUpperCase())return!0;return!1}function X(a,c){if(0==z.length)return!1;for(var b=0;b<z.length;b++)if(a.toUpperCase()==
z[b].mac.toUpperCase())if(c){if(z[b].owner==uciCustomNetwork.optValue.owner.andlink)return!0}else return!0;return!1}function la(a){for(var c,b=0;b<x.length;b++)item=x[b],c={},c[uciCustomNetwork.fileName]={},c[uciCustomNetwork.fileName][KEY_TABLE]=uciCustomNetwork.dynData.macFilterBlackEntry,c[uciCustomNetwork.fileName][KEY_NAME]="black_"+item.mac.replace(/-/g,"").toLowerCase(),c[uciCustomNetwork.fileName][KEY_PARA]={hostname:item.hostname,mac:item.mac,enable:item.enable,owner:uciCustomNetwork.optValue.owner.web,
accessright:uciCustomNetwork.optValue.accessRight.allForbid},0==b&&showLoading(),$.add(c,function(c){c[ERR_CODE]==ENONE?b==x.length-1&&(showToast(label.addSuccess),r()):n(c[ERR_CODE]);closeLoading();"function"==typeof a&&a()},!1)}function Y(a){var c;if(0==x.length)"function"==typeof a&&a();else for(var b=0;b<x.length;b++)item=x[b],c={},c[uciCustomNetwork.fileName]={},c[uciCustomNetwork.fileName][KEY_TABLE]=uciCustomNetwork.dynData.macFilterWhiteEntry,c[uciCustomNetwork.fileName][KEY_NAME]="white_"+
item.mac.replace(/-/g,"").toLowerCase(),c[uciCustomNetwork.fileName][KEY_PARA]={hostname:item.hostname,mac:item.mac,enable:item.enable,owner:uciCustomNetwork.optValue.owner.web,accessright:uciCustomNetwork.optValue.accessRight.allAllow},0==b&&showLoading(),$.add(c,function(c){c[ERR_CODE]==ENONE?b==x.length-1&&(showToast(label.addSuccess),r()):n(c[ERR_CODE]);closeLoading();"function"==typeof a&&a()},!1)}function Z(a,c){var b={};b[uciHostsInfo.fileName]={};b[uciHostsInfo.fileName][KEY_TABLE]=uciHostsInfo.dynData.online_host;
$.query(b,function(b){b=formatTableData(b[uciHostsInfo.fileName][uciHostsInfo.dynData.online_host]);for(var f,h=0;h<b.length;h++)b[h].hostname=""==b[h].hostname?label.anonymousHost:b[h].hostname,b[h].mac.toUpperCase()==g_cur_host_mac.toUpperCase()&&(f=b[h],b.splice(h,1));f&&(f.checkboxDisabled=!0,f.checkboxDisabledChecked=a==J?!1:!0,b.push(f));q[a].table.setDataSource(b);q[a].table.loadData(1);a==J&&1==b.length?alarmDialog.show({content:label.noDevAddToBlackList,hasCloseIcon:!1}):c||q[a].dialog.show()})}
function ma(a){var c=Q,b={};b[uciCustomNetwork.fileName]={};b[uciCustomNetwork.fileName][KEY_TABLE]=uciCustomNetwork.dynData.macFilterWhiteBlockList;$.query(b,function(b){b[ERR_CODE]==ENONE?null!=b[uciCustomNetwork.fileName]&&null!=b[uciCustomNetwork.fileName][uciCustomNetwork.dynData.macFilterWhiteBlockList]&&(b=formatTableData(b[uciCustomNetwork.fileName][uciCustomNetwork.dynData.macFilterWhiteBlockList]),b.forEach(function(a,b){var c;a:{c=MacFactoryArr.length;var d=a.mac.substring(0,8).toUpperCase(),
g;if(void 0!=MacBrands)for(var d=d.replace(/:/g,"-"),l=0;l<c;l++)if(void 0!=(g=MacBrands[MacFactoryArr[l].name])&&0<=g.indexOf(d)){c=MacFactoryArr[l].ch;break a}c="-"}a.hostname=c;a.intervalStr=86400<=a.interval?String(parseInt(a.interval/86400))+"天前":3600<=a.interval?String(parseInt(a.interval/3600))+"小时前":60<=a.interval?String(parseInt(a.interval/60))+"分钟前":"刚刚"}),q[c].table.setDataSource(b),q[c].table.loadData(1),0==b.length?alarmDialog.show({content:label.noDevAddToWhiteList,hasCloseIcon:!1}):
a||q[c].dialog.show()):n(b[ERR_CODE])})}function ra(){ma(!0)}function aa(a){var c,b,d;a==J?(idPrefix="addOnlineDevToBlackList",c="addOnlineDevToBlackListTable",b=label.addBlackListDev,d='<div id="'+c+'"></div>'):a==M?(idPrefix="addOnlineDevToWhiteList",c="addOnlineDevToWhiteListTable",b=label.addWhiteListDev,d='<div class="dialogHeadTips">{%label.addOnlineDevToWhiteListTips%}</div><div id="'+c+'"></div>'):(idPrefix="addBlockedDevToWhiteList",c="addBlockedDevToWhiteListTable",b=label.addWhiteListDev,
d='<div class="dialogHeadTips">{%label.addBlockedDevToWhiteListTips%}</div><div id="'+c+'"></div>');c=idPrefix+"Table";cancelBtnId=idPrefix+"Cancel";confirmBtnId=idPrefix+"Confirm";q[a].dialog=new Dialog({title:b,content:d,size:component.Dialog.SIZE.MEDIUM,type:component.Dialog.TYPE.CUSTOM,hasCloseIcon:!0,bottom:[{type:component.Button.TYPE.SECONDARY,text:btn.cancelTip,id:cancelBtnId,onClick:function(){a==M&&id("modeSel").changeSel(l);q[a].dialog.hide()}},{type:component.Button.TYPE.PRIMARY,text:btn.confirmTip,
id:confirmBtnId,onClick:function(){var b=q[a].table._getSelectItem().selArrStr.split("-");if(1==b.length&&""==b[0])q[a].dialog.hide();else{x=[];for(var c=0;c<b.length;c++){var d=q[a].table.data[b[c]];(a!=J||ka(d.mac))&&(a!=M&&a!=Q||X(d.mac))||x.push({hostname:d.hostname,mac:d.mac,enable:"on"})}q[a].dialog.hide();a==J?la():a==M?Y(function(){R("on",u)}):Y()}}}],renderCallBack:function(){q[a].table=a==Q?new Table({targetId:c,head:[{field:label.deviceBrand,width:"0.4"},{field:label.mac,width:"0.3"},{field:label.interval,
width:"0.3"}],column:[{name:"hostname",type:"str",onRender:function(a,b){return void 0!=g_cur_host_mac&&a.mac.toUpperCase()==g_cur_host_mac.toUpperCase()?'<span style="color:#FF3366;margin-right:2px;">['+label.bHost+"]</span>"+b:b}},{name:"mac",type:"str"},{name:"intervalStr",type:"str"}],hasCheckBox:!0,editable:!1,addable:!1,deletable:!1,tableOption:[{icon:"icon-refresh",type:"refresh",str:btn.refresh,func:ra,selRelate:!1}],numPerPage:8}):new Table({targetId:c,head:[{field:label.deviceName,width:"0.4"},
{field:label.ipAddr,width:"0.3"},{field:label.mac,width:"0.3"}],column:[{name:"hostname",type:"str",onRender:function(a,b){return void 0!=g_cur_host_mac&&a.mac.toUpperCase()==g_cur_host_mac.toUpperCase()?'<span style="color:#FF3366;margin-right:2px;">['+label.bHost+"]</span>"+b:b}},{name:"ip",type:"str"},{name:"mac",type:"str"}],hasCheckBox:!0,editable:!1,addable:!1,deletable:!1,tableOption:[{icon:"icon-refresh",type:"refresh",str:btn.refresh,func:function(){Z(a,!0)},selRelate:!1}],numPerPage:8})}})}
function sa(a,c,b,d){p=!1;l==t&&c.mac.toUpperCase()==g_cur_host_mac.toUpperCase()?(alarmDialog.show({content:label.forbidAddCurHostToBlackList}),d()):(x=[{hostname:c.name,mac:c.mac,enable:"on"}],l==t?la(d):Y(d))}function T(){id("forbidDeviceTable").innerHTML="";if(slp.macFilterSupport){if(l==y)return;l==t?(titleStr=label.blackListTitle,delStr=btn.releaseSel,clickListDelIcon="icon-liftaban",clickListDelStr=btn.unforbid):l==u&&(titleStr=label.whiteListTitle,delStr=btn.deleteSel,clickListDelIcon="icon-delete",
clickListDelStr=btn.clear);G=new Table({targetId:"forbidDeviceTable",title:titleStr,hasCheckBox:!0,editable:!1,deletable:!0,addable:!0,addOption:{icon:"icon-edit",str:btn.manualAdd},deleteOption:{icon:"icon-liftaban",str:delStr},tableOption:[{icon:"icon-add",type:"add",str:btn.addDevice,func:function(){l==t?(type=J,Z(type)):ma()},selRelate:!1,index:3}],head:[{field:label.deviceName,width:"0.6"},{field:label.mac,width:"0.4"}],column:[{name:"name",type:"str",maxLength:slp.hostnameMaxLen,isAllowBlank:!1,
isAllowAllSpace:!1,check:{blur:function(){var a=this.getValue();return getCNStrLen(a)>slp.hostnameMaxLen?(this.showNote(errorStr.hostNameLenExceed),!1):!0}},onRender:function(a,c){return void 0!=g_cur_host_mac&&a.mac.toUpperCase()==g_cur_host_mac.toUpperCase()?'<span style="color:#FF3366;margin-right:2px;">['+label.bHost+"]</span>"+c:c}},{name:"mac",type:"mac"}],clickList:{click_del_item:{icon:clickListDelIcon,str:clickListDelStr,func:function(a,c){if(l==t)W(a,c);else{var b,d=a.split("-");1<d.length?
b=label.removeItemsWarn:1==d.length&&""!=d[0]&&(b=label.removeItemWarn+"“"+G.data[d[0]].name+"”？");confirmDialog.show({content:b,callback:function(b){b&&W(a,c)}})}},asyn:!0,onRender:function(a){return A==uciCustomNetwork.optValue.owner.andlink&&B==uciCustomNetwork.optValue.macFilterConfig.on?!1:void 0!=g_cur_host_mac&&a.mac.toUpperCase()==g_cur_host_mac.toUpperCase()?!1:!0}},click_cancel:{func:function(){p=!1}},click_save:{func:sa,asyn:!0},click_add_item:{func:function(a){p=!0;a(!0)},asyn:!0},click_check:{func:function(a,
c){p=a}}},allCheckCallback:function(a){p=a}})}else G=new Table({targetId:"forbidDeviceTable",hasCheckBox:!1,tableOptionShow:!1,editable:!1,deletable:!0,addable:!1,head:[{field:label.deviceName,width:"1"}],column:[{name:"basicInfo",type:"deviceBasicInfo",onClick:function(){p=!0},onSave:V}],type:Table.TYPE.DEVICE,clickList:{click_del_item:{icon:"icon-liftaban",str:btn.unforbid,func:W,asyn:!0}}});g[F?2:1].table=G}function R(a,c){showLoading(statusStr.waiting,void 0,void 0,!1);var b={},d={enable:a,owner:uciCustomNetwork.optValue.owner.web};
"on"==a&&(d.policy=c,na&&(b[uciWlanAccess.fileName]={},b[uciWlanAccess.fileName][uciWlanAccess.optName.config]={},b[uciWlanAccess.fileName][uciWlanAccess.optName.config][uciWlanAccess.optName.enable]=0));b[uciCustomNetwork.fileName]={};b[uciCustomNetwork.fileName][uciCustomNetwork.secName.macFilterConfig]=d;$.modify(b,function(a){a.error_code==ENONE&&(l=c,A=uciCustomNetwork.optValue.owner.web,c==y?(a={},a[uciCustomNetwork.fileName]={},a[uciCustomNetwork.fileName][KEY_TABLE]=["mac_filter_black_entry",
"mac_filter_white_entry"],$.del(a,function(a){a.error_code==ENONE&&$("#forbidDeviceTable").hide()})):(T(),r(),$("#forbidDeviceTable").show()),closeLoading())})}function ba(a,c){if(c==t)if(ka(g_cur_host_mac.toUpperCase())){for(var b,d=0;d<w.length;d++)if(g_cur_host_mac.toUpperCase()==w[d].mac.toUpperCase()){b=w[d];break}alarmDialog.show({content:label.checkCurHost+b.hostname+label.curHostInBlackList,hasCloseIcon:!1,callback:function(){var b={};b[uciCustomNetwork.fileName]={};b[uciCustomNetwork.fileName][KEY_NAME]=
"black_"+g_cur_host_mac.replace(/-/g,"").toLowerCase();showLoading();$.del(b,function(b){b[ERR_CODE]==ENONE?(closeLoading(),R(a,c)):n(b[ERR_CODE])})}})}else R(a,c);else c==u?Z(M):R(a,c)}function ta(a){var c,b,d;b=a;c=a==y?"off":"on";b!=l&&(l==y?(a={},a[uciWlanAccess.fileName]={},a[uciWlanAccess.fileName][KEY_NAME]=uciWlanAccess.optName.config,$.query(a,function(a){if(a[ERR_CODE]==ENONE)if(na=parseInt(a[uciWlanAccess.fileName][uciWlanAccess.optName.config][uciWlanAccess.optName.enable])){if(b==t)d=
label.WACSwitchToBlackList;else if(b=u)d=label.WACSwitchToWhiteList;confirmDialog.show({content:d,callback:function(a){a?ba(c,b):id("modeSel").changeSel(l)}})}else ba(c,b)})):ba(c,b))}var p=!1,C,F=!1,D=!1,ca={},s=0,m=[],fa,I={},N={},G={},da=id("deviceLinkTypeSel"),U=0,E=2,ga=document.title,v=-1,K=[{str:label.allRouter,value:-1}],H,l,A,B,w,z,x,na,q=[{dialog:null,table:null},{dialog:null,table:null},{dialog:null,table:null}],t=0,u=1,y=2,J=0,M=1,Q=2,ua=[{str:label.blackList,value:t},{str:label.whiteList,
value:u},{str:label.off,value:y}],g=[{tabName:label.deviceHost+"(<span id='hostDeviceNum'>0</span>)",tableId:"hostDeviceTable",deviceFilter:function(a){return a.online!=uciHostsInfo.optValue.online.yes||a.blocked!=uciHostsInfo.optValue.isBlocked.no||a.type!=uciHostsInfo.optValue.linkType.wired&&a.type!=uciHostsInfo.optValue.linkType.hostWireless?!1:O(a)},deviceLinkTypeArray:null,pageType:U},{tabName:label.deviceGuest+"(<span id='guestDeviceNum'>0</span>)",tableId:"guestDeviceTable",deviceFilter:function(a){return a.online==
uciHostsInfo.optValue.online.yes&&a.blocked==uciHostsInfo.optValue.isBlocked.no&&a.type==uciHostsInfo.optValue.linkType.guestWireless?O(a):!1},deviceLinkTypeArray:null,pageType:1},{tabName:label.deviceForbided+"(<span id='forbidDeviceNum'>0</span>)",tableId:"forbidDeviceTable",deviceFilter:function(a){return a.blocked==uciHostsInfo.optValue.isBlocked.yes?O(a):!1},deviceLinkTypeArray:null,pageType:E},{tabName:label.blackWhiteList+"(<span id='forbidDeviceNum'>0</span>)",tableId:"forbidDeviceTable",
deviceFilter:function(a){return l==t&&-1<a[".name"].indexOf("black")&&a.owner==uciCustomNetwork.optValue.owner.web||l==u&&-1<a[".name"].indexOf("white")&&a.owner==uciCustomNetwork.optValue.owner.web?!0:!1},deviceLinkTypeArray:null,pageType:E}];$("#deviceListBack").click(function(){loadPage("Home.htm","content")});(function(){var a={},c=!1,b=!1;a[uciGuestNet.fileName]={};a[uciGuestNet.fileName][KEY_NAME]=[uciGuestNet.secName.wireless2G];void 0!=slp.moduleSpec.guest5g&&1==slp.moduleSpec.guest5g&&(a[uciGuestNet.fileName][KEY_NAME].push(uciGuestNet.secName.wireless5G),
c=!0);1==slp.moduleSpec.wifison_mesh&&(a[uciProto.fileName]={},a[uciProto.fileName][KEY_NAME]=uciProto.secName.dhcp);1==slp.moduleSpec.hnat&&(a[uciHNat.fileName]={},a[uciHNat.fileName][KEY_NAME]=uciHNat.secName.main,b=!0);slp.macFilterSupport&&(a[uciCustomNetwork.fileName]={},a[uciCustomNetwork.fileName][KEY_NAME]=uciCustomNetwork.dynData.macFilterConfig);$.query(a,function(a){a[ERR_CODE]==ENONE&&(a[uciGuestNet.fileName][uciGuestNet.secName.wireless2G][uciGuestNet.optName.enable]==uciGuestNet.optValue.enable.yes||
c&&a[uciGuestNet.fileName][uciGuestNet.secName.wireless5G][uciGuestNet.optName.enable]==uciGuestNet.optValue.enable.yes)&&(F=!0);b&&a[uciHNat.fileName][uciHNat.secName.main][uciHNat.optName.enable]==uciHNat.optValue.enable.on&&(D=!0);1==slp.moduleSpec.wifison_mesh&&(ga=a[uciProto.fileName][uciProto.secName.dhcp][uciProto.optName.hostName]);slp.macFilterSupport?g.splice(2,1):g.splice(3,1);F||g.splice(1,1);ca={targetId:"deviceListTabCon",list:[]};for(var f=0;f<g.length;f++)ca.list[f]={name:g[f].tabName,
contentId:g[f].tableId,onClick:S};var h={targetId:"hostDeviceTable",hasCheckBox:!1,editable:!1,deletable:!1,addable:!1,head:[{field:label.deviceName,width:"0.48"},{field:label.deviceLinkType,width:"0.28"},{field:label.deviceSpeedLimit,width:"0.14"},{field:label.deviceForbid,width:"0.1"}],column:[{name:"basicInfo",type:"deviceBasicInfo",onClick:function(){p=!0},onSave:V},{name:"linkType",type:"deviceLinkType"},{name:"netSpeedLimit",type:"deviceSpeedLimit",onClick:function(a){p=!0;D?(a(!1),confirmDialog.show({content:label.hNatCloseForSpeedLimitConfirm,
callback:function(a){a?(a={},a[uciHNat.fileName]={},a[uciHNat.fileName][uciHNat.secName.main]={},a[uciHNat.fileName][uciHNat.secName.main][uciHNat.optName.enable]=uciHNat.optValue.enable.off,$.modify(a,function(a){a[ERR_CODE]==ENONE&&(showToast(label.hNatClosed),D=!1,clearTimeout(C),C=null,h.head.splice(2,0,{field:label.deviceNetSpeed,width:"0.14"}),h.head[1].width="0.14",h.column.splice(2,0,{name:"netSpeed",type:"deviceSpeed",onTrans:L}),id("hostDeviceTable").innerHTML="",I=new Table(h),g[0].table=
I,F&&(k.head.splice(2,0,{field:label.deviceNetSpeed,width:"0.14"}),k.head[1].width="0.14",k.column.splice(2,0,{name:"netSpeed",type:"deviceSpeed",onTrans:L}),id("guestDeviceTable").innerHTML="",N=new Table(k),g[1].table=N));p=!1;r()})):p=!1}})):a(!0)},onSave:ia},{name:"forbid",type:"button",options:{onRender:function(a){if(slp.macFilterSupport){if(A==uciCustomNetwork.optValue.owner.andlink&&B==uciCustomNetwork.optValue.macFilterConfig.on||l==u&&X(a.mac,!0)||l==y||"1"==a.isCurHost)return!1}else if("1"==
a.isCurHost)return!1;return!0},icon:"icon-forbidden",type:"forbid",str:btn.disable,onClick:ja}}],type:Table.TYPE.DEVICE};D||(h.head.splice(2,0,{field:label.deviceNetSpeed,width:"0.14"}),h.head[1].width="0.14",h.column.splice(2,0,{name:"netSpeed",type:"deviceSpeed",onTrans:L}));I=new Table(h);g[0].table=I;g[0].deviceLinkTypeArray=[{str:label.allLinkType,value:-1},{str:label.wirelessNet2G,value:1}];slp.bandsProvided==slp.DOUBLE?g[0].deviceLinkTypeArray.push({str:label.wirelessNet5G,value:2}):slp.bandsProvided==
slp.TRIPLE&&(g[0].deviceLinkTypeArray.push({str:label.wirelessNet5G1,value:3}),g[0].deviceLinkTypeArray.push({str:label.wirelessNet5G2,value:4}));g[0].deviceLinkTypeArray.push({str:label.inetLink,value:0});if(F){var k={targetId:"guestDeviceTable",hasCheckBox:!1,editable:!1,deletable:!1,addable:!1,head:[{field:label.deviceName,width:"0.48"},{field:label.deviceLinkType,width:"0.28"},{field:label.deviceSpeedLimit,width:"0.14"},{field:label.deviceForbid,width:"0.1"}],column:[{name:"basicInfo",type:"deviceBasicInfo",
onClick:function(){p=!0},onSave:V},{name:"linkType",type:"deviceLinkType"},{name:"netSpeedLimit",type:"deviceSpeedLimit",onClick:function(a){p=!0;D?(a(!1),confirmDialog.show({content:label.hNatCloseForSpeedLimitConfirm,callback:function(a){a?(a={},a[uciHNat.fileName]={},a[uciHNat.fileName][uciHNat.secName.main]={},a[uciHNat.fileName][uciHNat.secName.main][uciHNat.optName.enable]=uciHNat.optValue.enable.off,$.modify(a,function(a){a[ERR_CODE]==ENONE&&(showToast(label.hNatClosed),D=!1,clearTimeout(C),
C=null,h.head.splice(2,0,{field:label.deviceNetSpeed,width:"0.14"}),h.head[1].width="0.14",h.column.splice(2,0,{name:"netSpeed",type:"deviceSpeed",onTrans:L}),id("hostDeviceTable").innerHTML="",I=new Table(h),g[0].table=I,k.head.splice(2,0,{field:label.deviceNetSpeed,width:"0.14"}),k.head[1].width="0.14",k.column.splice(2,0,{name:"netSpeed",type:"deviceSpeed",onTrans:L}),id("guestDeviceTable").innerHTML="",N=new Table(k),g[1].table=N);p=!1;r()})):p=!1}})):a(!0)},onSave:ia},{name:"forbid",type:"button",
options:{onRender:function(a){if(A==uciCustomNetwork.optValue.owner.andlink&&B==uciCustomNetwork.optValue.macFilterConfig.on)return!1;if(slp.macFilterSupport){if(l==u&&X(a.mac,!0)||l==y||"1"==a.isCurHost)return!1}else if("1"==a.isCurHost)return!1;return!0},icon:"icon-forbidden",type:"forbid",str:btn.disable,onClick:ja}}],type:Table.TYPE.DEVICE};D||(k.head.splice(2,0,{field:label.deviceNetSpeed,width:"0.14"}),k.head[1].width="0.14",k.column.splice(2,0,{name:"netSpeed",type:"deviceSpeed",onTrans:L}));
N=new Table(k);g[1].table=N;c&&(g[1].deviceLinkTypeArray=[{str:label.allLinkType,value:-1},{str:label.wirelessNet2G,value:1},{str:label.wirelessNet5G,value:2}])}slp.macFilterSupport&&(f=a[uciCustomNetwork.fileName][uciCustomNetwork.secName.macFilterConfig][uciCustomNetwork.optName.policy],B=a[uciCustomNetwork.fileName][uciCustomNetwork.secName.macFilterConfig][uciCustomNetwork.optName.enable],A=a[uciCustomNetwork.fileName][uciCustomNetwork.secName.macFilterConfig][uciCustomNetwork.optName.owner],
l="on"==B?f:y);T();selectInit("deviceLinkTypeSel",[{str:label.allLinkType,value:-1}],-1,function(){r()});1==slp.moduleSpec.wifison_mesh&&(a='<ul class="inputCMPT medium selectUl" id="routerSelCon"><li class="inputLi"><span class="selectWrap"><span id="routerSel" class="select"><span class="value"></span><i class="arrow iconfont icon-folddropdown"></i></span></span></li></ul>',$("#deviceLinkTypeSelCon").after(a),selectInit("routerSel",K,-1,function(a){v=a;r()},void 0,{unlimitOptionsHigh:!0}));slp.macFilterSupport&&
(a='<ul class="inputCMPT medium" id="modeSelCon"><label class="outerLbl">{%label.currentMode%}</label><li class="inputLi"><span class="selectWrap"><span id="modeSel" class="select"><span class="value"></span><i class="arrow iconfont icon-folddropdown"></i></span></span></li></ul>',$(".selectCon").append(a),selectInit("modeSel",ua,l,ta),aa(J),aa(M),aa(Q));fa=new Tab(ca)})})()})();
</script><style type="text/css">#deviceListWrapper{width:1000px;margin:0 auto;position:relative}div.deviceListWrapperHead{height:40px}#deviceListBack{display:block;color:#333;font-size:13px;cursor:pointer;line-height:40px;height:40px;width:100px}div.selectCon{margin-top:8px;margin-bottom:8px;height:32px}div.selectCon ul.selectUl{margin-left:8px;display:inline-block;margin-bottom:0;float:right}div.selectCon ul.selectUl li{width:180px}div.selectCon ul#modeSelCon label.outerLbl{width:auto}#deviceListBack i.iconfont{display:inline-block;font-size:16px;margin-right:4px;vertical-align:middle}span.deviceListBackText{vertical-align:middle}div.head.deviceList{border-bottom-width:0;margin-bottom:16px}#deviceListTabCon{margin-bottom:16px}.dialogHeadTips{line-height:20px;margin-bottom:16px;font-size:13px;color:#333}</style>