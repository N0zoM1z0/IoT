

<div class="head">
	<div class="title"><h1>{%menuStr.wanSet%}</h1><i class="helpBtn iconfont icon-help"></i></div>
	<p class="description">{%titleDescriptionStr.wanSetDescription%}</p>
	<div id="wanPortTab"></div>
</div>
<div id="subContent"></div><script type="text/javascript">var wanPortWidth=40,lanPortWidth=40,lanWanMargin=8,autoLanWanLabelWidth=60,autoLanWanLabelMargin=2,WAN_NUM=2,DUAL_WAN_OPEN=!1,WAN_INDEX=1,wanPortSelCfg,currentSelectPos=[],wanOptions=[{str:label.pppoe,value:LINK_TYPE_PPPOE},{str:label.staticIp,value:LINK_TYPE_STATIC_IP},{str:label.dhcp,value:LINK_TYPE_DHCP}],rateOptions=function(){var a="",a=(a=slp.moduleSpec.eth_bandwidth)&&1E3==a?label.dupAuto1000:label.dupAuto100;return[{str:a,value:"auto"},{str:label.dup10MF,value:"10F"},{str:label.dup10MH,value:"10H"}]}(),
highSetWanType,highSetLanConf,curSysMode=uciSystem.optValue.sysMode.routerMode;
function wzdWanDetect(){function a(){c=!0;clearTimeout(d)}function b(){$.action({network:{detect_wan_proto:null}},function(g){var f="";if(!0!=c)switch(f=slp.moduleSpec.wifison_mesh&&1==slp.moduleSpec.wifison_mesh?label.wanWzdCheckMesh:label.wanWzdCheckNoteH+label.wanWzdCheckNoteT,parseInt(g[uciNetwork.optName.proto])){case ERROR_INTERNEL_ERROR:case ERROR_INPUT_PARA_ERROR:case WAN_IFACE_NOT_LINK:"showed"==loadingDialog.status&&loadingDialog.hide(function(){alarmDialog.show({content:f,callback:a})});
d=$.setTimeout(b,1E3);break;case WAN_TYPE_DETECTING:"showed"==alarmDialog.status&&alarmDialog.hide(function(){loadingDialog.show({title:label.confirmTitle,content:{primary:label.checkingWait}},void 0,void 0,!0,a)});d=$.setTimeout(b,1E3);break;case WAN_TYPE_STATIC:loadingDialog.hide(function(){id("wanSel").changeSel(LINK_TYPE_STATIC_IP)});break;case WAN_TYPE_DHCP:loadingDialog.hide(function(){id("wanSel").changeSel(LINK_TYPE_DHCP)});break;case WAN_TYPE_PPPOE:loadingDialog.hide(function(){id("wanSel").changeSel(LINK_TYPE_PPPOE)})}})}
var c=!1,d=null;loadingDialog.show({title:label.confirmTitle,content:{primary:label.checkingWait}},void 0,void 0,!0,a);b()}function setLinkState(a,b){var c=$("#linkState");c[0].className=a?"normalState":"abnormalState";c.find("span.state").html(b)}function loadPageByIndex(a){var b=["DynamicIp.htm","StaticIp.htm","PPPoE.htm"];b[LINK_TYPE_WIRED_REPEATER]="WiredRepeater.htm";b[LINK_TYPE_WIRELESS_REPEATER]="WirelessRepeater.htm";""==a.toString()&&(a=LINK_TYPE_PPPOE);loadPage(b[a],"subContent")}
function switchPortImage(a){a?($("#portImageAuto").show(),$("#portImageFixed").hide()):($("#portImageAuto").hide(),$("#portImageFixed").show())}
function initPortImage(){for(var a=0;a<PORT_ORDER.length;a++)switch(PORT_ORDER[a]){case "POWER":$("#portImageAuto").append("<span class='port powerPort'><i></i><label>{%label.power%}</label></span>");break;case "RESET":$("#portImageAuto").append("<span class='port resetPort'><i></i><label>{%label.reset%}</label></span>");break;case "MESH":$("#portImageAuto").append("<span class='port meshPort'><i></i><label>{%label.mesh%}</label></span>");break;case "TURBO":$("#portImageAuto").append("<span class='port meshPort'><i></i><label>{%label.turbo%}</label></span>");
break;case "RESET&MESH":$("#portImageAuto").append("<span class='port resetMeshPort'><i></i><label>{%label.resetMesh%}</label></span>");break;case "WAN":$("#portImageAuto").append("<span class='port wanPort selectedPort'><i></i></span>");break;case "LAN":for(var b=1;b<=LAN_PORT_NUM;b++)$("#portImageAuto").append("<span class='port lanPort selectedPort'><i></i></span>")}a=lanPortWidth*LAN_PORT_NUM+wanPortWidth+LAN_PORT_NUM*lanWanMargin;b=(a-autoLanWanLabelWidth-2*autoLanWanLabelMargin)/2;$("#portImageAuto .selectedPort i").css("margin-bottom",
"18px");$("#portImageAuto .selectedPort i").eq(0).css("margin-bottom","5px");$("#portImageAuto .selectedPort").eq(0).append('<span class="lanWanCombo"><span class="border leftBorder"></span><label>WAN/LAN</label><span class="border rightBorder"></span></span>');$("#portImageAuto .selectedPort .lanWanCombo").eq(0).css("width",a);$("#portImageAuto .selectedPort .border").css("width",b);for(a=0;a<PORT_ORDER.length;a++){switch(PORT_ORDER[a]){case "POWER":$("#portImageFixed").append("<span class='port powerPort'><i></i><label>{%label.power%}</label></span>");
break;case "RESET":$("#portImageFixed").append("<span class='port resetPort'><i></i><label>{%label.reset%}</label></span>");break;case "MESH":$("#portImageFixed").append("<span class='port meshPort'><i></i><label>{%label.mesh%}</label></span>");break;case "TURBO":$("#portImageFixed").append("<span class='port meshPort'><i></i><label>{%label.turbo%}</label></span>");break;case "RESET&MESH":$("#portImageFixed").append("<span class='port resetMeshPort'><i></i><label>{%label.resetMesh%}</label></span>");
break;case "WAN":$("#portImageFixed").append("<span class='port wanPort'><i></i><label>{%label.wan%}</label></span>");break;case "LAN":if(1==LAN_PORT_NUM)$("#portImageFixed").append("<span class='port lanPort'><i></i><label>{%label.lan%}</label></span>");else for(b=1;b<=LAN_PORT_NUM;b++)$("#portImageFixed").append("<span class='port lanPort'><i></i><label>"+label["lanPort"+b]+"</label></span>")}$("#portImageFixed .wanPort").addClass("selectedPort")}}
function getPhySpeedByIndex(a,b,c){function d(a){switch(a){case "1000M":return"GE";case "2.5G":return"2.5GE";case "10G":return"10GE";default:return"default"}}return"SFP"==a[b].type.toUpperCase()?d(c[c.length-1]):d(a[b].speed)}
function setCurrentFixPort(a,b){for(var c=0;c<a.length;c++)"WAN"==a[c].name.slice(0,3).toUpperCase()&&(a[c].name="LAN",a[c].state="normal");if("disable"==a[b].state){for(var c=-1,d=0;d<a.length;d++)if("normal"==a[d].state){c=d;break}-1==c?alarmDialog("固定WAN口设置失效且当前无可定义端口，请在端口自定义中关闭相关端口定义"):(a[c].name="WAN",a[c].state="active",wanPortSelCfg=c)}else a[b].name="WAN",a[b].state="active",wanPortSelCfg=b}
function wanClickHandler(a){switch(a.state){case "normal":wanDisplayData[a.index].name="LAN";wanDisplayPort.refresh();break;case "active":for(var b=0;b<wanDisplayData.length;b++)"active"==wanDisplayData[b].state&&b!=a.index&&(wanDisplayData[b].state="normal",wanDisplayData[b].name="LAN");wanDisplayData[a.index].name="WAN";wanPortSelCfg=a.index;wanDisplayPort.refresh()}}
function initPortCustomImage(a,b){$.query({port_manage:{table:"dev_info"}},function(c){c=c.port_manage.dev_info;for(var d=0;d<c.length;d++)if(1==c[d].cap){powerPosition=c[d].power_pos;powerIndex=c[d][uciPortConfig.dynOptName.powerIdx];wanPortNum=c[d].phy_num;wanDisplayData=Array(wanPortNum);for(var g=c[d].sfp_capability,f=0;f<wanPortNum;f++)wanDisplayData[f]={};for(f=0;f<c[d].phy_info.length;f++){var e=f;switch(c[d].phy_info[f].role.slice(0,3).toUpperCase()){case "LAN":wanDisplayData[e].name="LAN";
wanDisplayData[e].state="normal";wanDisplayData[e].rate=getPhySpeedByIndex(c[d].phy_info,f,g);break;case "WAN":wanDisplayData[e].name="WAN";wanDisplayData[e].state="active";wanDisplayData[e].rate=getPhySpeedByIndex(c[d].phy_info,f,g);break;case "GAM":wanDisplayData[e].name=label.gamePort;wanDisplayData[e].state="disable";wanDisplayData[e].rate=getPhySpeedByIndex(c[d].phy_info,f,g);break;case "UPL":wanDisplayData[e].name=label.iptvUplinkPort;wanDisplayData[e].state="disable";wanDisplayData[e].rate=
getPhySpeedByIndex(c[d].phy_info,f,g);break;case "DOW":wanDisplayData[e].name=label.iptvPort;wanDisplayData[e].state="disable";wanDisplayData[e].rate=getPhySpeedByIndex(c[d].phy_info,f,g);break;case "LAG":wanDisplayData[e].name=label.lagPort,wanDisplayData[e].state="disable",wanDisplayData[e].rate=getPhySpeedByIndex(c[d].phy_info,f,g)}}}-1==b||a||setCurrentFixPort(wanDisplayData,parseInt(b));if(a)for(d=0;d<wanDisplayData.length;d++)if("WAN"==wanDisplayData[d].name||"LAN"==wanDisplayData[d].name)wanDisplayData[d].name=
"WAN/LAN",wanDisplayData[d].state="active";wanDisplayPort=new PortConfig;c={element:a?$("#portImageAuto")[0]:$("#portImageFixed")[0],type:"display",port:wanDisplayData,powerPos:powerPosition,powerIdx:powerIndex,displayClickable:!1==a,callback:wanClickHandler};wanDisplayPort.init(c)})}function speedConversion(a){var b;if(null==a)return null;a=parseInt(a);1048576<=a?(a=(a/1048576).toFixed(2),b="GB/s"):1024<=a?(a=(a/1024).toFixed(1),b="MB/s"):(a=(a/1).toFixed(0),b="KB/s");return{speed:a,unit:b}}
function wanCheckWDS(a,b){slp.wds.getData({success:function(c){var d,g=!1,f;for(f in c[uciWireless.fileName])if(c[uciWireless.fileName].hasOwnProperty(f)&&(d=c[uciWireless.fileName][f],1==d[uciWireless.dynOptName.enable])){g=!0;break}g?(slp.gSysModeSupport?alarmDialog.show({content:"当前上网方式为桥接（无线中继）。如要更改WAN口设置，请先切换上网方式。"}):alarmDialog.show({content:label.wanWDSTip}),"function"==typeof b&&b()):"function"==typeof a&&a()},fail:function(){"function"==typeof a&&a()}})}
function initDynamicPortRate(a,b){var c=Object.keys(slp.wanPortRateList).length,d;d="left"==b?a:c-a-1;c=slp.wanPortRateList[d];d=slp.wanPortRateDescList[d];for(var g=[],f=0;f<c.length;f++)g.push({str:d[f],value:c[f]});return g}function checkIfWanRateShouldChange(a,b){for(var c=slp.wanPortRateList[a],d=0;d<c.length;d++)if(c[d]==b)return!1;return!0}
function dualWanOpenCheck(a,b){slp.gMulWanSupport?$.query({port_manage:{table:"mwan"}},function(c){if(c[ERR_CODE]==ENONE){DUAL_WAN_OPEN=!0;for(var d=0;d<WAN_NUM;d++)0==c.port_manage.mwan[d]["mwan_"+(d+1)].enable&&(DUAL_WAN_OPEN=!1);DUAL_WAN_OPEN?$.query({port_manage:{table:"dev_info"}},function(b){b=b.port_manage.dev_info;for(var c,d,h=0;h<b.length;h++)1==b[h].cap&&(d=h,c=b[h].phy_num);for(h=0;h<c;h++)"WAN"==b[d].phy_info[h].role.slice(0,3).toUpperCase()&&("WAN1"==b[d].phy_info[h].role.toUpperCase()?
currentSelectPos[0]=h:currentSelectPos[1]=h);a()}):b()}}):(DUAL_WAN_OPEN=!1,b())}function initDualWanTab(){new Tab({list:[{name:label.wan1Port,onClick:function(){WAN_INDEX=1;initWanSet(WAN_INDEX)}},{name:label.wan2Port,onClick:function(){WAN_INDEX=2;initWanSet(WAN_INDEX)}}],targetId:"wanPortTab"})}
function setWanOptions(a){wanOptions=[{str:label.pppoe,value:LINK_TYPE_PPPOE},{str:label.staticIp,value:LINK_TYPE_STATIC_IP},{str:label.dhcp,value:LINK_TYPE_DHCP}];for(var b=0;b<a.dial_mode.length;b++)switch(a.dial_mode[b]){case "wired_relay":wanOptions.push({str:label.wiredRepeater,value:LINK_TYPE_WIRED_REPEATER});break;case "wds_relay":wanOptions.push({str:label.wirelessRepeater,value:LINK_TYPE_WIRELESS_REPEATER})}}
function initWanSet(a){var b={},c="wan";b[uciProto.fileName]={};c=1==a||"undefined"==typeof a?uciProto.secName.wan:uciProto.secName.wan2;b[uciProto.fileName][KEY_NAME]=c;b[uciNetwork.fileName]={};b[uciNetwork.fileName][KEY_NAME]=uciNetwork.secName.lan;b[uciFunction.fileName]={};b[uciFunction.fileName][KEY_NAME]=uciFunction.secName.newModuleSpec;$.query(b,function(a){var b=uciProto.optValue.proto,f=a[uciProto.fileName][c][uciProto.optName.type],e=LINK_TYPE_PPPOE;highSetWanType=f;highSetLanConf=a[uciNetwork.fileName][uciNetwork.secName.lan];
e={};e=a[uciFunction.fileName][uciFunction.secName.newModuleSpec];if(slp.gSysModeSupport)if(setWanOptions(e),curSysMode==uciSystem.optValue.sysMode.apMode)e=LINK_TYPE_WIRED_REPEATER;else if(curSysMode==uciSystem.optValue.sysMode.wdsMode)e=LINK_TYPE_WIRELESS_REPEATER;else switch(f){case b.dynIp:e=LINK_TYPE_DHCP;break;case b.staticIp:e=LINK_TYPE_STATIC_IP;break;default:e=LINK_TYPE_PPPOE}else switch(f){case b.dynIp:e=LINK_TYPE_DHCP;break;case b.staticIp:e=LINK_TYPE_STATIC_IP;break;default:e=LINK_TYPE_PPPOE}"undefined"!=
typeof gStartWirelessRepeater&&gStartWirelessRepeater?loadPageByIndex(LINK_TYPE_WIRELESS_REPEATER):loadPageByIndex(e)})}
(function(){slp.gSysModeSupport?$.query({network:{name:"lan"},system:{name:"sys_mode"}},function(a){curSysMode=a.system.sys_mode.mode;curSysMode!=uciSystem.optValue.sysMode.routerMode?($("#menuLoader .head").removeClass("dualWanHead"),WAN_INDEX=1,initWanSet(WAN_INDEX)):dualWanOpenCheck(function(){$("#menuLoader .head").addClass("dualWanHead");initDualWanTab()},function(){$("#menuLoader .head").removeClass("dualWanHead");WAN_INDEX=1;initWanSet(WAN_INDEX)})}):($("#menuLoader .head").removeClass("dualWanHead"),
WAN_INDEX=1,initWanSet(WAN_INDEX))})();
</script><style type="text/css">div.dualWanHead{margin-bottom:16px}ul.dashBoard{margin-bottom:-24px}ul.dashBoard li.board{float:left;width:370px;height:78px;border:1px solid #e6e6e6;border-radius:4px}ul.dashBoard li+li{margin-left:16px}li.board i{font-size:24px;color:#999;margin:0 4px 0 16px;vertical-align:middle}li.board span.speed{font-size:36px;color:#666;line-height:80px;vertical-align:middle;font-weight:bold}li.board p.speedText{display:inline-block;vertical-align:middle;margin-left:8px;width:65px}p.speedText span{float:left;width:100%;font-size:12px;color:#666;line-height:18px}span.normalState i.disc{background:#24b353}span.normalState span.state{color:#24b353}span.abnormalState i.disc{background:#f36}span.abnormalState span.state{color:#f36}div.buttonGroup{padding:12px 0 0 132px;font-size:0}span.wanPortDetectTip{font-size:13px;color:#666;display:block;line-height:20px;height:20px;margin-top:4px;margin-bottom:12px}i.wanPortDetectImg{margin-left:132px;width:240px;height:104px;display:block}div.portImage{position:relative;display:inline-block;padding:24px 0;margin-left:132px;background:#fff;border:1px solid #e6e6e6;border-radius:4px}span.port{display:inline-block;height:58px;text-align:center}span.port i{display:inline-block;width:40px;height:40px;margin-bottom:6px}span.port label{font-size:12px;color:#808080}span.port.selectedPort i{background:url(../web-static/images/port.png) no-repeat -40px 0}span.resetPort{width:64px}span.resetPort i{background:url(../web-static/images/port.png) no-repeat -80px 0}span.lanPort{width:40px}span.lanPort i{background:url(../web-static/images/port.png) no-repeat 0 0}span.lanPort.selectedLAN i{background:url(../web-static/images/port.png) no-repeat -40px 0}span.wanPort{width:40px}span.wanPort i{background:url(../web-static/images/port.png) no-repeat 0 0}span.powerPort{width:64px}span.powerPort i{background:url(../web-static/images/port.png) no-repeat -120px 0}span.meshPort{width:64px}span.meshPort i{background:url(../web-static/images/port.png) no-repeat -265px 0}span.resetMeshPort{width:88px}span.resetMeshPort i{background:url(../web-static/images/port.png) no-repeat -305px 0}span.lanPort:first-child,span.wanPort:first-child{margin-left:12px}span.lanPort:nth-last-child(1),span.wanPort:nth-last-child(1){margin-right:12px}span.resetPort+span.lanPort,span.resetPort+span.wanPort,span.powerPort+span.lanPort,span.powerPort+span.wanPort{margin-left:12px}span.lanPort+span.resetPort,span.wanPort+span.resetPort,span.lanPort+span.powerPort,span.wanPort+span.powerPort{margin-left:12px}span.lanPort+span.wanPort,span.wanPort+span.lanPort,span.lanPort+span.lanPort{margin-left:8px}span.lanWanCombo{display:inline-block;width:200px;height:16px}span.lanWanCombo .border{display:inline-block;height:6px;width:40px;margin-top:2px;vertical-align:top;border-bottom:1px solid #e6e6e6;box-sizing:border-box}span.lanWanCombo span.leftBorder{border-left:1px solid #e6e6e6}span.lanWanCombo span.rightBorder{border-right:1px solid #e6e6e6}span.lanWanCombo label{display:inline-block;width:60px;height:16px;margin:0 2px}#wanPortTab ul{border-bottom:2px solid #e6e6e6}#wanPortTab ul>li{width:160px}#wanPortTab .underline{bottom:-2px}</style>