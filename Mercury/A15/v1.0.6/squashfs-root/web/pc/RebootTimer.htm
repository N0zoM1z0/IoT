
<div class="head">
	<div class="title">
		<h1>{%menuStr.rebootTimer%}</h1>
		<i class="helpBtn iconfont icon-help" helpStr="systemRebootTimer"></i>
		<div id="switchCon" class="switchCon switchConHs">
			<i class="switchBg"></i>
			<i class="switchBall"/></i>
		</div>
	</div>
	<p class="description">{%titleDescriptionStr.rebootTimerDescription%}</p>
</div>
<div id="rebootTimerTable"></div><script type="text/javascript">(function(){function n(a){var c="";switch(a){case ENONE:return!0;case EINVSAMERTRULE:c=label.sameRule;break;case EINVRTTIMEDESCTOOLONG:c=errStr.timePoiotTooLong;break;default:c=errStr.unknown+a}alarmDialog.show(c);return!1}function D(){g=[];for(var a=0;a<c.length;a++)g[a]={},g[a][h]=c[a][h],g[a][SEC_NAME]=c[a][SEC_NAME],g[a].timeDesc=c[a][p],g[a].weekDesc=("0"==c[a][q]?"":l.mon)+("0"==c[a][r]?"":l.tue)+("0"==c[a][s]?"":l.wed)+("0"==c[a][t]?"":l.thu)+("0"==c[a][u]?"":l.fri)+("0"==c[a][v]?"":l.sat)+
("0"==c[a][w]?"":l.sun)}function E(a,c){F.setDataSource(a);F.loadData();"function"==typeof c&&c()}function G(){var a={};a[e]={};a[e][h]=H;null!=x&&(clearTimeout(x),x=null);!0!=z&&($.query(a,function(a){z=parseInt(a[e][H][y]);null!=A&&(I==A.state&&!1==z?addTitleError("cntNtpFail",label.cntNtpFailForRebootTimer):removeTitleError("cntNtpFail"))}),x=$.setTimeout(G,1E3))}function K(a){var c={},b={};c[e]={};c[e][B]=b;b[y]=a;$.modify(c,function(a){n(a[ERR_CODE])})}function J(a,e){var b={},d;void 0==a?(d=
calcNextIndex(c),b.mode="add",b.index=d,b.name=label.timePoint+d,b.startHour=b.startMin="00",b.mon=b.tue=b.wed=b.thu=b.fri=b.sat=b.sun=!0):(d=a[SEC_NAME].replace(/.*_(\d)$/,"$1"),rebootTime=a[p].split(":"),b.mode="edit",b.index=d,b.arrayIndex=e,b.itemName=a[SEC_NAME],b.name=a.name,b.startHour=rebootTime[0],b.startMin=rebootTime[1],b.mon="0"==a[q]?!1:!0,b.tue="0"==a[r]?!1:!0,b.wed="0"==a[s]?!1:!0,b.thu="0"==a[t]?!1:!0,b.fri="0"==a[u]?!1:!0,b.sat="0"==a[v]?!1:!0,b.sun="0"==a[w]?!1:!0);return b}function C(a){var h=
{};h[e]={};h[e][KEY_TABLE]=m;$.query(h,function(b){c=formatTableData(b[e][m]);D();E(g,a)})}function L(a){A=new Switch("switchCon",a[e][B][y],K,!1);G();c=formatTableData(a[e][m]);D();E(g)}var c=[],g=[],e=uciRebootTimer.fileName,m=uciRebootTimer.secType.rebootTimerRule,B=uciRebootTimer.secName.rebootTimerStatus,H=uciRebootTimer.secName.clockSuccess,h=uciRebootTimer.optName.name,q=uciRebootTimer.optName.mon,r=uciRebootTimer.optName.tue,s=uciRebootTimer.optName.wed,t=uciRebootTimer.optName.thu,u=uciRebootTimer.optName.fri,
v=uciRebootTimer.optName.sat,w=uciRebootTimer.optName.sun,y=uciRebootTimer.optName.enable,p=uciRebootTimer.optName.rebootTime,I=uciRebootTimer.optValue.enable.yes,A,z=!1,x=null,l={mon:label.one,tue:label.two,wed:label.three,thu:label.four,fri:label.five,sat:label.six,sun:label.day};timePeriodDialog.resetTpType(timePeriodDialog.tpType.REBOOT_TIMER);timePeriodDialog.resetCommit(function(a){for(var g=[q,r,s,t,u,v,w],b={},d={},k={},f=0;f<c.length;f++)if((!1==a.mon?"0":"1")==c[f][q]&&(!1==a.tue?"0":"1")==
c[f][r]&&(!1==a.wed?"0":"1")==c[f][s]&&(!1==a.thu?"0":"1")==c[f][t]&&(!1==a.fri?"0":"1")==c[f][u]&&(!1==a.sat?"0":"1")==c[f][v]&&(!1==a.sun?"0":"1")==c[f][w]&&a.startHour+":"+a.startMin==c[f][p]&&(!a.arrayIndex||a.arrayIndex!=f)){showToast(label.sameRule);return}b[e]=d;"add"==a.mode?(d[KEY_TABLE]=m,d[h]=d[KEY_TABLE]+"_"+a.index,d[KEY_PARA]=k):d[a.itemName]=k;for(d=0;d<g.length;d++)k[g[d]]=!0==a[g[d]]?"1":"0";k[h]=a[h];k[p]=a.startHour+":"+a.startMin;k[y]=I;"add"==a.mode?$.add(b,function(a){n(a[ERR_CODE])&&
timePeriodDialog.hide(function(){showToast(label.addSuccess);C()})}):$.modify(b,function(a){n(a[ERR_CODE])&&timePeriodDialog.hide(function(){showToast(label.saveSuccess);C()})})});var F=new Table({targetId:"rebootTimerTable",head:[{field:label.pointDesc,width:"0.40"},{field:label.rebootTime,width:"0.27"},{field:label.repeatWeek,width:"0.33"}],column:[{name:h,type:"str"},{name:"timeDesc",type:"str"},{name:"weekDesc",type:"str"}],hasCheckBox:!0,editable:!1,addable:!1,max:REBOOT_TIMER_RULE_MAX,itemOption:[{icon:"icon-edit",
type:"edit",str:btn.edit,func:function(a,e){var b=J(c[a],a);timePeriodDialog.show(b)}}],tableOption:[{icon:"icon-add",type:"add",str:btn.add,func:function(){var a=J();timePeriodDialog.show(a)},selRelate:!1}],clickList:{click_del_item:{func:function(a,g){var b={},d={},k=[];b[e]=d;d[h]=k;var d=a.split("-"),f;for(f in d)d.hasOwnProperty(f)&&(k[k.length]=c[d[f]][SEC_NAME]);$.del(b,function(a){n(a[ERR_CODE])&&(showToast(label.deleteSuccess),C())})},asyn:!0}}});(function(){var a={};a[e]={};a[e][KEY_TABLE]=
m;a[e][h]=B;$.query(a,L)})()})();
</script>