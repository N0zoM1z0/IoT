

<ul class="wzdUl">
    <li class="wizardSkip"><span class="wzdSkipDes">{%label.skipWzd%}</span></li>
    <li class="wizardBody">
        <h1>桥接（无线中继）</h1>
    </li>
    <div id="wdsScanTable"></div>
    <div class="wdsScanStepBtn">
        <div id="pre"></div>
        <div id="next"></div>
    </div>
</ul><script type="text/javascript">var wdsTargetIndex=[],scanRetryCounts=1,wdsIsScanning=!1;function wdsTimeoutHandle(){function g(){confirmDialog.show({content:"连接失败，请确定是否重试？",callback:function(d){!0==d?wdsNextStep():(clearTimeout(getWdsStatusHd),wdsCanceldHandle())}})}loadingDialog.hide(function(){slp.wifiSwitchSupport?checkWifiSwitchOff(g):g()})}
function wdsNextStep(){var g=function(){var d={wireless:{}},d=BAND_2==slp.bandsProvided-1?{wireless:{wlan_wds_2g:{enable:"0",ssid:""},wlan_wds_5g:{enable:"0",ssid:""}}}:{wireless:{wlan_wds_2g:{enable:"0",ssid:""},wlan_wds_5g_1:{enable:"0",ssid:""},wlan_wds_5g_4:{enable:"0",ssid:""}}},b;for(b in wdsTargetSelFreq)if(wdsTargetSelFreq[b].selected){var e={enable:"1"};e.ssid=gRootAPInfo[b].ssid;e.encryption=gRootAPInfo[b].encryption;"0"!=gRootAPInfo[b].encryption&&(e.key=gRootAPInfo[b].key);d.wireless[gWDSModel[b].set_wds]=
e;gRootAPInfo[b].enable="1"}return d}();"idle"==loadingDialog.status&&loadingDialog.show({title:"中继前端路由",content:{primary:"正在中继，请稍候..."}},null,null,!0,function(){wdsCanceldHandle()});$.modify(g,function(d){d=d[ERR_CODE];if(ENONE==d){var b=null;d={wireless:{}};for(var e in wdsTargetSelFreq)wdsTargetSelFreq[e].selected&&(d.wireless[gWDSModel[e].wds_start]={set_ip_immediate:"0"});$.action(d);if(!0==bWirelessLinked){var g=!1,p=1,c=function(){if(3<p&&!1==g){var d="",f="您的设备与路由器的连接已断开，请重新进行无线连接...<br />";
"1"==gLocalAPInfo[curEqtFreq].encryption&&(d="  无线密码："+gLocalAPInfo[curEqtFreq].key);f+="无线名称："+gLocalAPInfo[curEqtFreq].ssid+d;g=!0;loadingDialog.hide(function(){loadingDialog.show({content:{primary:f}})})}$.detect(function(){!1==$.result.timeout&&(clearTimeout(b),loadingDialog.hide(function(){loadingDialog.show({title:"中继前端路由",content:{primary:"正在中继，请稍候..."}},null,null,!0,function(){wdsCanceldHandle()});connectingCount=1;getWdsStatusHd=$.setTimeout(wdsStatusHd,100)}))});p++;b=$.setTimeout(c,2E3)};
clearTimeout(b);b=$.setTimeout(c,4E3)}else connectingCount=1,$.setTimeout(wdsStatusHd,5E3)}else errHandle(d),wdsCanceldHandle()})}
function inputRootApPwd(g){loadingDialog.hide();var d=[];$("#wdsSsidPwdDialogDesc").is(":visible")?wdsSsidPwdDialog.refresh():(wdsSsidPwdDialog.refresh(),wdsSsidPwdDialog.show());for(var b in wdsTargetSelFreq)if(wdsTargetSelFreq[b].selected){var e=b;wdsTargetSelFreq[b].bs&&(e=FREQ_BS);$("#root"+e+"Con").removeClass("disNone");$("#root"+e+"Con input")[0].value=gRootAPInfo[b].ssid;if("0"==gRootAPInfo[b].encryption)$("#root"+e+"Con input")[1].value="未加密",$($("#root"+e+"Con .passwordCon input")[0]).addClass("passwordStatic"),
$($("#root"+e+"Con .passwordCon input")[0]).attr("readonly","readonly"),$("#root"+e+"Con .passwordCon .inputLi")[0].className="inputLi static";else{switch(parseInt(e)){case FREQ_2G:d.push(wdsSsidPwdDialog.twoGPwdInput);break;case FREQ_5G:d.push(wdsSsidPwdDialog.fiveGPwdInput);break;case FREQ_5G1:d.push(wdsSsidPwdDialog.fiveG1PwdInput);break;case FREQ_5G4:d.push(wdsSsidPwdDialog.fiveG2PwdInput);break;case FREQ_BS:d.push(wdsSsidPwdDialog.wdsPwdInput)}if(g&&($("#root"+e+"Con input")[1].value=gRootAPInfo[b].key,
gRootAPInfo[b].pwdErr))switch(parseInt(e)){case FREQ_2G:wdsSsidPwdDialog.twoGPwdInput.showNote("请输入正确的无线密码");break;case FREQ_5G:wdsSsidPwdDialog.fiveGPwdInput.showNote("请输入正确的无线密码");break;case FREQ_5G1:wdsSsidPwdDialog.fiveG1PwdInput.showNote("请输入正确的无线密码");break;case FREQ_5G4:wdsSsidPwdDialog.fiveG2PwdInput.showNote("请输入正确的无线密码");break;case FREQ_BS:wdsSsidPwdDialog.wdsPwdInput.showNote("请输入正确的无线密码")}}if(wdsTargetSelFreq[b].bs)break}$(wdsSsidPwdDialog).off("ev_wdsSsidPwdCancel").on("ev_wdsSsidPwdCancel",
function(){this.hide()});$(wdsSsidPwdDialog).off("ev_wdsSsidPwdSubmit").on("ev_wdsSsidPwdSubmit",function(){for(var b=0;b<d.length;++b)if(!d[b].checkAll())return;for(b=0;b<d.length;++b){var e=d[b].getValue(),c=$(d[b].dom).parent().parent().attr("id").replace(/[^0-9]/ig,"");c==FREQ_BS?slp.DOUBLE==slp.bandsProvided?(gRootAPInfo[FREQ_2G].key=e,gRootAPInfo[FREQ_2G].pwdErr=!1,gRootAPInfo[FREQ_2G].encryption=uciWireless.dynOptValue.encryption.on,gRootAPInfo[FREQ_5G].key=e,gRootAPInfo[FREQ_5G].pwdErr=!1,
gRootAPInfo[FREQ_5G].encryption=uciWireless.dynOptValue.encryption.on):(gRootAPInfo[FREQ_2G].key=e,gRootAPInfo[FREQ_2G].pwdErr=!1,gRootAPInfo[FREQ_2G].encryption=uciWireless.dynOptValue.encryption.on,gRootAPInfo[FREQ_5G1].key=e,gRootAPInfo[FREQ_5G1].pwdErr=!1,gRootAPInfo[FREQ_5G1].encryption=uciWireless.dynOptValue.encryption.on,gRootAPInfo[FREQ_5G4].key=e,gRootAPInfo[FREQ_5G4].pwdErr=!1,gRootAPInfo[FREQ_5G4].encryption=uciWireless.dynOptValue.encryption.on):(gRootAPInfo[c].key=e,gRootAPInfo[c].pwdErr=
!1,gRootAPInfo[c].encryption=uciWireless.dynOptValue.encryption.on)}wdsNextStep()})}
var wdsSsidPwdDialog=new Dialog({title:"前端路由密码验证",content:'<span class="wdsSsidPwdDesc" id="wdsSsidPwdDialogDesc">请输入您选择的前端路由的Wi-Fi密码</span><div id="root4Con" class="disNone"><div id="wdsSsidCon" class="wdsSsidPwdInput"></div><div id="wdsPwdCon" class="wdsSsidPwdInput passwordCon"></div></div><div id="root0Con" class="disNone"><div id="twoGSsidCon" class="wdsSsidPwdInput"></div><div id="twoGPwdCon" class="wdsSsidPwdInput passwordCon"></div></div><div id="root1Con" class="disNone"><div id="fiveGSsidCon" class="wdsSsidPwdInput"></div><div id="fiveGPwdCon" class="wdsSsidPwdInput passwordCon"></div></div><div id="root2Con" class="disNone"><div id="fiveG1SsidCon" class="wdsSsidPwdInput"></div><div id="fiveG1PwdCon" class="wdsSsidPwdInput passwordCon"></div></div><div id="root3Con" class="disNone"><div id="fiveG2SsidCon" class="wdsSsidPwdInput"></div><div id="fiveG2PwdCon" class="wdsSsidPwdInput passwordCon"></div></div>',size:Dialog.SIZE.SMALL,
type:Dialog.TYPE.CUSTOM,bottom:[{type:component.Button.TYPE.SECONDARY,text:btn.cancel,id:"wdsSsidPwdCancel",onClick:function(){$(wdsSsidPwdDialog).trigger("ev_wdsSsidPwdCancel")}},{type:component.Button.TYPE.PRIMARY,text:btn.ok,id:"wdsSsidPwdSubmit",onClick:function(){$(wdsSsidPwdDialog).trigger("ev_wdsSsidPwdSubmit")}}],renderCallBack:function(){this.wdsSsidInput=new Input({type:Input.TYPE.STATIC_TEXT,label:{value:label.wirelessName},targetId:"wdsSsidCon",check:{blur:checkSsidInput},props:{maxlength:"32",
type:"text"}});this.wdsPwdInput=new Input({type:Input.TYPE.CIPHER_TEXT,label:{value:label.wirelessPwd},targetId:"wdsPwdCon",check:{blur:onPwdBlur,keyup:onPwdKeyup},props:{maxlength:"63",type:"text"}});this.twoGSsidInput=new Input({type:Input.TYPE.STATIC_TEXT,label:{value:label.wirelessName2G},targetId:"twoGSsidCon",check:{blur:checkSsidInput},props:{maxlength:"32",type:"text"}});this.twoGPwdInput=new Input({type:Input.TYPE.CIPHER_TEXT,label:{value:label.wirelessPwd},targetId:"twoGPwdCon",check:{blur:onPwdBlur,
keyup:onPwdKeyup},props:{maxlength:"63",type:"text"}});this.fiveGSsidInput=new Input({type:Input.TYPE.STATIC_TEXT,label:{value:label.wirelessName5G},targetId:"fiveGSsidCon",check:{blur:checkSsidInput},props:{maxlength:"32",type:"text"}});this.fiveGPwdInput=new Input({type:Input.TYPE.CIPHER_TEXT,label:{value:label.wirelessPwd},targetId:"fiveGPwdCon",check:{blur:onPwdBlur,keyup:onPwdKeyup},props:{maxlength:"63",type:"text"}});this.fiveG1SsidInput=new Input({type:Input.TYPE.STATIC_TEXT,label:{value:label.wirelessName5G1},
targetId:"fiveG1SsidCon",check:{blur:checkSsidInput},props:{maxlength:"32",type:"text"}});this.fiveG1PwdInput=new Input({type:Input.TYPE.CIPHER_TEXT,label:{value:label.wirelessPwd},targetId:"fiveG1PwdCon",check:{blur:onPwdBlur,keyup:onPwdKeyup},props:{maxlength:"63",type:"text"}});this.fiveG2SsidInput=new Input({type:Input.TYPE.STATIC_TEXT,label:{value:label.wirelessName5G2},targetId:"fiveG2SsidCon",check:{blur:checkSsidInput},props:{maxlength:"32",type:"text"}});this.fiveG2PwdInput=new Input({type:Input.TYPE.CIPHER_TEXT,
label:{value:label.wirelessPwd},targetId:"fiveG2PwdCon",check:{blur:onPwdBlur,keyup:onPwdKeyup},props:{maxlength:"63",type:"text"}})}});
wdsSsidPwdDialog.refresh=function(){for(var g=FREQ_2G;g<=FREQ_BS;g++)$("#root"+g+"Con").addClass("disNone"),$($("#root"+g+"Con .passwordCon input")[0]).removeClass("passwordStatic"),$("#root"+g+"Con input")[1].value="",$($("#root"+g+"Con input")[1]).attr("readonly",!1),$("#root"+g+"Con .passwordCon .inputLi")[0].className="inputLi";this.wdsSsidInput.setValue("");this.wdsPwdInput.setValue("");this.twoGSsidInput.setValue("");this.twoGPwdInput.setValue("");this.fiveGSsidInput.setValue("");this.fiveGPwdInput.setValue("");
this.fiveG1SsidInput.setValue("");this.fiveG1PwdInput.setValue("");this.fiveG2SsidInput.setValue("");this.fiveG2PwdInput.setValue("");this.wdsSsidInput.closeNote();this.wdsPwdInput.closeNote();this.twoGSsidInput.closeNote();this.twoGPwdInput.closeNote();this.fiveGSsidInput.closeNote();this.fiveGPwdInput.closeNote();this.fiveG1SsidInput.closeNote();this.fiveG1PwdInput.closeNote();this.fiveG2SsidInput.closeNote();this.fiveG2PwdInput.closeNote()};
function init(){function g(a){var m=[],b,d={},k;for(k in f)if(f.hasOwnProperty(k)&&f[k]){b=gWDSModel[k].wlan_scan;var e=d,c=k;b=a.wireless[b];for(var g=k,p=b.length,n=[],h=0;h<p;h++){var l=h+1;n[h]={};n[h].band=g;n[h].freq=g;n[h].freqArr=[g];n[h].freqInfo=gFreqInfo[g];n[h].ssid=b[h]["ap_"+l].ssid;n[h].encryption=b[h]["ap_"+l].encryption;n[h].rssi=b[h]["ap_"+l].rssi;n[h].signal=20<=b[h]["ap_"+l].rssi?30<=b[h]["ap_"+l].rssi?50<=b[h]["ap_"+l].rssi?5:4:3:10<=b[h]["ap_"+l].rssi?2:1;switch(parseInt(b[h]["ap_"+
l].encryption)){case uciWireless.encryptionType.none:l=label.wirelessNoSecurity;break;case uciWireless.encryptionType.psk2_psk:l=label.wirelessPsk;break;case uciWireless.encryptionType.wep:l=label.wirelessWep;break;case uciWireless.encryptionType.wpa2_wpa:l=label.wirelessWpa;break;case uciWireless.encryptionType.psk2_sae3:l=label.wirelessWpa2PskWpa3Sae;break;case uciWireless.encryptionType.sae3:l=label.wirelessWpa3Sae;break;case uciWireless.encryptionType.wpa3:l=label.wirelessWpa3;break;default:l=
label.wirelessUnknow}n[h].authMode=l}e[c]=n}for(k in f)if(f.hasOwnProperty(k)&&f[k])for(a=0;a<d[k].length;++a){e=!1;for(c=0;c<m.length;++c)if(m[c].ssid==d[k][a].ssid&&m[c].encryption==d[k][a].encryption){e=!0;m[c].rssi=Math.max(m[c].rssi,d[k][a].rssi);m[c].signal=Math.max(m[c].signal,d[k][a].signal);-1==$.inArray(d[k][a].freq,m[c].freqArr)&&(m[c].freqArr.push(d[k][a].freq),m[c].freqInfo=m[c].freqInfo+" & "+d[k][a].freqInfo,m[c].freq=BAND_STEER);break}e||m.push(d[k][a])}return m}function d(){var a=
{wireless:{table:[]}},b;for(b in f)f.hasOwnProperty(b)&&f[b]&&a.wireless.table.push(gWDSModel[b].wlan_scan);$.query(a,function(a){ENONE==a[ERR_CODE]?(c=g(a),c.sort(function(a,b){var c=parseInt(a.rssi),d=parseInt(b.rssi);return c>d?1:c==d?0:-1}),c=c.slice(-p),wdsTargetIndex=[],wdsTargetSelFreq={}):(c=[],c.length=0,errHandle(a[ERR_CODE]));r.setDataSource(c);r.closeLoading(function(){r.loadData()})})}function b(a){a={wireless:{name:[]}};for(var c in f)f.hasOwnProperty(c)&&f[c]&&a.wireless.name.push(gWDSModel[c].wlan_scan_status);
$.query(a,function(a){var c=!0,e;for(e in a.wireless)a.wireless.hasOwnProperty(e)&&1!=a.wireless[e].status&&(c=!1);!0==c?(wdsIsScanning=!1,d()):$.setTimeout(b,2E3)})}function e(){wdsTargetIndex=[];s.setState({type:Button.TYPE.SECONDARY});r.showLoading();if(slp.bandSteeringProvided&&"1"==gLocalAPInfo[FREQ_BS].bs_enable){if("1"==gLocalAPInfo[FREQ_BS].wifi_enable)for(var a in gKeyNames[slp.bandsProvided-1].wlan_wds)gKeyNames[slp.bandsProvided-1].wlan_wds.hasOwnProperty(a)&&null!=gKeyNames[slp.bandsProvided-
1].wlan_wds[a]&&(f[a]=!0)}else for(a in gLocalAPInfo)gLocalAPInfo.hasOwnProperty(a)&&FREQ_BS!=a&&(f[a]="1"==gLocalAPInfo[a].enable);if(!wdsIsScanning){for(var c in f)f.hasOwnProperty(c)&&f[c]&&($.action(gWDSModel[c].scan_start,void 0,void 0,!0),wdsIsScanning=!0);$.setTimeout(b,3E3)}}function t(){if(0==wdsTargetIndex.length)alarmDialog.show("请选择您要中继的条目");else{var a=!1,c;for(c in wdsTargetSelFreq)if(wdsTargetSelFreq[c].selected&&"0"!=gRootAPInfo[c].encryption){a=!0;break}a?inputRootApPwd():wdsNextStep()}}
var p,c=[],r,f=[];f[FREQ_2G]=!1;f[FREQ_5G]=!1;f[FREQ_5G1]=!1;f[FREQ_5G4]=!1;switch(slp.bandsProvided-1){case BAND_3:p=192;break;case BAND_2:p=128;break;default:p=64}new Button({text:btn.preStep,onClick:function(){gIsWifiCfgBsChged=gIsWifiCfg5G4Chged=gIsWifiCfg5GChged=gIsWifiCfg2GChged=gIsWifiCfgChged=!1;loadPage("WizardWirelessRepeater.htm","wizardCon")},type:Button.TYPE.SECONDARY,id:"pre",props:{width:"120px"}});var s=new Button({text:btn.nextStep,onClick:function(){slp.wifiSwitchSupport?checkWifiSwitchOff(t):
t()},type:Button.TYPE.SECONDARY,id:"next",props:{width:"240px",margin:"0px 0 0 8px"}});if(slp.bandSteeringProvided&&"1"==gLocalAPInfo[FREQ_BS].bs_enable){if("1"==gLocalAPInfo[FREQ_BS].wifi_enable)for(var q in gKeyNames[slp.bandsProvided-1].wlan_wds)gKeyNames[slp.bandsProvided-1].wlan_wds.hasOwnProperty(q)&&null!=gKeyNames[slp.bandsProvided-1].wlan_wds[q]&&(f[q]=!0)}else for(q in gLocalAPInfo)gLocalAPInfo.hasOwnProperty(q)&&FREQ_BS!=q&&(f[q]="1"==gLocalAPInfo[q].enable);(function(){r=new Table({targetId:"wdsScanTable",
title:"请选择你需要中继的前端路由器：",head:[{field:label.wirelessNa,width:"0.37"},{field:label.bandInfo,width:"0.14"},{field:label.sigDep,width:"0.14",props:{"text-align":"center"}},{field:label.secInfo,width:"0.24"}],column:[{name:"ssid",type:"str"},{name:"freqInfo",type:"str"},{name:"signal",type:"signal"},{name:"authMode",type:"str"}],tableOption:[{icon:"icon-refresh",str:btn.refresh,type:"refresh",func:function(){e()}}],clickList:{click_check:{func:function(a,b,d){d=c[b].freq;var e=c[b].freqArr,f=c[b].encryption;
if($(a).find("label.checkbox").hasClass("checked")){if(d==FREQ_BS)for(a=0;a<e.length;a++);if(f==uciWireless.encryptionType.none||f==uciWireless.encryptionType.psk2_psk||slp.wpa3Support&&(f==uciWireless.encryptionType.psk2_sae3||f==uciWireless.encryptionType.sae3)){for(a=0;a<c.length;a++)a==b||$($("#wdsScanTable label.checkbox")[c.length-1-a]).hasClass("checked")||d!=BAND_STEER&&c[a].freq!=BAND_STEER&&c[a].freq!=d||$($("#wdsScanTable label.checkbox")[c.length-1-a]).removeClass("checked").addClass("disabled");
s.setState({type:Button.TYPE.PRIMARY});-1==$.inArray(b,wdsTargetIndex)&&wdsTargetIndex.push(b);if(d==BAND_STEER)for(a=0;a<e.length;++a)wdsTargetSelFreq[a]={selected:!0,bs:!0},gRootAPInfo[a].ssid=c[b].ssid,gRootAPInfo[a].encryption=parseInt(f);else wdsTargetSelFreq[d]={selected:!0,bs:!1},gRootAPInfo[d].ssid=c[b].ssid,gRootAPInfo[d].encryption=parseInt(f)}else slp.wpa3Support||f!=uciWireless.encryptionType.psk2_sae3&&f!=uciWireless.encryptionType.sae3?alarmDialog.show(slp.wpa3Support?label.encryptOldWithWpa3:
label.encryptOld):alarmDialog.show(label.encryptUnsupport)}else{if(d==BAND_STEER)for(a=0;a<e.length;++a)wdsTargetSelFreq[a]={selected:!1,bs:!1};else wdsTargetSelFreq[d]={selected:!1,bs:!1};-1!=$.inArray(b,wdsTargetIndex)&&wdsTargetIndex.splice($.inArray(b,wdsTargetIndex),1);if(0==wdsTargetIndex.length)s.setState({type:Button.TYPE.SECONDARY}),$("#wdsScanTable label.checkbox.disabled").removeClass("disabled");else for(a=0;a<c.length;a++)d==c[a].freq&&$($("#wdsScanTable label.checkbox")[c.length-1-a]).removeClass("disabled")}}}},
loadingOptions:{str:label.scaningWiFiSignal},blankOptions:{str:label.nonWdsScanData},hasAllCheckBox:!1,editable:!1,hasCheckBox:!0,deletable:!1,addable:!1,hasFixedHeight:7,numPerPage:7,max:p})})();e()}init();
</script><style type="text/css">#root0Con.pwdStatic,#root1Con.pwdStatic,#root2Con.pwdStatic,#root3Con.pwdStatic,#root4Con.pwdStatic i.eye{display:none}li.inputLi>input.passwordStatic{border:0}li.inputLi>input.passwordStatic+i.eye{display:none}span.wdsSsidPwdDesc{display:block;height:20px;line-height:20px;margin-bottom:16px}div.wdsSsidPwdInput label.outerLbl{width:96px}i.radio[name="wdsScanRadio"]{cursor:pointer}#wdsScanTable{width:760px;margin:0 auto}#wdsScanTable span.tableTitleText{font-size:13px;color:#333}.wdsScanStepBtn{margin-top:40px;margin-left:492px}</style>