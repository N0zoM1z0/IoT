

<ul class="wzdUl">
	<li class="wizardSkip"><span class="wzdSkipDes">{%label.skipWzd%}</span></li>
	<li class="wizardBody" id="wizardBody">
		<h1>{%menuStr.wifi%}</h1>
		<div class="topTitle">
			<label>{%label.multiBandIntegration%}</label>
			<div id="bsSwitch" class="switchCon">
				<i class="switchBg"></i>
				<i class="switchBall"/></i>
			</div>
			<p>{%label.bsHelp%}</p>
		</div>
		<div id="editingArea"></div>
	</li>
	<li class="wzdSubBtn">
		<div id="pre"></div>
		<div id="sub"></div>
	</li>
</ul><script type="text/javascript">function init(){function s(a){function b(b,e,k){d.push({name:b,title:e,follow:k,ssid:a[b][uciWireless.dynOptName.ssid],key:a[b][uciWireless.dynOptName.key]})}var d=[];switch(slp.bandsProvided){case slp.SINGLE:b(uciWireless.dynData.host_2g);break;case slp.DOUBLE:!0==g?b(uciWireless.secName.wlanBS):(b(uciWireless.dynData.host_2g,label.wirelessNet2G),b(uciWireless.dynData.host_5g,label.wirelessNet5G,gWizardData.followPwd[0]));break;case slp.TRIPLE:!0==g?b(uciWireless.secName.wlanBS):(b(uciWireless.dynData.host_2g,
label.wirelessNet2G),b(uciWireless.dynData.host_5g1,label.wirelessNet5G1,gWizardData.followPwd[1]),b(uciWireless.dynData.host_5g2,label.wirelessNet5G2,gWizardData.followPwd[2]))}return d}function t(){var a=id("editingArea");emptyNodes(a);f=[];s(gWizardData.wifiConf).forEach(function(b){var d,c;void 0!=b.title&&(d=document.createElement("p"),d.className="blockTitle",d.innerHTML=b.title,a.appendChild(d));c=new Input({type:Input.TYPE.PLAIN_TEXT,label:{value:label.wirelessName,position:Input.LABEL.INNER},
targetId:"editingArea",check:{blur:z},props:{maxlength:"32",type:"text",value:b.ssid}});c.argument={name:b.name,opt:uciWireless.dynOptName.ssid};f.push(c);c=new Input({type:Input.TYPE.CIPHER_TEXT,label:{value:label.wirelessPwd,position:Input.LABEL.INNER},strength:{show:!0,least:8,critical:12},targetId:"editingArea",check:{blur:onPwdBlur,keyup:A},props:{maxlength:"63",type:"text",value:b.key}});c.argument={name:b.name,opt:uciWireless.dynOptName.key};f.push(c);void 0!=b.follow&&(d=document.createElement("ul"),
d.className="inputCMPT",d.id=b.name+(new Date).getTime(),a.appendChild(d),b=new CheckBox({targetId:d.id,label:label.wlanWzdUse2gPwdFor5g,onClick:function(){u.call(this,c)},checked:b.follow}),u.call(b.checkbox,c))});$("#editingArea").find("ul:last-child").css("margin-bottom","0")}function z(){return""==this.input.value?(this.showNote(errStr.wlanSsidErr),!1):/^ +$/gi.test(this.input.value)?(this.showNote(errStr.wlanSsidBlank),!1):checkWifiName(this.input.value,B,C)?!0:(this.showNote(errStr.wlanSsidLenErr),
!1)}function A(){var a=this;if(EINVWLANPWD==checkWlanPwd(this.input.value))return this.showNote(errStr.wlanWzdPwdValid),!1;this.argument.name==uciWireless.dynData.host_2g&&gWizardData.followPwd.forEach(function(b,d){if(b)switch(d){case 0:l({name:uciWireless.dynData.host_5g,opt:uciWireless.dynOptName.key}).setValue(a.input.value);break;case 1:l({name:uciWireless.dynData.host_5g1,opt:uciWireless.dynOptName.key}).setValue(a.input.value);break;case 2:l({name:uciWireless.dynData.host_5g2,opt:uciWireless.dynOptName.key}).setValue(a.input.value)}});
return!0}function D(){var a=5;(function d(){if(0==a--)loadingDialog.hide(function(){loadPage("WizardEnd.htm","wizardCon")});else{var c={},e=cloudClientStatus.fileName,k=cloudClientStatus.secName.clientInfo,E=cloudClientStatus.optName.connectStatus;c[e]={};c[e][KEY_NAME]=k;$.query(c,function(a){ENONE==a[ERR_CODE]&&1==a[e][k][E]?loadingDialog.hide(function(){loadPage("WizardCloudMEID.htm","wizardCon")}):$.setTimeout(d,1E3)},void 0,!0)}})()}function m(a){var b={};b[uciHostsInfo.fileName]={};b[uciHostsInfo.fileName][KEY_TABLE]=
uciHostsInfo.dynData.online_host;$.query(b,function(b){formatTableData(b[uciHostsInfo.fileName][uciHostsInfo.dynData.online_host]).forEach(function(b){"1"==b[uciHostsInfo.optName.isCurHost]&&"0"!=b[uciHostsInfo.optName.type]&&(gWizardData.iAmWifiDevice=!0)});"function"==typeof a&&a()})}function p(){gWizardData.wifiChanged&&gWizardData.iAmWifiDevice?loadingDialog.hide(function(){gWizardData.wifiDisconnect=!0;loadPage("WizardEnd.htm","wizardCon")}):D()}function v(){function a(){if(slp.g11AXSupport.wlan2g||
slp.g11AXSupport.wlan5g||slp.g11AXSupport.wlan5g1||slp.g11AXSupport.wlan5g4){var a={};a.system={sys_mode:{mode:uciSystem.optValue.sysMode.apMode}};switch(slp.bandsProvided-1){case BAND_1:a.wireless={wlan_wds_2g:{enable:"0"}};break;case BAND_2:a.wireless={wlan_wds_2g:{enable:"0"},wlan_wds_5g:{enable:"0"}};break;case BAND_3:a.wireless={wlan_wds_2g:{enable:"0"},wlan_wds_5g_1:{enable:"0"},wlan_wds_5g_4:{enable:"0"}}}$.modify(a,function(b){!1==errHandle(b[ERR_CODE])&&(gSysMode=uciSystem.optValue.sysMode.apMode,
n=0,loadingDialog.show({content:"正在中继..."}),q())});loadPage("WizardWirelessAx.htm","wizardCon")}else a={},a[uciWireless.fileName]=b,!0==gWizardData.wifiChanged&&!0==gWizardData.iAmWifiDevice?p():(loadingDialog.show({content:{primary:label.configging}},void 0,void 0,!1,void 0),wzdDone(),$.modify(a,function(a){a[ERR_CODE]==ENONE?(s(gWizardData.wifiConf).forEach(function(a){void 0!=b[a.name]&&(void 0!=b[a.name].ssid&&(gWizardData.wifiConf[a.name].ssid=b[a.name].ssid),void 0!=b[a.name].key&&(gWizardData.wifiConf[a.name].key=
b[a.name].key))}),slp.bandSteeringProvided&&(gWizardData.wifiConf[uciWireless.secName.wlanBS][uciWireless.optName.bsEnable]=g?h:w),p()):loadingDialog.hide(function(){alarmDialog.show(errStr.unknown+a[ERR_CODE])})},void 0,!0))}var b={},d,c=0,e={};gWizardData.gWifiCfgSave=null;f.forEach(function(a){var c=a.argument.name,d=a.argument.opt,e=uciWireless.dynOptValue.encryption.on,f=uciWireless.dynOptValue.encryption.off;gWizardData.wifiConf[c][d]!=a.getValue()&&(b[c]=b[c]||{},b[c][d]=a.getValue(),d==uciWireless.dynOptName.key&&
(b[c][uciWireless.dynOptName.encryption]=0==a.getValue().length?f:e),gWizardData.wifiChanged=!0);slp.bandSteeringProvided&&g!=(h==gWizardData.wifiConf[uciWireless.secName.wlanBS][uciWireless.optName.bsEnable])&&(void 0==b[uciWireless.secName.wlanBS]&&(b[uciWireless.secName.wlanBS]={}),b[uciWireless.secName.wlanBS][uciWireless.optName.bsEnable]=g?h:w,gWizardData.wifiChanged=!0)});gWizardData.gWifiCfgSave=b;gWizardData.isBandSteeringOpen=g;d=Object.keys(b);if(gWizardData.wifiChanged){e={};e[uciWireless.fileName]=
{};e[uciWireless.fileName][KEY_NAME]=[];for(c=0;c<d.length;c++)switch(d[c]){case uciWireless.dynData.host_2g:e[uciWireless.fileName][KEY_NAME].push("wps_status_2g");break;case uciWireless.dynData.host_5g:e[uciWireless.fileName][KEY_NAME].push("wps_status_5g");break;case uciWireless.dynData.host_5g1:e[uciWireless.fileName][KEY_NAME].push("wps_status_5g1");break;case uciWireless.dynData.host_5g2:e[uciWireless.fileName][KEY_NAME].push("wps_status_5g4")}$.query(e,function(b){if(b[ERR_CODE]==ENONE){var d=
!1;for(c=0;c<e[uciWireless.fileName][KEY_NAME].length;c++)d=d&&1==b[uciWireless.fileName][e[uciWireless.fileName][KEY_NAME][c]].status;d?confirmDialog.show({content:label.wpsConfigShowTip,callback:function(b){b&&m(a)}}):m(a)}else m(a)})}else slp.g11AXSupport.wlan2g||slp.g11AXSupport.wlan5g||slp.g11AXSupport.wlan5g1||slp.g11AXSupport.wlan5g4?m(function(){loadPage("WizardWirelessAx.htm","wizardCon")}):(loadingDialog.show({content:{primary:label.configging}},void 0,void 0,!1,void 0),wzdDone(),p())}function F(){confirmDialog.show({content:"中继失败，请确定是否重试？",
button:{confirmStr:"下一步",cancelStr:"重试"},callback:function(a){a?(n=0,loadingDialog.show({content:"正在中继..."}),q()):loadPage("WizardWirelessCfg.htm","wizardCon")}})}function q(){clearTimeout(x);20<n?loadingDialog.hide(function(){F()}):$.query({wired_extender:{name:"status"}},function(a){a.error_code==ENONE&&("0.0.0.0"==a.wired_extender.status.ip?(n++,x=$.setTimeout(q,1E3)):loadingDialog.hide(function(){gLanIP=a.wired_extender.status.ip;loadPage("WizardWirelessCfg.htm","wizardCon")}))})}function l(a){for(var b in f)if(f.hasOwnProperty(b)&&
f[b].argument.name==a.name&&f[b].argument.opt==a.opt)return f[b];return{}}function u(a){this.checked?(a.setValue(l({name:uciWireless.dynData.host_2g,opt:uciWireless.dynOptName.key}).getValue()),a.disable(!0)):a.disable(!1);switch(a.argument.name){case uciWireless.dynData.host_5g:gWizardData.followPwd[0]=this.checked;break;case uciWireless.dynData.host_5g1:gWizardData.followPwd[1]=this.checked;break;case uciWireless.dynData.host_5g2:gWizardData.followPwd[2]=this.checked}}function G(a){g=h==a;t()}var B=
32,C=1,h=uciWireless.optValue.bsEnable.enable,w=uciWireless.optValue.bsEnable.disable,g,f=[],r=!1,x=null,n;new Button({text:btn.preStep,onClick:function(){var a;switch(gWizardData.networkConf[uciProto.secName.wan][uciProto.optName.type]){case uciProto.optValue.proto.pppoe:a=LINK_TYPE_PPPOE;break;case uciProto.optValue.proto.dynIp:a=LINK_TYPE_DHCP;break;case uciProto.optValue.proto.staticIp:a=LINK_TYPE_STATIC_IP;break;default:a=LINK_TYPE_PPPOE}slp.gSysModeSupport&&gSysMode==uciSystem.optValue.sysMode.wdsMode&&
(a=LINK_TYPE_WIRELESS_REPEATER);slp.gSysModeSupport&&gSysMode==uciSystem.optValue.sysMode.apMode&&(a=LINK_TYPE_WIRED_REPEATER);wzdNetWorkModeChange(a)},type:Button.TYPE.SECONDARY,id:"pre"});new Button({text:btn.nextStep,onClick:function(){function a(){d?confirmDialog.show({content:label.confirmNoWirelessPwd,isCloseHandleBindSubmit:!0,button:{cancelStr:btn.noConfig,confirmStr:btn.goConfig},callback:function(a){a?c.input.select():v()}}):v()}var b=!0,d=!1,c=null,e=null;r=!1;f.forEach(function(a){a.disabled||
(b=a.checkAll()&&b,a.argument.opt==uciWireless.dynOptName.key&&""==a.getValue()&&(null==c&&(c=a),d=!0),a.argument.opt==uciWireless.dynOptName.ssid&&checkStrHasCN(a.getValue())&&(null==e&&(e=a),r=!0))});b&&(r?confirmDialog.show({content:label.confirmSsidHasCNChar,isCloseHandleBindSubmit:!0,button:{confirmStr:btn.btnY,cancelStr:btn.btnN},callback:function(b){b?e.input.select():a()}}):a())},type:Button.TYPE.PRIMARY,id:"sub"});var y=new NiceScroll({targetId:"wizardBody",hrzLine:!0});y.scrollTipOpacity(1);
y.init();slp.bandSteeringProvided&&(g=h==gWizardData.wifiConf[uciWireless.secName.wlanBS][uciWireless.optName.bsEnable]);t();slp.bandSteeringProvided&&($("div.topTitle").css("display","block"),new Switch("bsSwitch",g?1:0,G,!1))}init();
</script><style type="text/css">p.blockTitle{font-size:16px;color:#333;font-weight:bold;margin:24px 0 12px 317px;text-align:left}li.wzdSubBtn div.primary{width:160px!important}div.topTitle{width:280px;margin:24px auto;display:none}div.topTitle label{font-size:16px;color:#333;line-height:24px;font-weight:bold;vertical-align:middle;display:inline-block;width:240px;margin-right:8px}div.topTitle p{font-size:12px;color:#666;text-align:justify;line-height:18px;margin-top:12px}li.wizardBody{min-height:132px}</style>