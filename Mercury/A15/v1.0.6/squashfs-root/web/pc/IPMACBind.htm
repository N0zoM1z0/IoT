
<div class="head">
	<div class="title"><h1>{%menuStr.IPMACBind%}</h1><i class="helpBtn iconfont icon-help" helpStr="IPMACBindHelp"></i></div>
	<p class="description">{%titleDescriptionStr.ipMacBindDescription%}</p>
	<ul class="relayErrorTip">
		<i class="iconfont icon-warn"></i>
		<span id="relayTipText"></span>
	</ul>
</div>
<div id="ipMacMapTable"></div>
<div id="ipMacBindTable" class="advanceTable"></div><script type="text/javascript">(function(){function r(b){var a="";switch(b){case ENONE:return!0;case EINVIP:a=errStr.ipAddrErr;break;case EINVIPFMT:a=errStr.ipAddrFmtErr;break;case EINVGROUPIP:a=errStr.ipAddrGroupErr;break;case EINVLOOPIP:a=errStr.ipAddrLoopErr;break;case EHOSTNAME:a=errStr.hostLenErr;break;case ENOTLANWANNET:a=errStr.ipAddrNotLanWanNetErr;break;case EINVMACFMT:a=errStr.macFmtErr;break;case EBINDIPUSED:a=errStr.bindIpUsedErr;break;case EENTRYCONFLIC:a=errStr.entryConflicErr;break;case EENTRYEXIST:a=errStr.entryExistErr;
break;case ESYSTEM:a=errStr.systemErr;break;case ETABLEFULL:a=errStr.tableFullErr;break;case EENTRYNOTEXIST:a=errStr.entryNoExistErr;break;default:a=errStr.unknown+b}alarmDialog.show(a);return!1}function q(b){var a={};a[m]={};a[m][KEY_TABLE]=[s,uciArp.dynData.sysArp];slp.gSysModeSupport&&(a.system={name:"sys_mode"});$.query(a,function(a){var h=0,h=0,g;n=formatTableData(a[m][uciArp.dynData.sysArp])||[];for(var h=n.length,d=0;d<h;d++)g=n[d],g.showHostName=""==g[p]?label.anonymousHost:g[p];g=u.getCurrentPage();
u.setDataSource(n);u.loadData(g);f=formatTableData(a[m][s])||[];h=f.length;for(d=0;d<h;d++)g=f[d],g.showHostName=""==g[p]?label.anonymousHost:g[p];a=v.getCurrentPage();v.setDataSource(f);v.loadData(a);"refresh"==b&&showToast(label.refreshSuccess)})}function y(b){var a=!1,e,h=n[b][p],g=n[b][k];b=n[b][l];for(var d in f)if(f.hasOwnProperty(d)&&(g==f[d][k]||b==f[d][l])){a=!0;e=f[d][SEC_NAME];break}if(a){a={};d={};var c={};a[m]=d;d[e]=c;c[k]=g;c[l]=b;c[p]=h;showLoading();$.modify(a,function(a){closeLoading();
r(a[ERR_CODE])&&(showToast(label.bindSuccess),$.setTimeout(function(){q("normal")},100))},void 0,!0)}else a={},d={},c={},a[m]=d,d[KEY_TABLE]=s,d[KEY_NAME]=s+"_"+calcNextIndex(f),d[KEY_PARA]=c,c[k]=g,c[l]=b,c[p]=h,showLoading(),$.add(a,function(a){closeLoading();r(a[ERR_CODE])&&(showToast(label.bindSuccess),$.setTimeout(function(){q("normal")},100))},void 0,!0)}function x(b){var a=b.split("-");b=[];for(var e=0;e<a.length;e++)f[a[e]][SEC_NAME]&&(b[e]=f[a[e]][SEC_NAME]);a={};e={};a[m]=e;e[KEY_NAME]=
b;showLoading();$.del(a,function(a){closeLoading();r(a[ERR_CODE])&&(showToast(label.unbindSuccess),$.setTimeout(function(){q("normal")},100))},void 0,!0)}function z(b,a,e,h){var g=a.showHostName,d=a[l];a=hideLeadingZeros(a[k]);for(var c in f)if(f.hasOwnProperty(c)&&c!=e&&f[c][k]&&(f[c][k]==a||f[c][l]==d))return h(r(EENTRYCONFLIC));if("add"==b)b={},e={},c={},b[m]=e,e[KEY_TABLE]=s,e[KEY_NAME]=s+"_"+calcNextIndex(f),e[KEY_PARA]=c,c[k]=a,c[l]=d,c[p]=g,$.add(b,function(a){r(a[ERR_CODE])?(h(!0),showToast(label.bindSuccess),
$.setTimeout(function(){q("normal")},100)):h(!1)});else if("edit"==b){var n=f[e][SEC_NAME];b={};e={};c={};b[m]=e;e[n]=c;c[k]=a;c[l]=d;c[p]=g;$.modify(b,function(a){r(a[ERR_CODE])?(h(!0),showToast(label.bindSuccess),$.setTimeout(function(){q("normal")},100)):h(!1)})}}var n=[],f=[],m=uciArp.fileName,s=uciArp.secType.arp,k=uciArp.optName.ipAddr,l=uciArp.optName.mac,p=uciArp.optName.hostname,A=uciArp.optName.status,w=0,t=!1,u=null,v=null;(function(b){slp.gSysModeSupport?$.query({system:{name:"sys_mode"}},
function(a){w=a.system.sys_mode.mode;0!=w&&(t=!0,$(".relayErrorTip").show(),1==w?$("#relayTipText").text("上网方式为AP（有线中继）时，无法使用IP与MAC绑定功能。"):$("#relayTipText").text("上网方式为桥接（无线中继）时，无法使用IP与MAC绑定功能。"));b(t)}):b(t)})(function(){u=new Table({targetId:"ipMacMapTable",title:label.ipMacMapTab,head:[{field:label.host,width:"0.32"},{field:label.mac,width:"0.32"},{field:label.ipAddr,width:"0.24"},{field:label.curStatus,width:"0.12"}],column:[{name:"showHostName",type:"str",maxLength:DEVICE_NAME_LEN_MAX},{name:l,
type:"mac"},{name:k,type:"ip"},{name:A,type:"strSelect",options:[{str:label.ipMacBindNoBind,value:0},{str:label.ipMacBindBinded,value:1}]}],tableOption:[{icon:"icon-refresh",str:btn.refresh,selRelate:!1,type:"refresh",func:function(){q("refresh")}}],itemOption:[{icon:"icon-connect",type:"bind",str:btn.bind,func:y,onRender:function(b){return 0==b.status?{result:!1}:{result:!0,str:""}}}],deletable:!1,editable:!1,addable:!1,hasCheckBox:!1,disableState:t});v=new Table({targetId:"ipMacBindTable",title:label.ipMacBindSet,
head:[{field:label.host,width:"0.32"},{field:label.mac,width:"0.32"},{field:label.ipAddr,width:"0.36"}],column:[{name:"showHostName",type:"str",maxLength:DEVICE_NAME_LEN_MAX},{name:l,type:"mac"},{name:k,type:"ip"}],tableOption:[{icon:"icon-disconnect",str:btn.unbindSel,type:"unbind",func:x,selRelate:!0}],clickList:{click_save:{func:z,asyn:!0}},itemOption:[{icon:"icon-disconnect",str:btn.unbind,type:"unbind",func:x}],deletable:!1,max:IP_MAC_BIND_RULE_MAX,disableState:t});q("normal")})})();
</script>