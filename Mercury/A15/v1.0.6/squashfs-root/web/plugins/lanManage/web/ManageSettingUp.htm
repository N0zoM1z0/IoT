


<div class="head">
	<div class="title"><h1>{%label.localWebManage%}</h1><i class="helpBtn iconfont icon-help" helpStr="manageSULclHelp"></i></div>
	<p class="description">{%titleDescriptionStr.localWebManageDescription%}</p>
</div>
<ul class="inputCMPT medium">
	<label class="outerLbl">{%label.localWebManage%}</label>
	<div id="webManageOn" class="webManageRadio"></div>
	<div id="webManageOff" class="webManageRadio"></div>
</ul>
<ul class="inputCMPT medium" id="openContent">
	<div id="macContent"></div>
	<ul class="inputCMPT">
		<label class="outerLbl"></label>
		<a id="chooseEpt">{%label.chooseEpt%}></a>
	</ul>
	<ul class="inputCMPT medium">
		<label class="outerLbl"></label>
		<a id="menualAdd">{%label.menualAdd%}></a>
	</ul>
</ul>
<div id="save"></div>
<script type="text/javascript">(function(){function l(b){var a="";switch(b){case ENONE:return!0;case ETABLEEMPTY:a=errStr.lclMngHostEmptyErr;break;case EENTRYCONFLIC:a=errStr.lclMngHostDupErr;break;case EINVMACFMT:a=errStr.macFmtErr;break;case EINVMACZERO:a=errStr.macZeroErr;break;case EINVMACBROAD:a=errStr.macBroadErr;break;case EINVMACGROUP:a=errStr.macGroupErr;break;default:a=errStr.unknown+b}alarmDialog.show(a);return!1}function t(){for(var b=!0,a=[],e=c.length-1;0<=e;e--){if(""==c[e].getValue()||"00-00-00-00-00-00"==c[e].getValue())return c[e].showNote(errStr.inputMac),
!1;if(!c[e].checkAll())return!1;b=c[e].getValue().toUpperCase();if(-1!=a.join().indexOf(b))return l(EENTRYCONFLIC);a[e]=b;b=!1}return!0==k.getValue()&&!0==b?l(ETABLEEMPTY):!0}function r(){var b={},a={},e={};b[uciFirewall.fileName]=a;a[uciFirewall.secName.lanManage]=e;!0==k.getValue()?e[uciFirewall.optName.enableAll]=uciFirewall.optValue.lanManage.some:e[uciFirewall.optName.enableAll]=uciFirewall.optValue.lanManage.all;for(a=0;a<c.length;a++)e[uciFirewall.optName.mac+(a+1)]=c[a].getValue();for(a=c.length;a<
h;a++)e[uciFirewall.optName.mac+(a+1)]="00-00-00-00-00-00";$.modify(b,function(a){l(a[ERR_CODE])&&showToast(label.saveSuccess)})}function u(){for(var b=0;b<c.length;b++)if(s==c[b].getValue().toUpperCase())return!0;return!1}function m(){var b=checkMac(this.input.value);if(""==this.input.value||"00-00-00-00-00-00"==this.input.value||ENONE==b)return!0;this.showNote(errStr.inputCorrectMac);return!1}function v(b){var a={};a[uciHostsInfo.fileName]={};a[uciHostsInfo.fileName][KEY_TABLE]=uciHostsInfo.dynData.host_info;
a[uciNetwork.fileName]={};a[uciNetwork.fileName][KEY_NAME]=uciNetwork.dynData.ifaceMac;$.query(a,function(a){if(ENONE==a[ERR_CODE]){var d,h;if(null!=a&&null!=a[uciHostsInfo.fileName]&&null!=a[uciHostsInfo.fileName][uciHostsInfo.dynData.host_info]){h=formatTableData(a[uciHostsInfo.fileName][uciHostsInfo.dynData.host_info]);var g=f.length=0;for(d in h)if(a=h[d],a.blocked==n.unBlock&&(a.type==n.inet||a.type==n.wirelessH)){f[g]={};0==a.hostname.length&&(a.hostname=label.anonymousHost);f[g].name=a.hostname;
f[g].ip=a.ip;f[g].ipv6=a.ipv6;f[g].mac=a.mac;f[g].isCurHost=a.is_cur_host;f[g].type=a.type;f[g].blocked=a.blocked;f[g].up=a.up_speed;f[g].upLimit=a.up_limit;f[g].down=a.down_speed;f[g].downLimit=a.down_limit;for(var k=0;k<c.length;k++)a.mac.toUpperCase()==c[k].getValue()&&(f[g].checkboxDisabled=!0,f[g].checkboxDisabledChecked=!0);g++}for(d=0;d<f.length;d++)if("1"==f[d].isCurHost){d=f.splice(d,1);f.push(d[0]);break}}b(f)}})}function p(){var b=parseInt(this.id.split("rmMac")[1]);c[b].dom.remove();for(c.splice(b,
1);b<c.length;b++)c[b].setLabel(label.mac+(b+1)),c[b].innerElm.id="rmMac"+b;c.length<h&&($("#chooseEpt").removeClass("disable"),$("#menualAdd").removeClass("disable"))}function w(b){var a=b[uciFirewall.fileName][uciFirewall.secName.lanManage];s=b[uciNetwork.fileName][uciNetwork.dynData.ifaceMac][uciNetwork.optValue.ifname.host].toUpperCase();"1"==a[uciFirewall.optName.enableAll]?x.setValue(!0):($("#openContent").show(),k.setValue(!0));for(b=0;b<h;b++){var e=a[uciFirewall.optName.mac+(b+1)];if("00-00-00-00-00-00"!=
e){var d=new Input({type:Input.TYPE.PLAIN_TEXT,label:{value:label.mac+(c.length+1)},targetId:"macContent",check:{blur:m},props:{maxlength:"17",type:"text"},innerElement:{id:"rmMac"+c.length,className:"checkboxElement"}});$("#rmMac"+c.length).html('<i class="iconfont icon-delete rmIcon"></i><span>'+label.remove+"</span>");id("rmMac"+c.length).onclick=p;d.setValue(e?e:"0");c.push(d)}}}var h=4,y=$.authRltObj.group,s="00-00-00-00-00-00",c=[],f=[],n={inet:0,wirelessH:1,wirelessG:2,block:1,unBlock:0,unLimit:0,
offline:0,online:1},k=new Radio({targetId:"webManageOn",label:label.open,name:"webManageEnable",onClick:function(){$("#openContent").show()}}),x=new Radio({targetId:"webManageOff",label:label.close,name:"webManageEnable",onClick:function(){$("#openContent").hide()}});new Button({text:btn.save,onClick:function(){if(!1!=t()){for(var b=c.length-1;0<=b;b--){var a=c[b].getValue();if(""==a||"00-00-00-00-00-00"==a)c[b].innerElm.onclick();else c[b].setValue(a.toUpperCase())}!1!=k.getValue()&&!0!=u()&&y==
USER_GROUP_ADMIN?confirmDialog.show({title:label.confirmTitle,content:label.localWebManageForbidNote,callback:function(a){!0==a&&r()}}):r()}},type:Button.TYPE.PRIMARY,id:"save",props:{width:"240px",margin:"24px 0 0 132px"}});var q=new Dialog({title:label.chooseEpt,content:'<div class="selectParentTitleDesc">'+label.chooseWebVisitor+'</div><ul id="eptSelectTable"></ul>',size:component.Dialog.SIZE.MEDIUM,type:component.Dialog.TYPE.CUSTOM,hasCloseIcon:!0,bottom:[{type:component.Button.TYPE.SECONDARY,
text:btn.cancelTip,id:"eptSelectTableCancel",onClick:function(){q.hide()}},{type:component.Button.TYPE.PRIMARY,text:btn.confirmTip,id:"eptSelectTableSubmit",onClick:function(){for(var b=eptSelectTable.table.childNodes[0].childNodes,a=1;a<b.length;a++){var e=b[a].childNodes[0].childNodes[1],d=b[a].childNodes[2].innerText;$(e).hasClass("checked")&&!$(e).hasClass("disabled")&&(e=new Input({type:Input.TYPE.PLAIN_TEXT,label:{value:label.mac+(c.length+1)},targetId:"macContent",check:{blur:m},props:{maxlength:"17",
type:"text"},innerElement:{id:"rmMac"+c.length,className:"checkboxElement"}}),$("#rmMac"+c.length).html('<i class="iconfont icon-delete rmIcon"></i><span>'+label.remove+"</span>"),id("rmMac"+c.length).onclick=p,e.setValue(d?d:"0"),c.push(e))}c.length>=h&&($("#chooseEpt").addClass("disable"),$("#menualAdd").addClass("disable"));q.hide()}}],renderCallBack:function(){eptSelectTable=new Table({targetId:"eptSelectTable",head:[{field:label.deviceName,width:"0.2"},{field:label.mac,width:"0.25"},{field:label.ipv4Addr,
width:"0.2"},{field:label.ipv6Addr,width:"0.35"}],column:[{name:"name",type:"deviceName"},{name:"mac",type:"mac"},{name:"ip",type:"ip"},{name:"ipv6",type:"str"}],editable:!1,deletable:!1,addable:!1,numPerPage:5})}});id("chooseEpt").onclick=function(){q.show();v(function(b){eptSelectTable.setDataSource(b);eptSelectTable.selAllCheckBoxObj.disable(!1);eptSelectTable.loadData(eptSelectTable.getCurrentPage());var a=eptSelectTable.table.childNodes[0].childNodes;for(b=1;b<a.length;b++)a[b].childNodes[0].childNodes[1].addEventListener("click",
function(){for(var b=0,d=1;d<a.length;d++){var f=a[d].childNodes[0].childNodes[1];$(f).hasClass("checked")&&!$(f).hasClass("disabled")&&b++}if(c.length+b>=h)for(d=1;d<a.length;d++)$(a[d].childNodes[0].childNodes[1]).hasClass("checked")||$(a[d].childNodes[0].childNodes[1]).addClass("disabled");else for(d=1;d<a.length;d++)$(a[d].childNodes[0].childNodes[1]).hasClass("checked")||$(a[d].childNodes[0].childNodes[1]).removeClass("disabled")})})};id("menualAdd").onclick=function(){var b=new Input({type:Input.TYPE.PLAIN_TEXT,
label:{value:label.mac+(c.length+1)},targetId:"macContent",check:{blur:m},props:{maxlength:"17",type:"text"},innerElement:{id:"rmMac"+c.length,className:"checkboxElement"}});$("#rmMac"+c.length).html('<i class="iconfont icon-delete rmIcon"></i><span>'+label.remove+"</span>");id("rmMac"+c.length).onclick=p;c.push(b);c.length>=h&&($("#chooseEpt").addClass("disable"),$("#menualAdd").addClass("disable"))};(function(){var b={},a={};b[uciFirewall.fileName]=a;a[KEY_NAME]=uciFirewall.secName.lanManage;a=
{};b[uciNetwork.fileName]=a;a[KEY_NAME]=uciNetwork.dynData.ifaceMac;$.query(b,w)})()})();
</script><script type="text/javascript">
</script><style type="text/css">div.webManageRadio{display:inline-block;margin-right:16px}ul.inputCMPT span{font-size:13px;vertical-align:middle;height:32px;line-height:32px;display:inline-block}#openContent{display:none}i.rmIcon{top:6px;position:relative;margin-right:4px}#macContent div.checkboxElement{color:#333;cursor:pointer}div.selectParentTitleDesc{margin-bottom:24px}a.disable{pointer-events:none;opacity:.5}</style>