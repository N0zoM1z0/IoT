
<html><head>
<meta HTTP-EQUIV='Pragma' CONTENT='no-cache'>
<meta http-equiv='Content-Type' content='text/html; charset=UTF-8'>
<link rel="stylesheet" rev="stylesheet" href="/css/content.css" type="text/css">
<script language="javascript" src="/js/portName.js"></script>
<script language="javascript" src="/js/check.js"></script>
<script language="javascript" src="/js/jquery.js"></script>
<script language="javascript" src="/js/init.js"></script>
<script language="javascript" src="/js/t_utils.js"></script>
<script language="javascript" src="/js/tri.js"></script>
<script language='javascript' src='/js/project.js'></script>
<script language="javascript"> 
	
function PortTriggerTuple()
{
    this.Path = "";
    this.PortTriggerEnabled = "";
    this.PortTriggerDescription = "";
    this.PortTriggerProtocol = "";
    this.TriggerStartPort = "";
    this.TriggerEndPort = "";
    this.OpenStartPort = "";
    this.OpenEndPort = "";
}

function WanConnsTuple()
{
    this.Path = "";
    this.Name = "";
    this.ConnectionType = "";
    this.ServiceList = "";
}

var index = 0;
var n = 0;
var PortTrigger = new Array();
var WanConns = new Array();
<!--#getobject "InternetGatewayDevice.WANDevice." -->
<!--#getobject "InternetGatewayDevice.WANDevice.{i}.WANConnectionDevice." -->
    <!--#getobject "InternetGatewayDevice.WANDevice.{i}.WANConnectionDevice.{i}.WANIPConnection. Name ConnectionType X_CT-COM_ServiceList X_CT-COM_IPMode"-->
        WanConns[n] = new WanConnsTuple();   
        WanConns[n].Path = "<!--#path -->";
        WanConns[n].Name = "<!--#leaf "1"-->";
        WanConns[n].ConnectionType = "<!--#leaf "2"-->";
        WanConns[n].ServiceList = "<!--#leaf "3"-->";
        WanConns[n].IPMode = "<!--#leaf "4"-->";
        n++;
        <!--#getobject "InternetGatewayDevice.WANDevice.{i}.WANConnectionDevice.{i}.WANIPConnection.{i}.X_TRI_PortTriggering. Enable Description Protocol Port PortEnd OpenPort OpenPortEnd" -->
            PortTrigger[index] = new PortTriggerTuple();   
            PortTrigger[index].Path = "<!--#path -->";
            PortTrigger[index].PortTriggerEnabled = "<!--#leaf "1"-->";
            PortTrigger[index].PortTriggerDescription = "<!--#leaf "2"-->";
            PortTrigger[index].PortTriggerProtocol = "<!--#leaf "3"-->";
            PortTrigger[index].TriggerStartPort = "<!--#leaf "4"-->";
            PortTrigger[index].TriggerEndPort = "<!--#leaf "5"-->";
            PortTrigger[index].OpenStartPort = "<!--#leaf "6"-->";
            PortTrigger[index].OpenEndPort = "<!--#leaf "7"-->";
            index++;
        <!--#endgetobject -->
    <!--#endgetobject -->
    
    <!--#getobject "InternetGatewayDevice.WANDevice.{i}.WANConnectionDevice.{i}.WANPPPConnection. Name ConnectionType X_CT-COM_ServiceList X_CT-COM_IPMode"-->
        WanConns[n] = new WanConnsTuple();   
        WanConns[n].Path = "<!--#path -->";
        WanConns[n].Name = "<!--#leaf "1"-->";
        WanConns[n].ConnectionType = "<!--#leaf "2"-->";
        WanConns[n].ServiceList = "<!--#leaf "3"-->";
        WanConns[n].IPMode = "<!--#leaf "4"-->";
        n++;
        <!--#getobject "InternetGatewayDevice.WANDevice.{i}.WANConnectionDevice.{i}.WANPPPConnection.{i}.X_TRI_PortTriggering. Enable Description Protocol Port PortEnd OpenPort OpenPortEnd" -->
            PortTrigger[index] = new PortTriggerTuple();   
            PortTrigger[index].Path = "<!--#path -->";
            PortTrigger[index].PortTriggerEnabled = "<!--#leaf "1"-->";
            PortTrigger[index].PortTriggerDescription = "<!--#leaf "2"-->";
            PortTrigger[index].PortTriggerProtocol = "<!--#leaf "3"-->";
            PortTrigger[index].TriggerStartPort = "<!--#leaf "4"-->";
            PortTrigger[index].TriggerEndPort = "<!--#leaf "5"-->";
            PortTrigger[index].OpenStartPort = "<!--#leaf "6"-->";
            PortTrigger[index].OpenEndPort = "<!--#leaf "7"-->";
            index++;
        <!--#endgetobject -->
    <!--#endgetobject -->
<!--#endgetobject -->
<!--#endgetobject -->

function init(){
    //生成WAN连接下拉框
    var _text = [],_value = [];
    for(var i = 0; i < WanConns.length; i++){
        if(!isBridgedConn(WanConns[i].ConnectionType) && WanConns[i].ServiceList != 'TR069' && WanConns[i].ServiceList != 'VOIP' && WanConns[i].IPMode != '2'){
            _text.push(WanConns[i].Name);
            _value.push(WanConns[i].Path);
        }
	}
	if (_text.length == 0) {
		_text[0] = '-';
		_value[0] = '-';
	}
    createOptions('SELECT_WanConns',_text,_value);
}

function get_wanifname(triggerPth)
{
	for (var i = 0; i< WanConns.length; i++)
	{
		if (triggerPth.indexOf(WanConns[i].Path) >= 0)
			return WanConns[i].Name;
	}
	return "";
}

function createTable() {
	var wanConns    = $('SELECT_WanConns').value;
	var array_value = [];
	var x = 0;	
	var no_rule = 1;
	var trs = "";

	trs += "<tr class='TitleRow'>";
	trs += "<td>" + getStr('LK_Number') + "</td>";
	trs += "<td>" + getStr('LK_Name') + "</td>";
	trs += "<td>" + getStr('LK_Interface') + "</td>";
	trs += "<td>" + getStr('LK_Protocol') + "</td>";
	trs += "<td>" + getStr('LK_TriggeringStartPort') + "</td>";
	trs += "<td>" + getStr('LK_TriggeringEndPort') + "</td>";
	trs += "<td>" + getStr('LK_TriggeringOpenStartPort') + "</td>";
	trs += "<td>" + getStr('LK_TriggeringOpenEndPort') + "</td>";          
	trs += "<td>" + getStr('LK_Enable') + "</td>";          
	trs += "<td>" + getStr('LK_Action') + "</td>";         
	trs += "</tr>";

	for(var k = 0,i = 0; k < PortTrigger.length; k++){
		var rule = PortTrigger[k];
	
		if (rule.Path.indexOf(wanConns) > -1){
			var tr = "";
			if(x % 2==0)
				tr += "<tr class='OddRowB'>";
			else
				tr += "<tr class='EvenRowB'>";
			tr += "<td>"+(i+1)+"</td>";
			tr += "<td>"+rule.PortTriggerDescription+"</td>";
			tr += "<td>"+get_wanifname(rule.Path)+"</td>";
			tr += "<td>"+rule.PortTriggerProtocol+"</td>";
			tr += "<td>"+rule.TriggerStartPort+"</td>";
			tr += "<td>"+rule.TriggerEndPort+"</td>";
			tr += "<td>"+rule.OpenStartPort+"</td>";
			tr += "<td>"+rule.OpenEndPort+"</td>";
			tr += "<td>"+rule.PortTriggerEnabled+"</td>";
			tr += "<td>"
				+ "<img style='cursor:pointer' src='../../skin/edit.gif' onclick='uiEdit(\"" + rule.Path + "\", \"" +(i) + "\")'>"
				+ "<img style='cursor:pointer' src='../../skin/trash.gif' onclick='uiDelete(\"" + rule.Path + "\")'></td>";
			tr += "</tr>";
			trs += tr;   
			no_rule = 0;
			i++;
		}
	}

	if(no_rule == 1)
	{
		trs += '<tr class="OddRowB"><td colspan="10">'+ getStr('LK_NoRule');+'</td></tr>';
	}
	jQuery("#PortTriggerList").empty();
	jQuery("#PortTriggerList").append(trs);
}

function uiEdit(Path,id)
{
	// Path指向InternetGatewayDevice.WANDevice.1.WANConnectionDevice.1.WANIPConnection.1.X_TRI_PortTriggering.1.
    document.location.href='/page/advancedsetup/adv_porttriggeringedit.shtml?path='+Path+'&action=edit';
}

function uiDelete(path){
    if(!validateCode())
        return false;
    var df = document.app_porttriggerform; 
    AddElements(df, 'del_obj',path);
    df.submit(); 
}

function uiAdd(){
	var wancPath = $('SELECT_WanConns').value; // Path指向InternetGatewayDevice.WANDevice.1.WANConnectionDevice.1.WANIPConnection.1.
	if (wancPath == "") 
	{
		top.AlertMsg(getStr("LK_app_chooseConnectionName"));
		return false;
	}

	document.location.href='/page/advancedsetup/adv_porttriggeringedit.shtml?path='+wancPath+'&action=add';
}

function __init()
{
    init();
    createTable();
    if(IsExistedFunction("project_init") == true) 
        project_init(GetCurrentFileName());
}
</script> 
</head>
<body>
<form method="get">
<script>printBeginContent()</script>
<script>SetContentTitle(getStr('LK_PortTriggering'));</script>
<table class="ContentTableNoColor" cellpadding="0" cellspacing="0" width="600">
<tr>
	<td width="150" langkey="LK_WANConnection_Colon"></td>
	<td><select name="SELECT_WanConns" id="SELECT_WanConns" onchange="createTable()">
                    <option> </option>
                </select>
		<script>PrintTriButton("add",getStr('LK_Add'),"uiAdd()");</script></td>
</tr>
<tr id="BUTTON_BLOCK" class="spaceLine"><td>&nbsp;</td></tr>
</table>
<br>
<table id="PortTriggerList" cellpadding="0" cellspacing="0" class="ContentBorder">
<tr class="TitleRow">
	<td langkey="LK_Number"></td>
	<td langkey="LK_Name"></td>
	<td langkey="LK_Interface"></td>
	<td langkey="LK_Protocol"></td>
	<td langkey="LK_TriggeringStartPort"></td>
	<td langkey="LK_TriggeringEndPort"></td>
	<td langkey="LK_TriggeringOpenStartPort"></td>
	<td langkey="LK_TriggeringOpenEndPort"></td>
	<td langkey="LK_Enable"></td>
	<td langkey="LK_Action"></td>
</tr>
<script>printEndContent()</script>
</form>
 <form method="post" name ="app_porttriggerform" action="/cgi-bin/setup.cgi?page/advancedsetup/adv_porttriggering.shtml">
 </form>
</body>
</html>
