<html>
<head>
<meta HTTP-EQUIV='Pragma' CONTENT='no-cache'>
<link rel="stylesheet" rev="stylesheet" href="/css/content.css" type="text/css">
<script language="javascript" src="/js/jquery.js"></script>
<script language="javascript" src="/js/check.js"></script>
<script language="javascript" src="/js/t_utils.js"></script>
<script language="javascript" src="/js/init.js"></script>
<script language="javascript" src="/js/tri.js"></script>
<script language='javascript' src='/js/project.js'></script>
<script language='javascript'>
<!-- hide
function GetStatusTuple()
{
	this.Path = "";
	this.AclStatus = "";
}
function GetMacListTuple()
{
	this.Path = "";
	this.AclMac = "";
	this.Desc = "";
}
var Gs_idx = 0;
var GsMac_idx = 0;
var WlACLStat = new Array();
<!--#getobject "InternetGatewayDevice.LANDevice.1.WLANConfiguration. "-->
	<!--#getobject "InternetGatewayDevice.LANDevice.1.WLANConfiguration.{i}.X_TRI-ACL. Status" -->
		WlACLStat[Gs_idx] = new GetStatusTuple();
		WlACLStat[Gs_idx].Path = "<!--#path -->";
		WlACLStat[Gs_idx].AclStatus = '<!--#leaf "1" -->';
	<!--#endgetobject -->

	WlACLStat[Gs_idx]._MacList = new Array();
	GsMac_idx = 0;
	<!--#getobject "InternetGatewayDevice.LANDevice.1.WLANConfiguration.{i}.X_TRI-ACL.Mac_List. MacAddr Desc"-->
		WlACLStat[Gs_idx]._MacList[GsMac_idx] = new GetMacListTuple();
		WlACLStat[Gs_idx]._MacList[GsMac_idx].Path = "<!--#path -->";
		WlACLStat[Gs_idx]._MacList[GsMac_idx].AclMac = "<!--#leaf "1"-->";
		WlACLStat[Gs_idx]._MacList[GsMac_idx].Desc = "<!--#leaf "2"-->";
		GsMac_idx++;
	<!--#endgetobject -->
	Gs_idx++;
<!--#endgetobject -->

function GetSSIDTuple()
{
	this.Path = "";
	this.Enable = "";
	this.SSID = "";
}
var WlSSID = new Array();
var index = 0;
<!--#getobject "InternetGatewayDevice.LANDevice.1.WLANConfiguration. Enable SSID" -->
	WlSSID[index] = new GetSSIDTuple();
	WlSSID[index].Path = "<!--#path -->";
	WlSSID[index].Enable = "<!--#leaf "1"-->";
	WlSSID[index].SSID = "<!--#leaf "2"-->";
	index++;
<!--#endgetobject -->

function createSSIDList()
{
	var text = [];
	var value = [];
	var i = 0;
	for(i; i < WlSSID.length; i++)
	{
		text[i] = WlSSID[i].SSID;
		value[i] = i;
	}
	createOptions("wlSsidIdx", text, value);
	$("wlSsidIdx").selectedIndex = 0;
}

function createMacList()
{
	var ssididx = getValue("wlSsidIdx");
	var MacListArr = WlACLStat[ssididx]._MacList;
	var listLen = MacListArr.length;
	var trs = '';
	trs += '<table class="ContentBorder" cellpadding="0" cellspacing="0">';
	trs += '<tr class="TitleRow">'
	trs += '<td>MAC Address</td><td>Description</td><td>Action</td>'
	trs += '</tr>'
	if(listLen == 0)
	{
		trs += '<tr class="OddRowB"><td colspan="3">' + getStr("LK_NoRule") + '</td></tr>';
	}
	else
	{
		for (var i=0; i<listLen; i++)
		{
			if(i%2 == 0)
				trs += '<tr class="OddRowB">'
			else
				trs += '<tr class="EvenRowB">'
			trs += '<td width="150px">' + WlACLStat[ssididx]._MacList[i].AclMac + '</td><td width="150px">' + WlACLStat[ssididx]._MacList[i].Desc + '</td>'
			trs += '<td width="100px"><img src="../../skin/edit.gif" style="cursor:pointer" onclick="uiEdit(\'' + WlACLStat[ssididx]._MacList[i].Path + '\')">&nbsp<img src="../../skin/trash.gif" style="cursor:pointer" onclick="uiRemove(\'' + WlACLStat[ssididx]._MacList[i].Path + '\')"></td>'
			trs += '</tr>'
		}
	}
	trs += '</table>'
	jQuery('#WlMacListTitle').html(trs);

    if(listLen >= 32)
       $('submit').disabled = true; 
    else
       $('submit').disabled = false; 
}

function pageRefresh() {
   with ( document.forms[0] ) {
	var ssididx = getValue("wlSsidIdx");
	var MacResStat = WlACLStat[ssididx].AclStatus;
	if(MacResStat == "0") // disabled
		wlFltMacMode[0].checked = true;
	else if(MacResStat == "1") //allow
		wlFltMacMode[1].checked = true;
	else
		wlFltMacMode[2].checked = true;
    }
    // when change the list, chage the mac table too.
    createMacList();
}

function uiAdd() {
	var ssididx = getValue("wlSsidIdx");
	if (WlSSID[ssididx].Enable == "0")
	{
		top.AlertMsg(getStr("LK_SSIDDisabled"));
		return;
	}

	document.location.href = 'adv_wladdmaclist.shtml?id=' + ssididx + '&OP=ADD&Path=' + WlACLStat[ssididx].Path + 'Mac_List.';
}

function uiEdit(path) {
	var ssididx = getValue("wlSsidIdx");
	document.location.href = 'adv_wladdmaclist.shtml?id=' + ssididx + '&OP=EDIT&Path=' + path;
}

function uiRemove(path) {
	var df = document.dataform;
	AddElements(df, 'del_obj', path);
	df.submit();
}

function modeClick() {
	var fltMode = '';

	with ( document.forms[0] ) {
		if ( wlFltMacMode[0].checked == true )
			fltMode = '0'; // disabled
		else if ( wlFltMacMode[1].checked == true )
			fltMode = '1'; // allow
		else
			fltMode = '2'; // deny
	}

	var ssididx = getValue("wlSsidIdx");
	var df = document.dataform;
	df.action = '/cgi-bin/setup.cgi?page/advancedsetup/adv_wlacl.shtml?id=' + ssididx;
	AddElements(df, WlACLStat[ssididx].Path + "Status", fltMode);
	df.submit();
}

function frmLoad() {
	createSSIDList();
	//pageRefresh();

	var url = window.location.search;
	var i = url.indexOf("?");

	if(i == -1)
	{
		pageRefresh();
		return;
	}

	var arr = url.toString();
	var str = arr.split("=");
	var id = parseInt(str[1]);

	$("wlSsidIdx").selectedIndex = id;
	pageRefresh();
	
}

function __init()
{
    frmLoad();
    if(IsExistedFunction("project_init") == true) 
    {
        project_init(GetCurrentFileName());
    }
}

// done hiding -->
</script>
</head>
<body >
<script>printBeginContent();</script>
<form>
<script>SetContentTitle(getStr("LK_WlMacFilter"));</script>
<table class="ContentTableNoColor" cellpadding='0' cellspacing='0'>
   <tr>
   <td id='wlmacfltview2' width="150px" langkey="LK_SelectSSID"></td>
   <td><select id='wlSsidIdx' onChange='pageRefresh()' > 
       </select>
   </td>
   </tr>
</table>
<table class="ContentTableNoColor" cellpadding='0' cellspacing='0'>
   <tr>
      <td width="150px" langkey="LK_MacResMode"></td>
      <td><input type='radio' name='wlFltMacMode' onClick='modeClick()'>&nbsp;Disabled</td>&nbsp;&nbsp;
      <td><input type='radio' name='wlFltMacMode' onClick='modeClick()'>&nbsp;Allow</td>&nbsp;&nbsp;
      <td><input type='radio' name='wlFltMacMode' onClick='modeClick()'>&nbsp;Deny</td>
   </tr>
</table>
<br><br>

<table class="ContentTableNoColor" cellpadding='0' cellspacing='0'>
    <tr class="FlagText">
        <td langkey="LK_WlMacMaxClients"></td>
    </tr>
    <tr class="spaceLine"><td>&nbsp;</td></tr>
</table>

<div id="WlMacListTitle"></div>

<table class="ContentTableNoColor" cellpadding='0' cellspacing='0'>
<tr>
<tr class="spaceLine"><td>&nbsp;</td></tr>
</tr>
<tr>
    <td>
    <script>PrintTriButton("submit",getStr("LK_Add"),onClick="uiAdd();");</script>
    </td>
</tr>
</table>
</form>
<script>printEndContent();</script>
<form method="post" name ="dataform" action="/cgi-bin/setup.cgi?page/advancedsetup/adv_wlacl.shtml">
</form>
</body>
</html>
