
<html>
<head>
<meta HTTP-EQUIV='Pragma' CONTENT='no-cache'>
<meta http-equiv='Content-Type' content='text/html; charset=UTF-8'>
<link rel="stylesheet" rev="stylesheet"  href="/css/content.css" type="text/css">
<script language="javascript" src="/js/check.js"></script>
<script language="javascript" src="/js/jquery.js"></script>
<script language="javascript" src="/js/init.js"></script>
<script language="javascript" src="/js/t_utils.js"></script>
<script language="javascript" src="/js/tri.js"></script>
<script language='javascript' src='/js/project.js'></script>
<script language="javascript">
function ConnectionTuple()
{    
    this.Type = "";
    this.Path = "";
    this.Name = "";
    this.DNSEnabled="";            
    this.DNSOverrideAllowed="";            
    this.DNSServers="";
    this.ServiceList = "";
    this.ConnectionType = "";
    this.IPMode = "";
}
var n = 0;
var Connection = new Array();
<!--#getobject "InternetGatewayDevice.WANDevice." -->
<!--#getobject "InternetGatewayDevice.WANDevice.{i}.WANConnectionDevice." -->
<!--#getobject "InternetGatewayDevice.WANDevice.{i}.WANConnectionDevice.{i}.WANIPConnection. Name DNSEnabled DNSOverrideAllowed DNSServers X_CT-COM_ServiceList ConnectionType X_CT-COM_IPMode" -->
    Connection[n] = new ConnectionTuple();
    Connection[n].Type = "IP";
    Connection[n].Path = "<!--#path -->";
    Connection[n].Name = "<!--#leaf "1"-->";
    Connection[n].DNSEnabled = "<!--#leaf "2"-->";
    Connection[n].DNSOverrideAllowed = "<!--#leaf "3"-->";
    Connection[n].DNSServers = "<!--#leaf "4"-->";
    Connection[n].ServiceList = "<!--#leaf "5"-->";
    Connection[n].ConnectionType = "<!--#leaf "6"-->";
    Connection[n].IPMode = "<!--#leaf "7"-->";
    n++;
<!--#endgetobject -->
<!--#getobject "InternetGatewayDevice.WANDevice.{i}.WANConnectionDevice.{i}.WANPPPConnection. Name DNSEnabled DNSOverrideAllowed DNSServers X_CT-COM_ServiceList ConnectionType X_CT-COM_IPMode" -->
    Connection[n] = new ConnectionTuple();
    Connection[n].Type = "PPP";
    Connection[n].Path = "<!--#path -->";
    Connection[n].Name = "<!--#leaf "1"-->";
    Connection[n].DNSEnabled = "<!--#leaf "2"-->";
    Connection[n].DNSOverrideAllowed = "<!--#leaf "3"-->";
    Connection[n].DNSServers = "<!--#leaf "4"-->";
    Connection[n].ServiceList = "<!--#leaf "5"-->";
    Connection[n].ConnectionType = "<!--#leaf "6"-->";
    Connection[n].IPMode = "<!--#leaf "7"-->";
    n++;
<!--#endgetobject -->
<!--#endgetobject -->
<!--#endgetobject -->

<!--#getobject "InternetGatewayDevice.X_TRI-DMZ. Enabled Host WanConnection" -->
var G_Enabled = "<!--#leaf "1" -->";
var G_Host= "<!--#leaf "2"-->";
var G_WanConnection = "<!--#leaf "3"-->";
<!--#endgetobject -->

function createConnNameOptions()
{
    var options = "";
    for (i = 0; i < Connection.length; i++)
    {
        if (!isBridgedConn(Connection[i].ConnectionType) && Connection[i].IPMode != '2'){
            options += "<option value='" + i + "'>" + Connection[i].Name + "</option>";
        }
    }
    jQuery('#SELECT_WanConnection').append(options);
    jQuery('#SELECT_WanConnection').html(options);
    jQuery('#SELECT_WanConnection').css("width", "auto");
}

function setDNSOverride()
{
    var dnsoverride = getValue("INPUT_DNSOverrideAllowed");
    if (dnsoverride == 0)
    {  
       disableCtrl("INPUT_Dns1",true);
       disableCtrl("INPUT_Dns2",true);
    }
    else
    {
       disableCtrl("INPUT_Dns1",false);
       disableCtrl("INPUT_Dns2",false);
    }
}

function ConnNameSwitch()
{
    wanConn = getValue('SELECT_WanConnection');

    if (wanConn != -1)
    {
        setValue("INPUT_DNSOverrideAllowed", Connection[wanConn].DNSOverrideAllowed);
        DNSServer = Connection[wanConn].DNSServers.split(',');
        setValue('INPUT_Dns1', DNSServer[0]);
        setValue('INPUT_Dns2', DNSServer[1] == undefined ? '' : DNSServer[1]);
    }
    else
    {
        setValue("INPUT_DNSOverrideAllowed", 0);
        setValue("INPUT_Dns1", '');
        setValue("INPUT_Dns2", '');
    }
    setDNSOverride();
}

function init()
{
    createConnNameOptions();
    ConnNameSwitch();
}

function uiSubmit()
{

    var df = document.dnsdataform; 
    var wanConn = getValue('SELECT_WanConnection');
    var dns = getValue('INPUT_Dns1') + ',' + getValue('INPUT_Dns2');

    if(!validateCode())
        return false;
    if (wanConn == -1)
    {
        top.AlertMsg(getStr("LK_app_chooseWanConnect"));
        return false;
    }
    dns = dns.replace(/(^,*)|(,*$)/g,'');
    if(getValue('INPUT_DNSOverrideAllowed') == 1)
    {
        if(!isCheckIPV4($('INPUT_Dns1')))
            return false;
    }
    if(getValue('INPUT_Dns2') !="")
    {
        if(!isCheckIPV4($('INPUT_Dns2')))
            return false;
    }
    dns = dns.replace(/(^,*)|(,*$)/g,'');
    //AddElements(df, Connection[wanConn].Path + "DNSEnabled", 1);
    AddElements(df, Connection[wanConn].Path + "DNSOverrideAllowed", getValue("INPUT_DNSOverrideAllowed"));
    AddElements(df, Connection[wanConn].Path + "DNSServers", dns);
 
    df.submit(); 
}

function __init()
{
    init();
    if(IsExistedFunction("project_init") == true) 
        project_init(GetCurrentFileName());
}
</script>
</head>
<body>
<script>printBeginContent()</script>
<script>SetContentTitle(getStr('LK_DNSServerConfiguration'))</script>
<form>
    <table cellpadding="0" cellspacing="0" width="600" class="ContentTableNoColor">
        <tr>
            <td width="150" langkey="LK_WANConnection_Colon"></td>
            <td><select name="SELECT_WanConnection" id="SELECT_WanConnection" onChange="ConnNameSwitch()">
                   <option value='-1'>-</option>
                </select>
            </td>
        </tr>
        <tr>
            <td langkey="LK_IPv4StaticDNS"></td>     
            <td><input type="checkbox" name="INPUT_DNSOverrideAllowed" id="INPUT_DNSOverrideAllowed" onClick="setDNSOverride()"></td>
        </tr>
            <tr>
                <td langkey="LK_PrimaryDNSServer"></td>
                <td><input type="text" id="INPUT_Dns1" maxlength="15"></td>
            </tr>
            <tr>
                <td langkey="LK_SecondaryDNSServer"></td>
                <td><input type="text" id="INPUT_Dns2" maxlength="15"></td>
            </tr>
        <tr id="BUTTON_BLOCK" class="spaceLine"><td>&nbsp;</td></tr>
        <tr>
            <td colspan="2">
            <script>PrintTriButton("submit",getStr('LK_Apply'),"uiSubmit()");</script>&nbsp;
            <script>PrintTriButton("refresh",getStr('LK_uirefresh'),"uiPageRefresh()");</script>
            </td>
        </tr>
    </table>
 <script>printEndContent()</script>    
</form>
<form method="post" name ="dnsdataform" action="/cgi-bin/setup.cgi?page/advancedsetup/adv_dnssc.shtml">
</form>
</body>
</html>
