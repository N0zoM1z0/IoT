
<html>
<head>
<meta HTTP-EQUIV='Pragma' CONTENT='no-cache'>
<meta http-equiv='Content-Type' content='text/html; charset=UTF-8'>
<link rel="stylesheet" rev="stylesheet" href="/css/content.css" type="text/css">
<script language="javascript" src="/js/jquery.js"></script>
<script language="javascript" src="/js/t_utils.js"></script>
<script language="javascript" src="/js/init.js"></script>
<script language="javascript" src="/js/tri.js"></script>
<script language='javascript' src='/js/project.js'></script>
<script language="javascript">

function ConnectionTuple()
{    
    this.Type = "";
    this.Path = "";
    this.Name = "";
    this.ServiceList = "";
    this.ConnectionType = ""; 
    this.IPMode = "";
    this.Enable = "";
    this.Available = true;
}
var defaultroutelist="<!--#getsingle "InternetGatewayDevice.X_TRI_DefautlRoute.WanInterface"-->";

var n = 0;
var Connection = new Array();

var m = 0;

<!--#getobject "InternetGatewayDevice.WANDevice." -->
<!--#getobject "InternetGatewayDevice.WANDevice.{i}.WANConnectionDevice." -->
<!--#getobject "InternetGatewayDevice.WANDevice.{i}.WANConnectionDevice.{i}.WANIPConnection. Name X_CT-COM_ServiceList ConnectionType X_CT-COM_IPMode Enable" -->
    Connection[n] = new ConnectionTuple();
    Connection[n].Type = "IP";
    Connection[n].Path = "<!--#path -->";
    Connection[n].Name = "<!--#leaf "1"-->";
    Connection[n].ServiceList = "<!--#leaf "2"-->";
    Connection[n].ConnectionType = "<!--#leaf "3"-->";
    Connection[n].IPMode = "<!--#leaf "4"-->";
    Connection[n].Enable = "<!--#leaf "5"-->";
    n++;
<!--#endgetobject -->
<!--#getobject "InternetGatewayDevice.WANDevice.{i}.WANConnectionDevice.{i}.WANPPPConnection. Name X_CT-COM_ServiceList ConnectionType X_CT-COM_IPMode Enable" -->
    Connection[n] = new ConnectionTuple();
    Connection[n].Type = "PPP";
    Connection[n].Path = "<!--#path -->";
    Connection[n].Name = "<!--#leaf "1"-->";
    Connection[n].ServiceList = "<!--#leaf "2"-->";
    Connection[n].ConnectionType = "<!--#leaf "3"-->";
    Connection[n].IPMode = "<!--#leaf "4"-->";
    Connection[n].Enable = "<!--#leaf "5"-->";
    n++;
<!--#endgetobject -->
<!--#endgetobject -->
<!--#endgetobject -->

filterWanConnection();

function isWanConnectionFiltered(conn)
{
	if (isBridgedConn(conn.ConnectionType)
		|| conn.ServiceList == 'TR069'
		|| conn.ServiceList == 'OTHER'		
		|| conn.ServiceList == 'VOIP'
		|| conn.IPMode == '2'
		|| conn.Enable != '1'
		) {
		return true;
	}
	return false;
}

function filterWanConnection()
{
	for (i=0;i<Connection.length;i++) {
		var conn = Connection[i];
		if (isWanConnectionFiltered(conn)) {
			conn.Available = false;
		}
	}
}


function createTable() {
	var list;
	var defaultlist=defaultroutelist.split(',');
	var i;

	//init select table for available interfaces
	for (i=0;i<Connection.length;i++) {
		var conn = Connection[i];
		if (conn.Available == false) {
			continue;
		}
		with ( document.forms[0] ) {
			if(defaultlist.indexOf(conn.Path) < 0)
			{
				varOpt = new Option(conn.Name,conn.Path );	
				availDefRoute.options[availDefRoute.length] = varOpt;
			}
		}
	}
	
	//init select table for selected interfaces
	for (dft=0;dft<defaultlist.length;dft++) {
		var valid_intf=0;
		var conn;
		for(i=0;i<Connection.length;i++){
			conn = Connection[i];
			if(conn.Path == defaultlist[dft]){
				if(conn.Available == true)
					valid_intf = 1 ;
				break;
			}
		}
		if(valid_intf == 0)
			continue;
		with ( document.forms[0] ) {
			varOpt = new Option(conn.Name,conn.Path );	
			selDefRoute.options[selDefRoute.length] = varOpt;
		}
	}

}

function btnRemove() {
   with ( document.forms[0] ) {
      var arrSelected = new Array();
      var count = 0;
      for ( i = 0; i < selDefRoute.options.length; i++ ) {
         if ( selDefRoute.options[i].selected == true ) {
            arrSelected[count] = selDefRoute.options[i].value;
         }
         count++;
      }
      var x = 0;
      for (i = 0; i < selDefRoute.options.length; i++) {
         for (x = 0; x < arrSelected.length; x++) {
            if (selDefRoute.options[i].value == arrSelected[x]) {
               varOpt = new Option(selDefRoute.options[i].text, selDefRoute.options[i].value);
               availDefRoute.options[availDefRoute.length] = varOpt;
               selDefRoute.options[i] = null;
            }
         }
      }
   }
}

function btnAdd() {
   with ( document.forms[0] ) {
      var arrSelected = new Array();
      var count = 0;
      for ( i = 0; i < availDefRoute.options.length; i++ ) {
         if ( availDefRoute.options[i].selected == true ) {
            arrSelected[count] = availDefRoute.options[i].value;
         }
         count++;
      }
      var x = 0;
      for (i = 0; i < availDefRoute.options.length; i++) {
         for (x = 0; x < arrSelected.length; x++) {
            if (availDefRoute.options[i].value == arrSelected[x]) {
               varOpt = new Option(availDefRoute.options[i].text, availDefRoute.options[i].value);
               selDefRoute.options[selDefRoute.length] = varOpt;
               availDefRoute.options[i] = null;
            }
         }
      }
   }
}

function uiSubmit(){
	if(!validateCode())
		return false;
    var df = document.defaultroutecfgdataform;
	var selRouteList="";
	with ( document.forms[0] ) {
	    for ( i = 0; i < selDefRoute.options.length; i++ ) {
			if(i > 0)
				selRouteList += ",";
			selRouteList += selDefRoute.options[i].value;
	    }
    }
	if (selRouteList == '') {
		alert(getStr("LK_DefaultRouteNoSelError"));
		return;
	}
	AddElements(df, "InternetGatewayDevice.X_TRI_DefautlRoute.WanInterface",selRouteList);

    df.submit();  
}

function __init()
{
    createTable();
    if(IsExistedFunction("project_init") == true) 
        project_init(GetCurrentFileName());
}

</script>
</head>
<body>
<form>
<script>printBeginContent()</script>
<script>SetContentTitle(getStr('LK_DefaultRoute'))</script>
<table cellpadding="0" cellspacing="0" class="ContentTableNoColor">
<tr><td colspan="2" langkey="LK_DefaultRouteRemind"></td></tr>
	<tr class="spaceLine"><td>&nbsp;</td></tr>
</table>
<table border="0" cellpadding="0" cellspacing="0"  class="ContentTableNoColor">
   <tr>
      <td width="250" langkey="LK_DefaultRouteSelect"></td>
      <td width="100"></td>
      <td width="250" langkey="LK_DefaultRouteAvail"></td>
   </tr>
   <tr><td colspan="3">&nbsp;</td></tr>
   <tr>
      <td>
          <select multiple name="selDefRoute" size="10" style="width: 200">
		  </select>
       </td>
      <td>
         <table border="0" cellpadding="0" cellspacing="5">
            <tr><td>
               <input type="button" value="->" onClick="btnRemove()" style="width: 30; height: 30">
            </td></tr>
            <tr><td>
               <input type="button" value="<-" onClick="btnAdd()" style="width: 30; height: 30">
            </td></tr>
         </table>
      </td>
      <td>
          <select multiple name="availDefRoute" size="10" style="width: 200">  
            </select></td>
      </tr>
</table>                      
<br>
<table class="ContentTableNoColor">
<tr id="BUTTON_BLOCK" class="spaceLine"><td>&nbsp;</td></tr>
<tr>
	<td colspan="2">
	<script>PrintTriButton("submit",getStr('LK_Apply'),"uiSubmit()");</script>
	<script>PrintTriButton("refresh",getStr('LK_Refresh'),"uiPageRefresh()");</script>
	</td>
</tr>
</table>
<script>printEndContent()</script>
</form>
<form method="post" name ="defaultroutecfgdataform" action="/cgi-bin/setup.cgi?page/advancedsetup/adv_defaultroute.shtml">
</form>
</body>
</html>
