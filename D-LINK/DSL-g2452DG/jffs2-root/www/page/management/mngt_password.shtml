<html>
<head>
<meta HTTP-EQUIV='Pragma' CONTENT='no-cache'>
<meta http-equiv='Content-Type' content='text/html; charset=UTF-8'>
<link rel="stylesheet" rev="stylesheet" href="/css/content.css" type="text/css">
<script language="javascript" src="/js/check.js"></script>
<script language="javascript" src="/js/config.js"></script>
<script language="javascript" src="/js/tri.js"></script>
<script language="javascript" src="/js/jquery.js"></script>
<script language="javascript" src="/js/init.js"></script>
<script language="javascript" src="/js/sha256.js"></script>
<script language="javascript" src="/js/project.js"></script>
<script language="javascript" src="/js/t_utils.js"></script>
</head>
<script>



function AcInFo()
{   this.path = "";
    this.UserName = "";
    this.Password = "";
    this.Level = "";
}
var m = 0;
var G_PwdMinLength="<!--#getsingle_noop "InternetGatewayDevice.X_CT-COM_UserInfo.X_TRI-UserPasswordMinLength"-->";
var G_AcInFo = new Array();
<!--#getobject "InternetGatewayDevice.X_CT-COM_UserInfo.UserList.  UserName Password Level" -->
    G_AcInFo[m] = new AcInFo();
    G_AcInFo[m].path = "<!--#path -->";
    G_AcInFo[m].UserName = "<!--#leaf "1"-->";
    G_AcInFo[m].Password = "<!--#leaf "2"-->";
    G_AcInFo[m].Level = "<!--#leaf "3"-->";
    m++;
<!--#endgetobject -->
var restart = "<!--#getsingle_noop "InternetGatewayDevice.DeviceInfo.X_TRI-RestartWeb"-->";


function uiSubmit()
{
  var sel = document.getElementById("userName");
  var userName = sel.options[sel.selectedIndex].value;
  for(var m = 0; m < G_AcInFo.length; m++){

    if(userName == G_AcInFo[m].UserName)
    {
        var object_path = G_AcInFo[m].path;
        if(checkValue(G_AcInFo[m].Password))
        {
            if(!validateCode())
              return false;
            var df = document.Mngt_Password;
            AddElements(df, object_path + 'UserName',userName);
            AddElements(df, object_path + 'Password', getPsd());
            AddElements(df, object_path + 'Password_realtext',encode_passwd($('newPassword').value));
            df.submit();
        }
    }
  }
}

function checkValue(OldPassword)
{
	var node_psd = $('newPassword','confirmPassword','oldPassword');
	var PATTERN = /^[0-9a-zA-Z!"#^&()=\\.%@_-]{1,31}$/;
	if(SHA256(node_psd[2].value) != OldPassword)
	{
		top.AlertMsg(getStr("LK_TheOldwrong"));
		return false;
	}
	if(node_psd[2].value == '')
	{
		top.AlertMsg(getStr("LK_TheOldEmpty"));
		return false;
	}
	else if(node_psd[2].value.match(PATTERN) == null)
	{
		top.AlertMsg(getStr("LK_TheformatText"));
		return false;
	}

	if(node_psd[0].value == '')
	{
		top.AlertMsg(getStr('LK_ThenewEmpty'));
		return false;
	}
	else if(node_psd[0].value.match(PATTERN)==null)
	{
		top.AlertMsg(getStr('LK_Theformatwrong'));
		return false;
	}else if(node_psd[0].value.length < G_PwdMinLength){
		top.AlertMsg(getStr('LK_Thelengthwrong')+G_PwdMinLength);
		return false;
	}

	if(node_psd[0].value != node_psd[1].value)
	{
		top.AlertMsg(getStr("LK_ThenewpasswordText"));
		return false;
	}
	return true;
}

function getPsd()
{
	var node_psd = $('oldPassword','newPassword');
	var value_psd;
	value_psd = SHA256(node_psd[1].value);
	return value_psd;

}

function __init()
{
    //下拉框
	var userlevel='<!--#getuser "level" -->';
	var userNameArray = [];
	if (userlevel == 1)//admin
	{
		for(var i = 0; i < G_AcInFo.length; i++)
		{
			userNameArray.push(G_AcInFo[i].UserName);
		}
		
	}
	else //user
	{
		for(var i = 1; i < G_AcInFo.length; i++)
		{
			userNameArray.push(G_AcInFo[i].UserName);
		}
	
	}
	createOptions('userName',userNameArray, userNameArray);
	if(restart == 1){
		alert(getStr('LK_Services_alert'));
		document.location.href="/";
		return;
	}
    if(IsExistedFunction("project_init") == true) 
        project_init(GetCurrentFileName());
}
</script>
<body>
<script>printBeginContent();</script>
<script>SetContentTitle(getStr("LK_AccountManagementPasswords"));</script>
<form method="get">
	<table class="ContentTableNoColor" cellspacing="0" cellpadding="0">
<!--		<tr class="NoteLineHeight">
			<td langkey="LK_PassText3"></td>
		</tr>
		<tr class="NoteLineHeight">
			<td langkey="LK_PassText4"></td>
		</tr>-->
		<tr class="NoteLineHeight">
			<td langkey="LK_PassText5"></td>
		</tr>

                <tr class="spaceLine"><td>&nbsp;</td></tr>
		<tr class="FlagText">
			<td langkey="LK_PassNote"></td>
		</tr>


		<tr class="spaceLine"><td>&nbsp;</td></tr>
	</table>
	<table class="ContentTableNoColor">
		<tr>
			<td width="150" langkey="LK_Usernamee"></td>
			<td>
				<select type="text" id="userName" maxlength="31" style="width:149px"></select>
			</td>
		</tr>
		<tr>
			<td width="150" langkey="LK_OldPasswordd"></td>
			<td><input type="password" id="oldPassword" maxlength="31"></td>
		</tr>
		<tr>
			<td width="150" langkey="LK_NewPasswordd"></td>
			<td><input type="password" id="newPassword" maxlength="31"></td>
		</tr>
		<tr>
			<td width="150" langkey="LK_ConfirmPasswordd"></td>
			<td><input type="password" id="confirmPassword" maxlength="31">
		</tr>
		<tr id="BUTTON_BLOCK" class="spaceLine"><td colspan="2">&nbsp;</td></tr>
		<tr>
			<td colspan="2">
			<script>PrintTriButton("save",getStr("LK_Apply"),"uiSubmit();" );</script>&nbsp;
			<script>PrintTriButton("refresh",getStr('LK_Refresh'),"uiPageRefresh()");</script>
			</td>
		</tr>
	</table>
</form>
<script>printEndContent();</script>
<form method="post" name="Mngt_Password" id="Mngt_Password" action="/cgi-bin/setup.cgi?page/management/mngt_password.shtml">
</form>
</body>
</html>
