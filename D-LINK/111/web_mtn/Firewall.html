
<!DOCTYPE html>
<html id="html">
<head>
<meta name="viewport" content="width=1200">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Pragma" content="No-cache" />
<meta http-equiv="Cache-Control" content="no-cache, must-revalidate" />
<meta http-equiv="Expires" content="-1" />
<link rel=stylesheet type="text/css" href="css/jquery.selectbox.css" media="all" />
<link href="css/stylish-select.css" type="text/css" rel="stylesheet" />
<link href="css/style_page.css" type="text/css" rel="stylesheet" />
<title></title>
<script type="text/javascript" charset="utf-8" src="js/localization/zh-cn.js"></script>
<script type="text/javascript" charset="utf-8" src="js/header.js"></script>
<script type="text/javascript" charset="utf-8" src="js/jquery-1.8.2.min.js"></script>
<script type="text/javascript" charset="utf-8" src="js/jquery.selectbox-0.2_new.js"></script>
<script type="text/javascript" charset="utf-8" src="js/SOAP/SOAPAction.js"></script>
<script type="text/javascript" charset="utf-8" src="js/SOAP/SOAPFirewall.js"></script>
<script type="text/javascript" charset="utf-8" src="js/initialJS.js"></script>
<script type="text/javascript">

//xframeoption
if(top!=self){top.location=self.location;}
var firewallenable="";
var spienable="";
var dosenable="";
var pingenable="";
var soapAction = new SOAPAction();

function Load_HTML(){
	MoreContainMiniheight();
}
//页面刷新获取数据
function GetXML(){
	GetResult_1st();
}
function GetResult_1st(){
    var getAPFirewallSettings=new SOAPGetFirewallSettingsResponse();
    soapAction.sendSOAPAction("GetFirewallSettings", null, getAPFirewallSettings)
            .done(function(obj){
                GetResult_2nd(obj)
            });
}

function GetResult_2nd(result_xml){
		spienable = result_xml.SPIIPv4;
		dosenable= result_xml.AntiSpoof;
		pingenable = result_xml.WANPing;

		if(spienable=="true"){
			document.getElementById("spi_enable").checked = true;
			document.getElementById("spi_statue").className = "checkbox_on";
		}else{
			document.getElementById("spi_enable").checked = false;
			document.getElementById("spi_statue").className = "checkbox_off";
		}

		if(dosenable=="true"){
			document.getElementById("dos_enable").checked = true;
			document.getElementById("dos_statue").className = "checkbox_on";
		}else{
			document.getElementById("dos_enable").checked = false;
			document.getElementById("dos_statue").className = "checkbox_off";
		}

		if(pingenable=="true"){
			document.getElementById("ping_enable").checked = true;
			document.getElementById("ping_statue").className = "checkbox_on";
		}else{
			document.getElementById("ping_enable").checked = false;
			document.getElementById("ping_statue").className = "checkbox_off";
		}
		document.getElementById("right_content").style.display="";
		document.getElementById("CreateOnloadMessage").style.display="none";
}


$(document).ready( function() {
	document.getElementById("right_content").style.display="none";
	document.getElementById("CreateOnloadMessage").style.display="";
	Load_HTML();
	GetXML();
	checkTimeout();
});


function waitSettingFinished() {
	window.location.reload();
}	

//配置SPI
function ChangspiStatus(){
	var a = document.getElementById("spi_enable").checked;
	if(a){
		document.getElementById("spi_statue").className = "checkbox_off";
		document.getElementById("spi_enable").checked=false;
	}else{
		document.getElementById("spi_statue").className = "checkbox_on";
		document.getElementById("spi_enable").checked=true;
	}
    SetXML1();
//	$.ajax({
//			cache: false,
//			url: "./js/CheckConnection",
//			timeout: 5000,
//			type: "GET",
//			success: function(data) {
//				SetXML1();
//			},
//			error: function() {
//				document.getElementById("DetectRouterConnection").style.display = "inline";
//			}
//		});
}
function SetXML1() {
	document.getElementById("CreatePopAlertMessage").style.display = "inline";
	document.getElementById("waitSettingFinish").style.display = "inline";
	SetResult_1st();
}

function SetResult_1st() {
    var SOAPSetFirewall=new SOAPSetFirewallSettings();
    var SOAPStatue=new SOAPFirewallStatue();
    SOAPSetFirewall.SPIIPv4=document.getElementById("spi_enable").checked==true?"true":"false";
    soapAction.sendSOAPAction("SetFirewallSettings", SOAPSetFirewall, SOAPStatue)
            .done(function(obj){
                if(SOAPStatue.SetFirewallSettingsResult=="OK"){
//                    setTimeout("waitSettingFinished()", 1000);
                    waitSettingFinished()
                }else if(SOAPStatue.SetFirewallSettingsResult=="ERROR"){
                    document.getElementById("CreatePopAlertMessage").style.display = "none";
                    document.getElementById("DetectRouterConnection").style.display = "inline";
                }

            });
}

//配置dos
function ChangdosStatus(){
	var a = document.getElementById("dos_enable").checked;
	if(a){
		document.getElementById("dos_statue").className = "checkbox_off";
		document.getElementById("dos_enable").checked=false;
	}else{
		document.getElementById("dos_statue").className = "checkbox_on";
		document.getElementById("dos_enable").checked=true;  

	}
    SetXML2();
}

function SetXML2() {
	document.getElementById("CreatePopAlertMessage").style.display = "inline";
	document.getElementById("waitSettingFinish").style.display = "inline";
	SetResult_2st();
}

function SetResult_2st() {
    var SOAPSetFirewall=new SOAPSetFirewallSettings();
    var SOAPStatue=new SOAPFirewallStatue();
    SOAPSetFirewall.AntiSpoof=document.getElementById("dos_enable").checked==true?"true":"false";
    soapAction.sendSOAPAction("SetFirewallSettings", SOAPSetFirewall, SOAPStatue)
            .done(function(obj){
                if(SOAPStatue.SetFirewallSettingsResult=="OK"){
//                    setTimeout("waitSettingFinished()", 1000);
                    waitSettingFinished()
                }else if(SOAPStatue.SetFirewallSettingsResult=="ERROR"){
                    document.getElementById("CreatePopAlertMessage").style.display = "none";
                    document.getElementById("DetectRouterConnection").style.display = "inline";
                }

            });
}

//配置ping
function ChangpingStatus(){
	var a = document.getElementById("ping_enable").checked;
	if(a){
		document.getElementById("ping_statue").className = "checkbox_off";
		document.getElementById("ping_enable").checked=false;
	}else{
		document.getElementById("ping_statue").className = "checkbox_on";
		document.getElementById("ping_enable").checked=true;
	}
    SetXML3();
}
function SetXML3() {
	document.getElementById("CreatePopAlertMessage").style.display = "inline";
	document.getElementById("waitSettingFinish").style.display = "inline";
	SetResult_3st();
}

function SetResult_3st() {
    var SOAPSetFirewall=new SOAPSetFirewallSettings();
    var SOAPStatue=new SOAPFirewallStatue();
    SOAPSetFirewall.WANPing=document.getElementById("ping_enable").checked==true?"true":"false";
    soapAction.sendSOAPAction("SetFirewallSettings", SOAPSetFirewall, SOAPStatue)
            .done(function(obj){
                if(SOAPStatue.SetFirewallSettingsResult=="OK"){
//                    setTimeout("waitSettingFinished()", 1000);
                    waitSettingFinished()
                }else if(SOAPStatue.SetFirewallSettingsResult=="ERROR"){
                    document.getElementById("CreatePopAlertMessage").style.display = "none";
                    document.getElementById("DetectRouterConnection").style.display = "inline";
                }

            });
}
</script>
</head>

<body>
<!-------------------- Logo menu------------------------->
	<div class="wrapper">  
		<div id="header"></div>
		<div class="clearboth" align="center" id="content">
			<div class="morecontent" align="center" id="basiccontent">
		 		<div class="pull-left" id="sub_menu_container"> 
				<script>initialLeftMenu();</script>
				</div>
				<div id="right_content"  class="pull-left" style="display:none; ">
					<table border="0"  class="tablemoreheader clearboth" cellpadding="0" cellspacing="0" align="left">
						<tr>
							<th><script>I18N("h","Firewall_Enable");</script><!-- 防火墙 --> </th>
						</tr>
					</table>
					<div class="moreline1 clearboth"></div>
					<div id="firewallcontent">
					<div class="moredescription"><script>I18N("h","Firewall_Headline");</script><!-- 防火墙保护您的内部网络不被黑客入侵。防火墙可根据绑定过滤传送或接收的封包。 --></div>
					 <table border="0" class="clearboth block" cellpadding="0" cellspacing="0" align="left" style="margin-top:36px;">
					 	<tbody>
						  <tr>
							<th><script>I18N("h","Firewall_SPI");</script><!-- SPI防火墙 --></th>
							<td class="tdcheckbox">
								 <div id="spi_statue" class="checkbox_off" onclick="ChangspiStatus()">
                       				 <input type="checkbox" id="spi_enable" name="spi_enable">
                      			</div>
							</td>
						  </tr>
						<tr class="space1"></tr>
						  <tr>
							<th><script>I18N("h","Firewall_DoS");</script><!-- 启用DoS防护 --></th>
							<td class="tdcheckbox">
								 <div id="dos_statue" class="checkbox_off" onclick="ChangdosStatus()">
                       				 <input type="checkbox" id="dos_enable" name="dos_enable">
                      			</div>
							</td>
						  </tr>
						<tr class="space1"></tr>
						<tr>
						  <th>
						   <script>I18N("h","Firewall_PING");</script><!-- 响应PING要求 -->
						  </th>
						  <td class="tdcheckbox">
								 <div id="ping_statue" class="checkbox_off" onclick="ChangpingStatus()">
                       				 <input type="checkbox" id="ping_enable" name="ping_enable">
                      			</div>						 
						 </td>
						</tr>			
					 </tbody>	
					 </table>
				</div>
				</div><!--end right_content -->
			</div>
	   </div>
 	   <div class="footer_placeholder"></div>  
   </div>
	
	<div id="footer"></div>
	<div id="CreatePopAlertMessage" style=" display:none;"></div>
	<div style=" display:none;" id="DetectRouterConnection"></div>
	<div id="CreateOnloadMessage" style="display:none;"><div class="OnLoadPopRect"><img src="/image/submit.gif" width="58" height="58"></div></div>
</body>
<script type="text/javascript">
Initial();
</script>
</html>
